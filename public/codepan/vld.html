<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Validação de Cartão</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            background-color: #f0f0f0;
        }
        /* Por padrão, o container principal começa escondido */
        .container {
            display: none; 
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        #status-inicial {
            font-size: 1.5em;
            color: #555;
        }
        #codigo-recebido, #nome-pessoa {
            font-weight: bold;
            color: #0056b3;
        }
    </style>
</head>
<body>

    <div id="status-inicial">
        <h2>Aguardando leitura do cartão...</h2>
    </div>

    <div class="container" id="info-container">
        <h1>Verificando Identidade</h1>
        <p>O código recebido do cartão foi:</p>
        <h2 id="codigo-recebido">...</h2>
        <hr>
        <p>Resultado da busca:</p>
        <h2 id="nome-pessoa">...</h2>
    </div>

    <script>
        // --- ETAPA 1: Verificar se existe um ID e controlar a visibilidade ---
        const urlParams = new URLSearchParams(window.location.search);
        const idCartao = urlParams.get('id');

        const elementoStatus = document.getElementById('status-inicial');
        const elementoContainer = document.getElementById('info-container');

        if (idCartao) {
            // Se encontrou um ID, esconde o status e mostra o container
            elementoStatus.style.display = 'none';
            elementoContainer.style.display = 'block';

            document.getElementById('codigo-recebido').innerText = idCartao;
            buscarNomeDoUsuario(idCartao); // Inicia a busca
        } else {
            // Se NÃO encontrou um ID, mostra uma mensagem de erro
            elementoStatus.innerHTML = "<h2>Erro: URL inválida. Utilize um cartão NFC.</h2>";
        }


        // --- ETAPA 2: Fazer a "ligação" para o Google Apps Script ---
        function buscarNomeDoUsuario(id) {
            const scriptUrl = "https://script.google.com/macros/s/AKfycbzfBZz74Zlj-EHgNUxP2hWIzqw8MlaLiaOhNf_wIaOJgnA72HbMdk-yyZOErDIb4zU_fg/exec"; 
            const tokenSecreto = "senhaSuperSecreta123"; 

            const urlCompleta = `${scriptUrl}?id=${id}&token=${tokenSecreto}`;
            const elementoNome = document.getElementById('nome-pessoa');
            elementoNome.innerText = "Buscando no banco de dados...";

            fetch(urlCompleta)
                .then(response => response.json())
                .then(data => {
                    if (data.erro) {
                        elementoNome.innerText = data.erro;
                    } else {
                        elementoNome.innerText = data.nome;
                    }
                })
                .catch(error => {
                    console.error('Erro na requisição:', error);
                    elementoNome.innerText = "Erro ao contatar o servidor.";
                });
        }
    </script>

</body>
</html>