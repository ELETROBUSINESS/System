<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Varejo | ELETRO</title>
    <link rel="icon" href="/assets/img/iconWeb.png">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-solid-straight/css/uicons-solid-straight.css'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>

    <link rel="stylesheet" href="/assets/css/main.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1',
                            400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155',
                            800: '#1e293b', 900: '#0f172a',
                        },
                        primary: '#3b82f6',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #f8fafc;
            font-family: 'Inter', sans-serif;
            color: #1e293b;
        }

        /* --- LAYOUT SIDEBAR --- */
        .dashboard-wrapper {
            width: 100%;
            min-height: 100vh;
            transition: padding-left 0.3s ease;
            padding-bottom: 80px;
        }

        @media (min-width: 992px) {
            body:not(.sidebar-collapsed) .dashboard-wrapper { padding-left: 260px; }
            body.sidebar-collapsed .dashboard-wrapper { padding-left: 90px; }
            .dashboard-wrapper { padding-bottom: 0; }
        }

        /* Skeleton Loading mais sutil */
        .skeleton {
            background-color: #e2e8f0;
            border-radius: 0.375rem;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        /* Esconde o conteúdo até carregar para fazer o fade-in */
        .loading-state { opacity: 0; }
    </style>
</head>

<body class="painel-adm1">

    <div class="dashboard-wrapper bg-slate-50">
        
        <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 sticky top-0 z-20">
            <div class="flex items-center gap-4">
                <h2 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 text-slate-400"></i>
                    Painel de Controle
                </h2>
            </div>

            <div class="flex items-center gap-4 md:gap-6">
                <button class="relative p-2 text-slate-500 hover:bg-slate-100 rounded-full transition-colors">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span class="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                </button>

                <div class="flex items-center gap-3 border-l border-slate-200 pl-6">
                    <img src="/users/45692327000100/CD1/adm/nb/img/profile_photo.jpg" class="w-9 h-9 rounded-full bg-slate-200 object-cover border border-slate-200">
                </div>
            </div>
        </header>

        <main class="p-6 md:p-8 max-w-[1600px] mx-auto space-y-8">

            <div class="flex justify-end">
                <div class="flex items-center gap-2 bg-white p-1 rounded-lg border border-slate-200 shadow-sm">
                    <button class="px-3 py-1.5 text-xs font-medium rounded-md bg-blue-50 text-blue-600 transition-colors">7D</button>
                    <button class="px-3 py-1.5 text-xs font-medium rounded-md text-slate-500 hover:text-slate-900 hover:bg-slate-50 transition-colors">30D</button>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 bg-emerald-50 rounded-lg text-emerald-600">
                            <i data-lucide="trending-up" class="w-5 h-5"></i>
                        </div>
                        <div class="flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-emerald-50 text-emerald-600">
                            <span>Hoje</span>
                        </div>
                    </div>
                    <h3 class="text-slate-500 text-sm font-medium mb-1">Faturamento</h3>
                    <div id="faturamentoDate" class="text-2xl font-bold text-slate-800 skeleton h-8 w-32"></div>
                </div>

                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 bg-indigo-50 rounded-lg text-indigo-600">
                            <i data-lucide="piggy-bank" class="w-5 h-5"></i>
                        </div>
                        <div class="flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-indigo-50 text-indigo-600">
                            <span>Estimado</span>
                        </div>
                    </div>
                    <h3 class="text-slate-500 text-sm font-medium mb-1">Lucro Líquido</h3>
                    <div id="lucroDate" class="text-2xl font-bold text-slate-800 skeleton h-8 w-32"></div>
                </div>

                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 bg-amber-50 rounded-lg text-amber-600">
                            <i data-lucide="ticket" class="w-5 h-5"></i>
                        </div>
                         <div class="flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-amber-50 text-amber-600">
                            <span>Geral</span>
                        </div>
                    </div>
                    <h3 class="text-slate-500 text-sm font-medium mb-1">Ticket Médio</h3>
                    <div id="ticketLJDate" class="text-2xl font-bold text-slate-800 skeleton h-8 w-32"></div>
                </div>

                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 bg-rose-50 rounded-lg text-rose-600">
                            <i data-lucide="alert-circle" class="w-5 h-5"></i>
                        </div>
                        <div class="flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-rose-50 text-rose-600">
                            <span>Pendente</span>
                        </div>
                    </div>
                    <h3 class="text-slate-500 text-sm font-medium mb-1">Contas a Pagar</h3>
                    <div id="boletosPayDate" class="text-2xl font-bold text-slate-800 skeleton h-8 w-32"></div>
                </div>

            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <div class="lg:col-span-2 bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-lg font-bold text-slate-800">Evolução da Receita</h3>
                            <p class="text-sm text-slate-500">Faturamento diário dos últimos 7 dias</p>
                        </div>
                    </div>
                    <div id="revenueChart" class="w-full h-[300px] skeleton bg-slate-50 rounded-lg"></div>
                </div>

                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col h-full">
                    <h3 class="text-lg font-bold text-slate-800 mb-4">Top Produtos</h3>
                    
                    <div class="flex-1 flex flex-col items-center justify-center text-center p-6 border-2 border-dashed border-slate-100 rounded-lg">
                        <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mb-4 text-slate-300">
                            <i data-lucide="package-open" class="w-8 h-8"></i>
                        </div>
                        <h4 class="text-slate-600 font-medium mb-1">Sem dados suficientes</h4>
                        <p class="text-slate-400 text-sm">Realize mais vendas para ver o ranking de produtos aqui.</p>
                    </div>
                </div>

            </div>

        </main>
    </div>

    <div class="navigation">
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class='bx bx-menu'></i>
        </button>
        <ul>
            <li class="list">
                <a href="/users/45692327000100/CD1/adm/nb/conta.html">
                    <span class="icon"><i class="fi fi-rr-shop"></i></span>
                    <span class="text">Loja</span>
                </a>
            </li>
            <li class="list active">
                <a href="#">
                    <span class="icon"><i class='bx bxs-bar-chart-big'></i></span>
                    <span class="text">Métrica</span>
                </a>
            </li>
            <li class="list">
                <a href="/users/45692327000100/CD1/adm/nb/push.html">
                    <span class="icon"><i class='bxr bx-plus-circle'></i></span>
                    <span class="text">Venda</span>
                </a>
            </li>
            <li class="list">
                <a href="/users/45692327000100/CD1/adm/nb/extrato.html">
                    <span class="icon"><i class='bx bx-copy-alt'></i></span>
                    <span class="text">Extrato</span>
                </a>
            </li>
            <li class="list">
                <a href="#" id="logout-btn">
                    <span class="icon"><i class='bx bx-log-out'></i></span>
                    <span class="text">Sair</span>
                </a>
            </li>
            <div class="indicator color11"></div>
        </ul>
    </div>

    <script>
        lucide.createIcons();

        document.addEventListener('DOMContentLoaded', () => {
            
            // Formatação Moeda
            const formatCurrency = (value) => {
                if (!value) return 'R$ 0,00';
                let number = value;
                if (typeof value === 'string') {
                    number = parseFloat(value.replace('R$', '').replace(/\./g, '').replace(',', '.').trim());
                }
                return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(isNaN(number) ? 0 : number);
            };

            // Função de Animação de Entrada (Substitui o shimmer)
            const revealData = (elementId, value) => {
                const el = document.getElementById(elementId);
                if(el) {
                    // Remove o skeleton
                    el.classList.remove('skeleton', 'h-8', 'w-32'); 
                    // Aplica o valor
                    el.textContent = value;
                    // Adiciona a classe de animação suave
                    el.classList.add('animate-fade-in');
                }
            };

            // --- Carregar KPIs ---
            fetch(`https://script.google.com/macros/s/AKfycby8x6--ITfvIW7ui6c24reBqzL3LUhqL30hf4-gaJCS0xB0EDPM50TcSji_W-IuNU33/exec?pagina=2`)
                .then(res => res.json())
                .then(data => {
                    // Mapeando os IDs corretos conforme sua solicitação de ordem
                    if(data.faturamentoDate) revealData('faturamentoDate', formatCurrency(data.faturamentoDate));
                    if(data.lucroDate) revealData('lucroDate', formatCurrency(data.lucroDate));
                    if(data.ticketLJDate) revealData('ticketLJDate', formatCurrency(data.ticketLJDate));
                    if(data.boletosPayDate) revealData('boletosPayDate', formatCurrency(data.boletosPayDate));
                });

            // --- Gráfico ---
            fetch('https://script.google.com/macros/s/AKfycbzbeCWhW4cyixLvkvpYYpv1UK72CfLYQblJv8jWSPPSSHFzNehv0vW5vLjHZrua-qeMJg/exec')
                .then(res => res.json())
                .then(data => {
                    const chartEl = document.getElementById('revenueChart');
                    
                    if (data && data.length > 0 && chartEl) {
                        chartEl.classList.remove('skeleton', 'bg-slate-50'); // Remove skeleton do gráfico
                        chartEl.classList.add('animate-fade-in'); // Adiciona fade-in
                        
                        const sortedData = data.sort((a, b) => new Date(a.dia) - new Date(b.dia)).slice(-7);
                        
                        const options = {
                            chart: {
                                type: 'area',
                                height: '100%',
                                toolbar: { show: false },
                                fontFamily: 'Inter, sans-serif',
                                zoom: { enabled: false }
                            },
                            series: [{
                                name: 'Receita',
                                data: sortedData.map(d => d.faturamento)
                            }],
                            colors: ['#3b82f6'],
                            fill: {
                                type: 'gradient',
                                gradient: {
                                    shadeIntensity: 1,
                                    opacityFrom: 0.4,
                                    opacityTo: 0.05,
                                    stops: [0, 100]
                                }
                            },
                            dataLabels: { enabled: false },
                            stroke: { curve: 'smooth', width: 2 },
                            xaxis: {
                                categories: sortedData.map(d => new Date(d.dia).toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' })),
                                axisBorder: { show: false },
                                axisTicks: { show: false },
                                labels: { style: { colors: '#94a3b8', fontSize: '12px' } }
                            },
                            yaxis: {
                                labels: { 
                                    formatter: (val) => `R$ ${val >= 1000 ? (val/1000).toFixed(1) + 'k' : val}`,
                                    style: { colors: '#94a3b8', fontSize: '12px' } 
                                }
                            },
                            grid: {
                                show: true,
                                borderColor: '#f1f5f9',
                                strokeDashArray: 4,
                                xaxis: { lines: { show: false } } 
                            },
                            tooltip: {
                                theme: 'light',
                                y: { formatter: (val) => formatCurrency(val) }
                            }
                        };
                        
                        new ApexCharts(chartEl, options).render();
                    }
                });

            // --- Sidebar ---
            const toggleButton = document.getElementById('sidebarToggle');
            const body = document.querySelector('body');
            const logoutButton = document.getElementById('logout-btn');

            if (toggleButton) {
                toggleButton.addEventListener('click', () => {
                    body.classList.toggle('sidebar-collapsed');
                });
            }
            
            if (logoutButton) {
                logoutButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    localStorage.removeItem('session_token');
                    window.location.href = '/users/e-finance.html';
                });
            }
        });
    </script>
</body>
</html>