<!DOCTYPE html>
<html lang="pt-br" data-view="mobile">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja ELETRO | D'TUDO</title>
    <link rel="icon" href="/assets/img/iconWeb.png">

    <!-- Bibliotecas Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href='https://cdn-uicons.flaticon.com/2.6.0/uicons-solid-straight/css/uicons-solid-straight.css'
        rel='stylesheet'>
    <link href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'
        rel='stylesheet'>

    <!-- Estilos Unificados e Main -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/style26.css">

    <style>
        body {
            background-color: #f8f9fa;
            /* Consistent background */
            font-family: 'Inter', sans-serif;
            font-family: 'Inter', sans-serif;
            padding-bottom: 90px;
        }

        .product-card {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }

        .product-card:active {
            transform: scale(0.98);
        }

        .highlight-price {
            color: var(--bs-color);
            font-weight: 800;
        }

        .rent-badge {
            background-color: #e0f2fe;
            color: var(--main);
            border-radius: 8px;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 600;
        }

        .trust-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: #16a34a;
            background: #dcfce7;
            padding: 4px 10px;
            border-radius: 20px;
            width: fit-content;
        }

        /* Grid Layout */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .product-card {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            padding: 16px;
            margin-bottom: 0;
            /* Reset margin for grid */
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Cart Badge */
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444;
            color: white;
            font-size: 10px;
            font-weight: bold;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }
    </style>
</head>

<body>

    <!-- Header Simples -->
    <header
        class="fixed top-0 w-full bg-white/90 backdrop-blur-md z-50 px-6 py-4 shadow-sm flex items-center justify-between">
        <div class="flex items-center gap-3" onclick="window.history.back()">
            <i class='bx bx-arrow-back text-2xl text-gray-700 cursor-pointer'></i>
            <div>
                <h1 class="text-lg font-bold text-gray-800 tracking-wide">ELETRO</h1>
                <p class="text-[10px] text-gray-400 font-medium tracking-wider uppercase">Loja Oficial</p>
            </div>
        </div>
    </header>

    <div id="shop-page" class="pt-24 px-4 max-w-[600px] mx-auto animate-[fadeIn_0.3s_ease] pb-32">

        <!-- User Profile (Minimalist) -->
        <div class="bg-white rounded-3xl p-4 shadow-sm mb-6 border border-gray-100 w-full">
            <div class="flex items-center gap-3">
                <div
                    class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 font-bold text-lg border border-gray-200">
                    NU
                </div>
                <div>
                    <h2 class="text-base font-bold text-blue-900 leading-tight">Nubia</h2>
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest font-bold">A N F da Silva LTDA</p>
                    <p class="text-[10px] grid font-mono text-gray-400">CNPJ: 45.692.327/0001-00</p>
                </div>
            </div>

            <div class="mt-3 flex items-center gap-3 bg-gray-50 rounded-xl p-3 border border-gray-100">
                <div
                    class="w-10 h-10 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-600 shadow-sm">
                    <i class='bx bx-coin-stack text-xl'></i>
                </div>
                <div>
                    <p class="text-[10px] text-gray-400 uppercase font-bold tracking-wider">Saldo Cashback</p>
                    <p class="text-lg font-bold text-gray-800">R$ 0,00</p>
                </div>
            </div>
        </div>

        <!-- Seção: Uso em loja -->
        <div class="mb-4 mt-6">
            <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest px-2">Uso em loja</h3>
        </div>

        <div class="product-grid">
            <!-- Produto 1: Leitor Fixo (Existing) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2 overflow-hidden">
                    <img src="https://http2.mlstatic.com/D_Q_NP_669652-MLA99474119254_112025-O.webp"
                        class="h-full max-w-full object-contain mix-blend-multiply">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">Leitor
                        Código De Barras Fixo Basic-model</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-[10px] text-gray-400 line-through">R$ 234,90</p>
                    <p class="text-sm highlight-price text-black mb-2">R$ 234,90 <span
                            class="text-[10px] font-normal text-gray-500">ou 2x</span></p>
                    <button
                        onclick="addToCart('Leitor Fixo Basic-model', 234.90, 'https://http2.mlstatic.com/D_Q_NP_669652-MLA99474119254_112025-O.webp', 2, 16.90)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                    <!-- Rent Tag -->
                    <div class="mt-2 text-center bg-gray-50 rounded py-1 border border-gray-100">
                        <span class="text-[10px] text-blue-600 font-bold">Aluguel: R$ 16,90</span>
                    </div>
                </div>
            </div>

            <!-- Produto: Leitor Baisec (New) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_2X_751925-MLB78325191660_082024-F.webp"
                        class="h-full object-contain mix-blend-multiply">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">Leitor De
                        Codigo De Barras Com Fio Baisec</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-sm highlight-price text-black mb-2">R$ 97,90 <span
                            class="text-[10px] font-normal text-gray-500">ou 2x</span></p>
                    <button
                        onclick="addToCart('Leitor Com Fio Baisec', 97.90, 'https://http2.mlstatic.com/D_NQ_NP_2X_751925-MLB78325191660_082024-F.webp', 2, 9.90)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                    <div class="mt-2 text-center bg-gray-50 rounded py-1 border border-gray-100">
                        <span class="text-[10px] text-blue-600 font-bold">Aluguel: R$ 9,90</span>
                    </div>
                </div>
            </div>

            <!-- Produto: Leitor Exbom (New) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_2X_664423-MLA99533126136_122025-F.webp"
                        class="h-full object-contain mix-blend-multiply">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">Leitor De
                        Código De Barra Com Fio Exbom</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-sm highlight-price text-black mb-2">R$ 117,49 <span
                            class="text-[10px] font-normal text-gray-500">ou 2x</span></p>
                    <button
                        onclick="addToCart('Leitor Exbom PCB-150', 117.49, 'https://http2.mlstatic.com/D_NQ_NP_2X_664423-MLA99533126136_122025-F.webp', 2, 11.90)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                    <div class="mt-2 text-center bg-gray-50 rounded py-1 border border-gray-100">
                        <span class="text-[10px] text-blue-600 font-bold">Aluguel: R$ 11,90</span>
                    </div>
                </div>
            </div>

            <!-- Produto: Kit PC (Existing) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2">
                    <img src="https://m.magazineluiza.com.br/a-static/420x420/computador-completo-intel-core-i5-8gb-hd-500gb-monitor-hdmi-19-5-windows-10-quantum-flex/3greentechnology/39851/1fc652c085a4844458a3cd9e01f200ab.jpeg"
                        class="h-full object-contain mix-blend-multiply">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">Kit
                        Computador p/ Ponto de Venda</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-[10px] text-gray-400 line-through">R$ 1.300,90</p>
                    <p class="text-sm highlight-price text-black mb-2">R$ 1.097,90 <span
                            class="text-[10px] font-normal text-gray-500">ou 4x</span></p>
                    <button
                        onclick="addToCart('Kit Computador PDV', 1097.90, 'https://m.magazineluiza.com.br/a-static/420x420/computador-completo-intel-core-i5-8gb-hd-500gb-monitor-hdmi-19-5-windows-10-quantum-flex/3greentechnology/39851/1fc652c085a4844458a3cd9e01f200ab.jpeg', 4)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                </div>
            </div>

            <!-- Produto: Leitor Knup (New) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_2X_910337-MLA95493924308_102025-F.webp"
                        class="h-full object-contain mix-blend-multiply">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">Leitor De
                        Código De Barras Knup</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-sm highlight-price text-black mb-2">R$ 159,90 <span
                            class="text-[10px] font-normal text-gray-500">ou 2x</span></p>
                    <button
                        onclick="addToCart('Leitor Knup Com Suporte', 159.90, 'https://http2.mlstatic.com/D_NQ_NP_2X_910337-MLA95493924308_102025-F.webp', 2, 14.20)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                    <div class="mt-2 text-center bg-gray-50 rounded py-1 border border-gray-100">
                        <span class="text-[10px] text-blue-600 font-bold">Aluguel: R$ 14,20</span>
                    </div>
                </div>
            </div>

            <!-- Produto: Camera Kateluo (New) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_2X_711866-MLA101431313907_122025-F.webp"
                        class="h-full object-contain mix-blend-multiply">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">Câmera De
                        Segurança Smart Ip Wifi</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-[10px] text-gray-400 line-through">R$ 155,79</p>
                    <p class="text-sm highlight-price text-black mb-2">R$ 134,90</p>
                    <button
                        onclick="addToCart('Câmera Smart Ip Wifi Kateluo', 134.90, 'https://http2.mlstatic.com/D_NQ_NP_2X_711866-MLA101431313907_122025-F.webp', 1)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                </div>
            </div>

            <!-- Produto: Leitor Sem Fio (Existing) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2">
                    <img src="https://images.tcdn.com.br/img/img_prod/1214924/leitor_de_codigo_de_barra_sem_fio_a_1484_24110_2_6d75d135ebccafeb787ef6452efded8b.jpg"
                        class="h-full object-contain mix-blend-multiply">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">Leitor Sem
                        Fio Livre-Avance</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-[10px] text-gray-400 line-through">R$ 199,99</p>
                    <p class="text-sm highlight-price text-black mb-2">R$ 199,99 <span
                            class="text-[10px] font-normal text-gray-500">ou 2x</span></p>
                    <button
                        onclick="addToCart('Leitor Sem Fio Livre-Avance', 199.99, 'https://images.tcdn.com.br/img/img_prod/1214924/leitor_de_codigo_de_barra_sem_fio_a_1484_24110_2_6d75d135ebccafeb787ef6452efded8b.jpg', 2, 12.90)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                    <div class="mt-2 text-center bg-gray-50 rounded py-1 border border-gray-100">
                        <span class="text-[10px] text-blue-600 font-bold">Aluguel: R$ 12,90</span>
                    </div>
                </div>
            </div>

            <!-- Produto: Bobina (Existing) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_2X_884338-MLB92318976611_092025-F.webp"
                        class="h-full object-contain mix-blend-multiply">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">6 Rolos
                        Bobina Epson Tm-t20x</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-[10px] text-gray-400 line-through">R$ 99,90</p>
                    <p class="text-sm highlight-price text-black mb-2">R$ 87,90</p>
                    <button
                        onclick="addToCart('6 Rolos Bobina Epson Tm-t20x', 87.90, 'https://http2.mlstatic.com/D_NQ_NP_2X_884338-MLB92318976611_092025-F.webp', 1)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                </div>
            </div>

            <!-- Produto: Teclado (Existing) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2">
                    <img src="https://http2.mlstatic.com/D_Q_NP_735713-MLA99973706633_112025-F.webp"
                        class="h-full object-contain mix-blend-multiply">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">Kit
                        Teclado e Mouse Logtech</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-[10px] text-gray-400 line-through">R$ 179,90</p>
                    <p class="text-sm highlight-price text-black mb-2">R$ 164,90</p>
                    <button
                        onclick="addToCart('Kit Teclado e Mouse Logtech', 164.90, 'https://http2.mlstatic.com/D_Q_NP_735713-MLA99973706633_112025-F.webp', 1)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                </div>
            </div>

            <!-- Produto: Crachá (Existing) -->
            <div class="product-card">
                <div
                    class="w-full h-32 bg-white rounded-lg flex items-center justify-center mb-3 border border-gray-100 p-2">
                    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjfF_2HVi3Cb--rTz-wnIG5NobrMX3oid8J0cecE_wOcqhF1rsibATsVTnThQshupdNtvPeTO1LETgWiMgGhNXTlVpLHO0Na-iGcO-GAdXmbEwolZFun8hI7rNdZ_6JOuW03ZR8EkAK_z8QRqHpGZn5Wo9EbVGj21_e0MSy1CJRwf1pVmV-bOXvaCDnIxY"
                        class="h-full object-cover">
                </div>
                <div class="flex-1">
                    <h2 class="text-xs font-bold text-gray-800 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">Crachá
                        Personalizado D'Tudo</h2>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-100">
                    <p class="text-sm highlight-price text-black mb-2">R$ 29,90 <span
                            class="text-[10px] font-normal text-gray-500">un</span></p>
                    <button
                        onclick="addToCart('Crachá Personalizado', 29.90, 'https://blogger.googleusercontent.com/img/a/AVvXsEjfF_2HVi3Cb--rTz-wnIG5NobrMX3oid8J0cecE_wOcqhF1rsibATsVTnThQshupdNtvPeTO1LETgWiMgGhNXTlVpLHO0Na-iGcO-GAdXmbEwolZFun8hI7rNdZ_6JOuW03ZR8EkAK_z8QRqHpGZn5Wo9EbVGj21_e0MSy1CJRwf1pVmV-bOXvaCDnIxY', 1)"
                        class="w-full bg-blue-900 text-white py-1.5 rounded-lg text-xs font-bold shadow-sm hover:opacity-90">
                        Adicionar
                    </button>
                </div>
            </div>
        </div>

        <!-- Seção: Revenda -->
        <div class="mt-8 mb-4">
            <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest px-2">Revenda</h3>


            <!-- Revenda Produto 1 -->
            <div class="product-card mt-4">
                <div class="mb-4 flex gap-4">
                    <div
                        class="w-24 h-24 bg-white rounded-lg flex items-center justify-center p-2 border border-gray-100">
                        <img src="https://lojavisual.com/cdn/shop/files/D_NQ_NP_2X_884817-MLB92511831611_092025-F-kit-36-canetinhas-ponta-dupla-coloridas-para-desenho.webp?v=1757968127"
                            class="w-full h-full object-contain mix-blend-multiply">
                    </div>
                    <div class="flex-1">
                        <h2 class="text-sm font-bold text-gray-800 leading-tight mb-1">Canetinha Touch 36 Un</h2>
                        <p class="text-[10px] text-blue-600 mb-1 font-bold"><i class='bx bxs-badge-check'></i> SUPREO
                        </p>
                        <p class="text-[9px] text-gray-400 mb-2">+500mil vendas | a pronta entrega</p>
                    </div>
                </div>

                <div class="border-t border-gray-100 pt-3">
                    <div class="flex justify-between items-end">
                        <div>
                            <p class="text-[10px] text-gray-400">Limite: 1 unidade</p>
                            <p class="text-lg highlight-price text-black">R$ 23,90 <span
                                    class="text-xs text-gray-500 font-normal">un</span></p>
                        </div>
                        <button onclick="comprarProduto('Canetinha Touch 36 Un (Promo)', 23.90, false, 1, true)"
                            class="bg-blue-900 text-white px-4 py-2 rounded-lg text-xs font-bold shadow-md hover:opacity-90 transition-opacity">
                            Comprar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Revenda Produto 2 -->
            <div class="product-card mt-4">
                <div class="mb-4 flex gap-4">
                    <div
                        class="w-24 h-24 bg-white rounded-lg flex items-center justify-center p-2 border border-gray-100">
                        <img src="https://lojavisual.com/cdn/shop/files/D_NQ_NP_2X_884817-MLB92511831611_092025-F-kit-36-canetinhas-ponta-dupla-coloridas-para-desenho.webp?v=1757968127"
                            class="w-full h-full object-contain mix-blend-multiply">
                    </div>
                    <div class="flex-1">
                        <h2 class="text-sm font-bold text-gray-800 leading-tight mb-1">Canetinha Touch 36 Un</h2>
                        <p class="text-[10px] text-blue-600 mb-1 font-bold"><i class='bx bxs-badge-check'></i> SUPREO
                        </p>
                        <p class="text-[9px] text-gray-400 mb-2">+500mil vendas</p>
                    </div>
                </div>

                <div class="border-t border-gray-100 pt-3">
                    <div class="flex justify-between items-end">
                        <div>
                            <p class="text-[10px] text-gray-400">Limite: 5 unidades</p>
                            <p class="text-lg highlight-price text-black">R$ 24,90 <span
                                    class="text-xs text-gray-500 font-normal">un</span></p>
                        </div>
                        <button onclick="comprarProduto('Canetinha Touch 36 Un', 24.90, false, 5, false)"
                            class="bg-blue-900 text-white px-4 py-2 rounded-lg text-xs font-bold shadow-md hover:opacity-90 transition-opacity">
                            Comprar
                        </button>
                    </div>
                </div>
            </div>
            <!-- Revenda Produto 3 -->
            <div class="product-card mt-4">
                <div class="mb-4 flex gap-4">
                    <div
                        class="w-24 h-24 bg-white rounded-lg flex items-center justify-center p-2 border border-gray-100">
                        <img src="https://www.papelariaartnova.com.br/img/products/caneta-marcador-permanente-ponta-dupla-estojo-c-48-cores-touch_1_600.png"
                            class="w-full h-full object-contain mix-blend-multiply">
                    </div>
                    <div class="flex-1">
                        <h2 class="text-sm font-bold text-gray-800 leading-tight mb-1">Canetinha Touch 48 Un</h2>
                        <p class="text-[10px] text-blue-600 mb-1 font-bold"><i class='bx bxs-badge-check'></i> SUPREO
                        </p>
                        <p class="text-[9px] text-gray-400 mb-2">+500mil vendas</p>
                    </div>
                </div>

                <div class="border-t border-gray-100 pt-3">
                    <div class="flex justify-between items-end">
                        <div>
                            <p class="text-[10px] text-gray-400">Limite: 5 unidades</p>
                            <p class="text-lg highlight-price text-black">R$ 29,90 <span
                                    class="text-xs text-gray-500 font-normal">un</span></p>
                        </div>
                        <button onclick="comprarProduto('Canetinha Touch 48 Un', 29.90, false, 5, false)"
                            class="bg-blue-900 text-white px-4 py-2 rounded-lg text-xs font-bold shadow-md hover:opacity-90 transition-opacity">
                            Comprar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container"
            style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 350px; pointer-events: none;">
        </div>

        <!-- Modal Pagamento -->
        <div id="modalPagamento" class="modal"
            style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 2000; align-items: flex-end; justify-content: center;">
            <div
                class="bg-white w-full max-w-[500px] rounded-t-3xl p-6 shadow-2xl animate-[slideInUp_0.3s_ease] relative">

                <!-- Close Button -->
                <button onclick="fecharModal()"
                    class="absolute top-4 right-4 p-2 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition-colors">
                    <i class='bx bx-x text-xl'></i>
                </button>

                <div class="text-center mb-6 mt-2">
                    <div
                        class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3 text-blue-600">
                        <i class='bx bx-check-shield text-2xl'></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800">Finalizar Compra</h2>
                    <p class="text-xs text-gray-500 mt-1">Ambiente seguro verificado</p>
                </div>

                <div class="bg-gray-50 p-4 rounded-xl mb-6 border border-gray-100">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Produto</p>
                            <h3 id="pagamento-descricao" class="text-sm font-semibold text-gray-800 leading-tight">...
                            </h3>
                        </div>
                    </div>
                    <div class="border-t border-gray-200 my-3"></div>
                    <div class="flex justify-between items-end">
                        <span class="text-xs font-medium text-gray-500">Total a pagar:</span>
                        <h2 id="pagamento-valor" class="text-2xl font-bold text-black leading-none">...</h2>
                    </div>
                </div>

                <div id="payment-area">
                    <div class="space-y-3">
                        <div class="flex items-center gap-3 p-3 border border-blue-200 bg-blue-50 rounded-lg">
                            <i class='bx bx-qr text-2xl text-blue-600'></i>
                            <div>
                                <p class="text-sm font-bold text-gray-800">Pix Instantâneo</p>
                                <p class="text-[10px] text-blue-700">Aprovação imediata</p>
                            </div>
                            <div class="ml-auto">
                                <i class='bx bxs-check-circle text-blue-600 text-lg'></i>
                            </div>
                        </div>
                    </div>

                    <button id="btnGerarPix" onclick="gerarPagamento()"
                        class="w-full mt-6 bg-[var(--bs-color)] text-white py-4 rounded-xl font-bold text-base shadow-lg hover:opacity-90 transition-all flex items-center justify-center gap-2">
                        <i class='bx bx-lock-alt'></i> Comprar Agora
                    </button>

                    <p class="text-[10px] text-center text-gray-400 mt-4 flex items-center justify-center gap-1">
                        <i class='bx bx-shield-quarter'></i> Seus dados estão protegidos.
                    </p>
                </div>
            </div>
        </div>
        <!-- Seção: Itens Adquiridos (Moved to Bottom) -->
        <div class="product-card mt-8 mb-6">
            <h3 class="text-xs font-bold text-gray-800 uppercase tracking-widest mb-4 border-b border-gray-100 pb-2">
                Itens Adquiridos</h3>

            <!-- Item 1 -->
            <div class="flex items-center gap-4 py-3 border-b border-gray-50 last:border-0">
                <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-600">
                    <i class='bx bx-barcode text-xl'></i>
                </div>
                <div class="flex-1">
                    <h4 class="text-sm font-bold text-gray-800">Leitor de código de Barras c/fio</h4>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="text-xs text-gray-400 line-through">Mensal: R$ 13,90</span>
                        <span class="text-xs font-bold text-blue-600">R$ 0,00</span>
                    </div>
                    <p class="text-[10px] text-blue-500 font-medium mt-2">Benefício de subsídio | Gilvan</p>
                </div>
                <div class="text-right">
                    <p class="text-sm font-bold text-gray-800">R$ 99,90</p>
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">Adquirido</span>
                </div>
            </div>

            <!-- Item 2 -->
            <div class="flex items-center gap-4 py-3">
                <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-600">
                    <i class='bx bx-purchase-tag-alt text-xl'></i>
                </div>
                <div class="flex-1">
                    <h4 class="text-sm font-bold text-gray-800">Etiquetadora de preços</h4>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="text-xs text-gray-400 line-through">Mensal: R$ 9,90</span>
                        <span class="text-xs font-bold text-blue-600">R$ 0,00</span>
                    </div>
                    <p class="text-[10px] text-blue-500 font-medium mt-2">Benefício de subsídio | Gilvan</p>
                </div>
                <div class="text-right">
                    <p class="text-sm font-bold text-gray-800">R$ 79,90</p>
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">Adquirido</span>
                </div>
            </div>
        </div>
    </div> <!-- End of Shop Page -->

    <!-- Orders Page -->
    <div id="orders-page" class="pt-24 px-4 max-w-[600px] mx-auto hidden animate-[fadeIn_0.3s_ease]">

        <h2 class="text-lg font-bold text-gray-800 mb-4 px-2">Meus Pedidos</h2>

        <div id="dynamic-orders"></div>

        <!-- Order 1 -->
        <div class="bg-white rounded-2xl p-5 shadow-sm mb-4 border border-gray-100">
            <div class="flex gap-4">
                <div class="w-16 h-16 bg-blue-50 rounded-xl flex items-center justify-center text-blue-500">
                    <i class='bx bx-cube text-2xl'></i>
                </div>
                <div class="flex-1">
                    <p class="text-[10px] uppercase font-bold text-blue-900 mb-1 tracking-wide">Em Trânsito</p>
                    <h3 class="text-sm font-bold text-gray-800 leading-tight">ELETRO • Suporte A.AQUA V83B PT</h3>
                    <p class="text-xs text-gray-500 mt-1">2x R$ 114,95</p>
                </div>
            </div>

            <div class="mt-4 pt-4 border-t border-gray-100">
                <div class="flex items-start gap-3">
                    <div class="flex flex-col items-center gap-1 mt-1">
                        <div class="w-2 h-2 rounded-full bg-gray-300"></div>
                        <div class="w-0.5 h-6 bg-gray-200"></div>
                        <div class="w-2 h-2 rounded-full bg-blue-600"></div>
                    </div>
                    <div class="flex-1 space-y-4">
                        <div>
                            <p class="text-xs font-bold text-gray-700">Localização Atual</p>
                            <p class="text-xs text-gray-500">Galpão Logístico em Belém</p>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-gray-700">Previsão de Entrega</p>
                            <p class="text-xs text-gray-500">16 a 19 de fevereiro</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order 2 -->
        <div class="bg-white rounded-2xl p-5 shadow-sm mb-4 border border-gray-100 opacity-80">
            <div class="flex gap-4">
                <div class="w-16 h-16 bg-gray-100 rounded-xl flex items-center justify-center text-gray-500">
                    <i class='bx bx-check text-2xl'></i>
                </div>
                <div class="flex-1">
                    <p class="text-[10px] uppercase font-bold text-gray-500 mb-1 tracking-wide">Entregue</p>
                    <h3 class="text-sm font-bold text-gray-800 leading-tight">Adaptador Bluetooth Conector Pc</h3>
                    <p class="text-xs text-gray-500 mt-1">R$ 35,00</p>
                </div>
            </div>

            <div class="mt-4 pt-4 border-t border-gray-100">
                <div class="mb-3">
                    <p class="text-xs font-bold text-gray-700">Entregue em:</p>
                    <p class="text-xs text-gray-500">D'Tudo Variedades, Jarbas Passarinho, Ipixuna do Pará.</p>
                </div>
                <div>
                    <p class="text-xs font-bold text-gray-700">Local da nota fiscal:</p>
                    <div class="flex items-center gap-2 mt-1">
                        <i class='bx bxs-file-pdf text-blue-900'></i>
                        <span class="text-xs text-gray-500">Nota Fiscal (R$ 35,00)</span>
                        <span class="text-xs text-gray-500">Nota Fiscal (R$ 35,00)</span>
                        <button onclick="openInvoice()"
                            class="text-[10px] font-bold text-blue-600 uppercase ml-auto hover:underline cursor-pointer bg-transparent border-none p-0">Visualizar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Page (New) -->
    <div id="cart-page" class="pt-24 px-4 max-w-[600px] mx-auto hidden animate-[fadeIn_0.3s_ease]">
        <!-- Cart Content Will Be Injected Here via JS -->
    </div>

    <!-- Floating Navbar -->
    <div
        class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-md border border-white/20 shadow-xl rounded-full px-5 py-3 flex items-center gap-6 z-40">
        <button onclick="switchPage('shop')" id="nav-shop"
            class="flex flex-col items-center gap-1 text-blue-900 transition-colors">
            <i class='bx bx-store text-2xl'></i>
        </button>

        <div class="w-px h-6 bg-gray-200"></div>

        <button onclick="switchPage('cart')" id="nav-cart"
            class="relative flex flex-col items-center gap-1 text-gray-400 hover:text-blue-900 transition-colors">
            <i class='bx bx-basket text-2xl'></i>
            <span id="cart-count" class="cart-badge hidden">0</span>
        </button>

        <div class="w-px h-6 bg-gray-200"></div>

        <button onclick="switchPage('orders')" id="nav-orders"
            class="flex flex-col items-center gap-1 text-gray-400 hover:text-blue-900 transition-colors">
            <i class='bx bx-map-alt text-2xl'></i>
        </button>
    </div>

    <!-- Purchase Animation Overlay -->
    <div id="purchase-overlay" class="fixed inset-0 z-[3000] hidden items-center justify-center overflow-hidden">
        <!-- Expanding Sphere -->
        <div id="purchase-sphere"
            class="absolute w-10 h-10 bg-blue-900 rounded-full transform scale-0 transition-transform duration-700 ease-in-out">
        </div>

        <!-- Content -->
        <div id="purchase-content"
            class="relative z-10 flex flex-col items-center text-white opacity-0 transition-opacity duration-500 delay-300">
            <h2 class="text-3xl font-bold text-center px-4">Já é quase seu...</h2>
            <div class="mt-6 w-12 h-12 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
        </div>
    </div>

    <!-- Invoice Modal Removed (Opened in new tab instead) -->

    <script>
        let cart = [];
        const toastContainer = document.getElementById('toast-container');

        // ... (existing code remains until utils) ...

        // Helper to render the specific Cart UI into the modal (Obsolete)

        // --- Core Logic ---


        function calculateProRata(monthlyPrice) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();
            let targetDate = new Date(currentYear, currentMonth, 23);
            targetDate.setHours(0, 0, 0, 0);

            if (today.getTime() > targetDate.getTime()) {
                targetDate = new Date(currentYear, currentMonth + 1, 23);
                targetDate.setHours(0, 0, 0, 0);
            }

            const diffTime = Math.abs(targetDate - today);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const dailyRate = monthlyPrice / 30;
            return {
                days: diffDays,
                price: dailyRate * diffDays
            };
        }

        function addToCart(name, price, img, maxInstallments = 1, rentPrice = 0) {
            const id = Date.now().toString(36) + Math.random().toString(36).substr(2);
            cart.push({
                id,
                name,
                basePrice: price,
                img,
                maxInstallments,
                rentPrice,
                type: 'buy', // 'buy' or 'rent'
                installments: 1, // 1 to maxInstallments
                quantity: 1
            });
            updateCartIcon();
            showToast('Adicionado ao carrinho!', 'success');
        }

        // Adapter for Legacy calls (Revenda Section)
        function comprarProduto(nome, valor, isRental, maxQty, allowInstallments) {
            addToCart(nome, valor, '', allowInstallments ? 2 : 1, 0);
        }

        function updateCartIcon() {
            const el = document.getElementById('cart-count');
            const nav = document.getElementById('nav-cart');
            el.innerText = cart.length;
            if (cart.length > 0) {
                el.classList.remove('hidden');
                nav.classList.add('text-blue-900');
                nav.classList.remove('text-gray-400');
            } else {
                el.classList.add('hidden');
                nav.classList.remove('text-blue-900');
                nav.classList.add('text-gray-400');
            }
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            renderCartItems();
            updateCartIcon();
        }

        function updateItemType(id, type) {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.type = type;
                item.installments = 1; // Reset installments on type change
                renderCartItems(); // Re-render to show/hide installment selector
            }
        }

        function updateItemInstallments(id, n) {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.installments = parseInt(n);
                renderCartItems(); // Re-render to update totals
            }
        }

        // --- Cart Modal & rendering ---

        // --- Cart Page & Rendering ---

        function switchPage(page) {
            const shopPage = document.getElementById('shop-page');
            const ordersPage = document.getElementById('orders-page');
            const cartPage = document.getElementById('cart-page');

            const navShop = document.getElementById('nav-shop');
            const navOrders = document.getElementById('nav-orders');
            const navCart = document.getElementById('nav-cart');

            // Reset
            [shopPage, ordersPage, cartPage].forEach(el => el && el.classList.add('hidden'));
            [navShop, navOrders, navCart].forEach(el => {
                if (el) {
                    el.classList.remove('text-blue-900');
                    el.classList.add('text-gray-400');
                }
            });

            // Active
            if (page === 'shop') {
                shopPage.classList.remove('hidden');
                navShop.classList.add('text-blue-900');
                navShop.classList.remove('text-gray-400');
            } else if (page === 'orders') {
                ordersPage.classList.remove('hidden');
                navOrders.classList.add('text-blue-900');
                navOrders.classList.remove('text-gray-400');
            } else if (page === 'cart') {
                cartPage.classList.remove('hidden');
                navCart.classList.add('text-blue-900');
                navCart.classList.remove('text-gray-400');
                renderCartPage(); // Ensure render on switch
            }
        }

        // Helper to render the specific Cart UI into the full page
        function renderCartPage() {
            const container = document.getElementById('cart-page');

            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-8 mt-10 animate-[fadeIn_0.5s_ease]">
                        <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 text-blue-200">
                             <i class='bx bx-basket text-5xl'></i>
                        </div>
                        <h2 class="text-xl font-bold text-gray-800 mb-3">Seu carrinho está vazio</h2>
                        <p class="text-gray-500 mb-8 text-sm px-8">Adicione produtos para ver as melhores ofertas e cashbacks disponíveis para você.</p>
                        <button onclick="switchPage('shop')" class="px-8 py-3 bg-blue-900 text-white rounded-xl font-bold text-sm shadow-lg hover:bg-blue-800 transition-all transform hover:scale-105">
                            Começar a comprar
                        </button>
                    </div>
                 `;
                return;
            }

            let itemsHtml = '';
            let totalDueNow = 0;
            let totalCashback = 0;

            cart.forEach(item => {
                let itemTotal = 0;
                let detailsHtml = '';

                if (item.type === 'rent') {
                    const proRata = calculateProRata(item.rentPrice);
                    itemTotal = proRata.price;
                    detailsHtml = `
                        <div class="bg-blue-50 rounded px-2 py-1 mt-2 inline-flex items-center gap-2">
                             <i class='bx bx-calendar text-blue-600'></i>
                             <div>
                                <p class="text-[10px] text-blue-800 font-bold">Aluguel Pro-rata: ${itemTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>
                                <p class="text-[9px] text-blue-500">Mensal: ${item.rentPrice.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>
                             </div>
                        </div>
                    `;
                    totalDueNow += itemTotal;
                } else {
                    // Buy
                    const price = item.basePrice;

                    if (item.installments === 1) {
                        // Full Price
                        itemTotal = price;

                        // Cashback Logic: Only if item supports > 1 installment (meaning not restricted)
                        if (item.maxInstallments > 1) {
                            const cashback = price * 0.02; // 2% Cashback
                            totalCashback += cashback;
                            detailsHtml = `
                                <div class="mt-2">
                                    <p class="text-sm font-bold text-gray-800">${itemTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>
                                    <div class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-lg text-[10px] font-bold inline-flex items-center gap-1 mt-1 border border-yellow-200">
                                        <i class='bx bx-coin-stack text-yellow-600'></i> Ganhe +${cashback.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} de Cashback
                                    </div>
                                </div>
                             `;
                        } else {
                            // Restricted to 1x (no cashback)
                            detailsHtml = `<p class="text-sm font-bold text-gray-800 mt-2">${itemTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>`;
                        }
                    } else {
                        // Installments
                        itemTotal = price / item.installments;
                        detailsHtml = `<p class="text-sm font-bold text-gray-800 mt-2">${item.installments}x de ${itemTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>`;
                    }
                    totalDueNow += itemTotal;
                }

                // Controls
                let typeSelect = '';
                if (item.rentPrice > 0) {
                    typeSelect = `
                        <select onchange="updateItemType('${item.id}', this.value)" class="text-[10px] border border-gray-200 rounded px-2 py-1 bg-white text-gray-700 font-bold focus:outline-none focus:border-blue-500 shadow-sm h-8">
                            <option value="buy" ${item.type === 'buy' ? 'selected' : ''}>Comprar</option>
                            <option value="rent" ${item.type === 'rent' ? 'selected' : ''}>Alugar</option>
                        </select>
                     `;
                }

                let installSelect = '';
                if (item.type === 'buy' && item.maxInstallments > 1) {
                    let opts = '';
                    for (let i = 1; i <= item.maxInstallments; i++) {
                        opts += `<option value="${i}" ${item.installments === i ? 'selected' : ''}>${i}x</option>`;
                    }
                    installSelect = `
                        <select onchange="updateItemInstallments('${item.id}', this.value)" class="text-[10px] border border-gray-200 rounded px-2 py-1 bg-white text-gray-700 font-bold ml-2 focus:outline-none focus:border-blue-500 shadow-sm h-8">
                            ${opts}
                        </select>
                    `;
                }

                itemsHtml += `
                    <div class="flex gap-4 p-4 bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition-all animate-[fadeIn_0.3s_ease]">
                        <div class="w-16 h-16 bg-white rounded-xl border border-gray-100 flex items-center justify-center p-1 shrink-0 overflow-hidden shadow-inner">
                             ${item.img ? `<img src="${item.img}" class="w-full h-full object-contain">` : `<i class='bx bx-package text-gray-300 text-2xl'></i>`}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="text-sm font-bold text-gray-800 line-clamp-2 leading-snug">${item.name}</h4>
                                <button onclick="removeFromCart('${item.id}')" class="text-gray-400 hover:text-red-500 p-1 -mt-1 -mr-1"><i class='bx bx-trash'></i></button>
                            </div>
                            
                            <div class="flex flex-wrap items-center gap-2 mb-1">
                                ${typeSelect}
                                ${installSelect}
                            </div>
                            
                            ${detailsHtml}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = `
                <div class="flex items-center justify-between mb-6">
                     <h2 class="text-xl font-bold text-gray-800">Meu Carrinho</h2>
                     <span class="bg-blue-100 text-blue-800 text-xs font-bold px-3 py-1 rounded-full">${cart.length} item(s)</span>
                </div>

                <div class="space-y-4 mb-32">
                    ${itemsHtml}
                    
                    <div class="bg-white p-6 rounded-3xl shadow-lg border border-gray-100 mt-8">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-500">Valor dos produtos</span>
                            <span class="text-sm font-bold text-gray-800">${totalDueNow.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
                        </div>
                        
                        ${totalCashback > 0 ? `
                        <div class="flex justify-between items-center mb-4 bg-yellow-50 p-3 rounded-xl border border-yellow-100">
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 rounded-full bg-yellow-200 flex items-center justify-center text-yellow-700 text-xs">
                                    <i class='bx bx-coin-stack'></i>
                                </div>
                                <span class="text-xs text-yellow-800 font-bold">Cashback a receber</span>
                            </div>
                            <span class="text-sm font-bold text-yellow-700">+${totalCashback.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
                        </div>
                        ` : ''}
                        
                        <div class="border-t border-gray-100 my-4"></div>
                        
                        <div class="flex justify-between items-end mb-6">
                            <span class="text-sm font-medium text-gray-600">Total a Pagar</span>
                            <h2 class="text-2xl font-bold text-blue-900 leading-none">${totalDueNow.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</h2>
                        </div>
                        
                         <div id="payment-area">
                            <button id="btnGerarPix" onclick="startPurchaseAnimation()" class="w-full bg-blue-900 text-white py-4 rounded-xl font-bold text-base shadow-xl shadow-blue-200 hover:shadow-blue-300 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                                <i class='bx bx-lock-alt'></i> Pagar com Pix
                            </button>
                        </div>
                        
                        <p class="text-[10px] text-center text-gray-400 mt-4 flex items-center justify-center gap-1">
                            <i class='bx bx-shield-quarter'></i> Pagamento processado com segurança
                        </p>
                    </div>
                </div>
            `;
        }

        function renderCartItems() {
            renderCartPage();
        }

        // --- Payment Generation (Bulk) ---

        async function startPurchaseAnimation() {
            // Animation logic reusing existing structure elements
            // Note: need to ensure the overlay divs exist in HTML (they do)
            const overlay = document.getElementById('purchase-overlay');
            const sphere = document.getElementById('purchase-sphere');
            const content = document.getElementById('purchase-content');

            sphere.style.transform = 'scale(0)';
            content.classList.remove('opacity-100');
            content.classList.add('opacity-0');
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
            void sphere.offsetWidth;
            sphere.style.transform = 'scale(150)';

            setTimeout(() => {
                content.classList.remove('opacity-0');
                content.classList.add('opacity-100');
            }, 100);

            await new Promise(resolve => setTimeout(resolve, 3000));
            content.classList.remove('opacity-100');
            content.classList.add('opacity-0');

            await gerarPagamento();

            setTimeout(() => {
                sphere.style.transform = 'scale(0)';
                setTimeout(() => {
                    overlay.classList.add('hidden');
                    overlay.classList.remove('flex');
                }, 700);
            }, 300);
        }

        async function gerarPagamento() {
            const area = document.getElementById('payment-area');
            area.innerHTML = `<button class="w-full bg-gray-50 text-gray-400 py-4 rounded-xl font-bold text-base flex items-center justify-center gap-2 cursor-wait shadow-inner"><i class='bx bx-loader-alt bx-spin'></i> Criando QR Code...</button>`;

            let totalAmount = 0;
            let description = [];

            cart.forEach(item => {
                let val = 0;
                if (item.type === 'rent') {
                    val = calculateProRata(item.rentPrice).price;
                    description.push(`Aluguel: ${item.name}`);
                } else {
                    val = (item.installments === 1) ? item.basePrice : (item.basePrice / item.installments);
                    description.push(`${item.name} (${item.installments}x)`);
                }
                totalAmount += val;
            });

            try {
                const orderId = 'ORD-' + Math.floor(Math.random() * 100000);
                // Creating a simplified description for Pix
                const descStr = `Pedido ${orderId}`;

                const payload = {
                    transaction_amount: Number(totalAmount.toFixed(2)),
                    description: descStr,
                    payment_method_id: "pix",
                    payer: {
                        email: "cliente@eletrobusiness.com.br",
                        first_name: "Nubia",
                        last_name: "Silva",
                        identification: {
                            type: "CPF",
                            number: "19119119100"
                        }
                    }
                };

                // Use specific cloud function or direct MP integration if function fails
                // Assuming existing endpoint works as seen in previous code.
                // URL from previous file: 'https://us-central1-super-app25.cloudfunctions.net/createPayment'
                const res = await fetch('https://us-central1-super-app25.cloudfunctions.net/createPayment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await res.json();

                if (res.ok && (data.status === 'pending' || data.status === 'created' || data.point_of_interaction)) {
                    const qrCode = data.point_of_interaction.transaction_data.qr_code;
                    const qrBase64 = data.point_of_interaction.transaction_data.qr_code_base64;

                    area.innerHTML = `
                         <div class="text-center animate-[fadeIn_0.5s_ease]">
                            <div class="relative bg-white p-3 rounded-2xl mb-4 border border-blue-100 shadow-md inline-block">
                                <img src="data:image/png;base64,${qrBase64}" class="w-48 h-48 mx-auto rounded-lg mix-blend-multiply">
                            </div>
                            
                            <div class="flex gap-2 mb-4">
                                <div class="relative w-full">
                                    <input readonly value="${qrCode}" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-xs text-gray-500 font-mono text-center focus:outline-none">
                                    <div class="absolute right-0 top-0 h-full w-12 bg-gradient-to-l from-gray-50 to-transparent"></div>
                                </div>
                                <button onclick="navigator.clipboard.writeText('${qrCode}'); showToast('Copiado!', 'success')" class="text-blue-600 w-12 bg-blue-50 rounded-xl hover:bg-blue-100 font-bold border border-blue-100 flex items-center justify-center shrink-0"><i class='bx bx-copy text-xl'></i></button>
                            </div>
                            
                            <button onclick="confirmarPagamento()" class="w-full bg-green-500 text-white py-4 rounded-xl font-bold text-base shadow-lg shadow-green-200 hover:bg-green-600 hover:scale-[1.02] transition-all">
                                <i class='bx bx-check-circle'></i> Já realizei o pagamento
                            </button>
                            
                            <p class="text-xs text-gray-400 mt-4">O QR Code expira em 30 minutos.</p>
                        </div>
                    `;
                } else {
                    throw new Error("Erro na resposta da API");
                }
            } catch (e) {
                console.error(e);
                area.innerHTML = `
                    <div class="bg-red-50 text-red-600 p-4 rounded-xl text-sm font-medium mb-4 text-center">
                        <i class='bx bx-error-circle text-2xl block mb-2 mx-auto'></i>
                        Não foi possível gerar o PIX.<br>Verifique sua conexão.
                    </div>
                    <button onclick="renderCartPage()" class="w-full bg-white border border-gray-200 text-gray-600 py-3 rounded-xl font-bold text-sm hover:bg-gray-50">Tentar Novamente</button>
                `;
            }
        }

        function confirmarPagamento() {
            const storedOrders = JSON.parse(localStorage.getItem('myOrders') || '[]');

            cart.forEach(item => {
                let priceDisplay = 0;
                if (item.type === 'rent') {
                    priceDisplay = calculateProRata(item.rentPrice).price;
                } else {
                    priceDisplay = item.basePrice;
                }

                storedOrders.unshift({
                    id: 'ORD-' + Math.floor(Math.random() * 1000000),
                    name: `${item.name} (${item.type === 'rent' ? 'Aluguel' : item.installments + 'x'})`,
                    price: priceDisplay,
                    status: 'Em separação',
                    date: new Date().toLocaleDateString('pt-BR')
                });
            });

            localStorage.setItem('myOrders', JSON.stringify(storedOrders));

            cart = [];
            updateCartIcon();

            switchPage('orders');
            loadOrders();
            showToast('Pagamento confirmado! Pedido em separação.', 'success');
        }

        // --- View & Navigation Utils ---


        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('myOrders') || '[]');
            const container = document.getElementById('dynamic-orders');
            if (!container) return;

            if (orders.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '';
            orders.forEach(order => {
                const isTwoTimes = order.name.includes('2x');
                html += `
                <div class="bg-white rounded-2xl p-5 shadow-sm mb-4 border border-gray-100 animate-[fadeIn_0.5s_ease]">
                    <div class="flex gap-4">
                        <div class="w-16 h-16 bg-gray-50 rounded-xl flex items-center justify-center text-gray-600 border border-gray-100">
                            <i class='bx bx-package text-2xl'></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-[10px] uppercase font-bold text-blue-900 mb-1 tracking-wide">Em separação</p>
                            <h3 class="text-sm font-bold text-gray-800 leading-tight">${order.name}</h3>
                            <p class="text-xs text-gray-500 mt-1">${order.price.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>
                        </div>
                    </div>
                     <div class="mt-4 pt-4 border-t border-gray-100">
                         <div>
                            <p class="text-xs font-bold text-gray-700">Status atual:</p>
                            <div class="flex items-center gap-2 mt-1">
                                <i class='bx bx-loader-alt bx-spin text-blue-600'></i>
                                <span class="text-xs text-gray-500">Estamos separando seu pedido.</span>
                            </div>
                        </div>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        function showToast(msg, type) {
            const t = document.createElement('div');
            t.className = 'toast';
            t.style.background = type === 'success' ? '#22c55e' : '#1e3a8a';
            t.style.color = 'white';
            t.style.padding = '12px 20px';
            t.style.borderRadius = '50px';
            t.style.fontSize = '0.9rem';
            t.style.fontWeight = '600';
            t.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
            t.style.zIndex = '9999';
            t.innerHTML = `<span>${msg}</span>`;

            if (toastContainer) {
                toastContainer.appendChild(t);
                t.animate([{ transform: 'translateY(20px)', opacity: 0 }, { transform: 'translateY(0)', opacity: 1 }], { duration: 300, fill: 'forwards' });
                setTimeout(() => {
                    t.animate([{ opacity: 1 }, { opacity: 0 }], { duration: 300, fill: 'forwards' }).onfinish = () => t.remove();
                }, 3000);
            }
        }

        // --- Invoice Modal ---
        function openInvoice() {
            window.open('https://drive.google.com/file/d/1GQjQOw7xq9Y52B-NY9p8gtPr9HK4eGzE/view?usp=sharing', '_blank');
        }

        function closeInvoice() {
            // no op
        }


        // Modal helpers for general purpose if needed (though we removed the cart modal usage)
        function fecharModal() {
            document.getElementById('modalPagamento').style.display = 'none';
        }

        // Init
        loadOrders();
        updateCartIcon();
    </script>

</body>

</html>