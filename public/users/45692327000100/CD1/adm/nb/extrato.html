<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-9060080612658200">

    <link rel="icon" href="/assets/img/iconWeb.png">
    <title>Extrato | Nubia</title>

    <!-- Link To CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BV6V3GTMR0"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-BV6V3GTMR0');
</script>

<body class="painel-adm1" onload="AnimationLoading();">
    <header>
        <div class="loading">
            <div class="efect-loading"></div>
        </div>
    </header>
    <div class="info">
        <div class="photo-profile">
            <img src="/users/45692327000100/CD1/adm/nb/img/profile_photo.jpg">
            <div class="detals">
                <h1>Olá, Nubia!</h1>
                <p>CEO: D'TUDO | Dupão</p>
                <br>
            </div>
        </div>
    </div>

    <div class="new_nav">
        <div class="conta-info">
            <div class="filter-selector">
                <button class="filter-btn active" data-filter="entrada"> <i class='bx bx-trending-up'></i> Entradas
                </button>
                <button class="filter-btn" data-filter="saida">
                    <i class='bx bx-trending-down'></i> Saídas
                </button>
            </div>

            <div class="mainContainer">
                <div class="transaction-list-container" id="transactionContainer"></div>
                <br>
                <br>
                <br>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const container = document.getElementById('transactionContainer');
                    const filterButtons = document.querySelectorAll('.filter-btn');
                    let allTransactions = [];

                    const normalizeString = (str) => {
                        if (!str) return '';
                        return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
                    };

                    const renderTransactions = (filter) => {
                        container.innerHTML = '';
                        const normalizedFilter = normalizeString(filter);

                        // ALTERAÇÃO 2: A condição 'todos' foi removida da lógica de filtro
                        const filteredTransactions = allTransactions.filter(transaction => {
                            return normalizeString(transaction.type) === normalizedFilter;
                        });

                        if (filteredTransactions.length === 0) {
                            container.innerHTML = '<p style="text-align:center;color:#555;margin-top:20px;">Nenhuma operação encontrada para hoje.</p>';
                            return;
                        }

                        filteredTransactions.forEach(transaction => {
                            const div = document.createElement('div');
                            div.classList.add('extrato-item');

                            const valorFormatado = parseFloat(transaction.total).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                            div.innerHTML = `
                                <i class='bx bx-shopping-bag extrato-icon'></i>
                                <div class="extrato-details">
                                    <span class="extrato-payment">${transaction.payment}</span>
                                    <span class="extrato-data">
                                        ${transaction.timestamp}
                                        ${transaction.descricao ? `<span class="extrato-descricao"> - ${transaction.descricao}</span>` : ''}
                                    </span> 
                                </div>
                                <span class="extrato-valor">${valorFormatado}</span>
                            `;
                            container.appendChild(div);
                        });
                    };

                    container.innerHTML = `<div class="loader"><div class="spinner"></div></div>`;

                    const url = "https://script.google.com/macros/s/AKfycbzd_UOW_Ei9nPxNwmJdEtX4q3XDXu_WWktWUvH70ooAFM8C1bB6r7m39E18vl5dRjDZ/exec";

                    fetch(url)
                        .then(res => res.json())
                        .then(data => {
                            allTransactions = data;
                            // ALTERAÇÃO 1: O filtro padrão agora é 'entrada'
                            renderTransactions('entrada');
                        })
                        .catch(err => {
                            container.innerHTML = '<p style="text-align:center;color:red;">Erro ao carregar o extrato.</p>';
                            console.error('Erro ao carregar extrato:', err);
                        });

                    filterButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            filterButtons.forEach(btn => btn.classList.remove('active'));
                            button.classList.add('active');
                            renderTransactions(button.dataset.filter);
                        });
                    });
                });
            </script>
        </div>
    </div>

    <div class="navigation">
        <ul>
            <li class="list">
                <a href="/users/45692327000100/CD1/adm/nb/conta.html">
                    <span class="icon"><i class="fi fi-rr-shop"></i></span>
                    <span class="text">Home</span>
                </a>
            </li>

            <li class="list">
                <a href="/users/45692327000100/CD1/adm/nb/metricas.html">
                    <span class="icon"><i class='bx  bx-bar-chart-big'></i></span>
                    <span class="text">Métrica</span>
                </a>
            </li>

            <li class="list">
                <a href="/users/45692327000100/CD1/adm/nb/push.html">
                    <span class="icon"><i class='bxr  bx-plus-circle'></i></span>
                    <span class="text">Venda</span>
                </a>
            </li>

            <li class="list active">
                <a href="#">
                    <span class="icon"><i class='bx bxs-copy-alt'></i></span>
                    <span class="text">Extrato</span>
                </a>
            </li>

            <li class="list">
                <a href="/index.html">
                    <span class="icon"><i class='bx  bx-arrow-out-up-square-half bx-rotate-270'></i></span>
                    <span class="text">Sair</span>
                </a>
            </li>
            <div class="indicator color11"></div>
        </ul>
    </div>


    <!-- Link To JS -->
    <script src="/assets/js/loading.js"></script>
    <script src="/assets/js/recurses.js"></script>
</body>

</html>