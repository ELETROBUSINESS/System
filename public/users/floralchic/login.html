<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/assets/img/iconWeb.png">
    <title>Acesso ELETRO | Eletro Business</title>
    
    <!-- Ícones -->
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <style>
        /* --- Variáveis de Cor --- */
        :root {
            --login-bg: #f0f2f5;
            --card-bg: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --accent-color: #db0038; /* Vermelho Principal */
            --input-bg: #f9f9f9;
            --input-border: #e0e0e0;
        }

        body {
            background-color: var(--login-bg);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            font-family: 'Poppins', sans-serif;
        }

        .login-card {
            background: var(--card-bg);
            border: 1px solid rgba(0, 0, 0, 0.05);
            padding: 40px;
            border-radius: 24px;
            width: 90%;
            max-width: 380px;
            text-align: center;
            z-index: 1;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .logo-area { margin-bottom: 25px; }
        .logo-area i { font-size: 42px; color: var(--accent-color); }

        .system-name {
            font-size: 12px;
            letter-spacing: 2px;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 5px;
            font-weight: 600;
        }

        .login-card h1 { color: var(--text-primary); font-size: 22px; margin-bottom: 5px; font-weight: 600; }
        .login-card p { color: var(--text-secondary); font-size: 13px; margin-bottom: 30px; }

        /* Input Styles */
        .input-group { text-align: left; margin-bottom: 20px; }
        .input-group label {
            display: block; color: var(--text-secondary); font-size: 12px;
            margin-bottom: 8px; margin-left: 5px; font-weight: 500;
        }

        .input-field {
            width: 100%; background: var(--input-bg); border: 1px solid var(--input-border);
            padding: 15px; border-radius: 12px; color: var(--text-primary);
            font-size: 15px; outline: none; transition: 0.3s;
        }
        .input-field:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(219, 0, 56, 0.1);
            background: #fff;
        }

        /* Botão Vermelho Fixo */
        .btn-action {
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            background-color: #db0038 !important; color: white !important;
            font-size: 15px; font-weight: 600; cursor: pointer;
            transition: all 0.3s ease; margin-top: 10px;
            box-shadow: 0 4px 6px rgba(219, 0, 56, 0.2);
        }
        .btn-action:hover {
            background-color: #a1003e !important; transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(219, 0, 56, 0.3);
        }

        .btn-back {
            background-color: transparent !important; border: 1px solid var(--input-border) !important;
            color: var(--text-secondary) !important; margin-top: 10px; box-shadow: none !important;
        }
        .btn-back:hover {
            background-color: var(--input-bg) !important; color: var(--text-primary) !important;
            border-color: #ccc !important; transform: none !important;
        }

        .step { transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.4s ease; width: 100%; }

        .user-preview {
            background: var(--input-bg); padding: 10px 15px; border-radius: 50px;
            display: inline-flex; align-items: center; gap: 10px; margin-bottom: 20px;
            border: 1px solid var(--input-border);
        }
        .user-preview i { font-size: 18px; color: var(--accent-color); }
        .user-preview span {
            font-size: 13px; color: var(--text-primary); max-width: 180px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500;
        }

        .error-msg {
            color: #d32f2f; font-size: 12px; margin-top: 10px; display: none;
            background: #ffebee; padding: 10px; border-radius: 8px; border: 1px solid #ffcdd2;
        }

        .loading-bar {
            height: 3px; width: 100%; background: #e0e0e0; position: absolute;
            top: 0; left: 0; display: none;
        }
        .loading-bar div {
            height: 100%; background: var(--accent-color); width: 0%;
            animation: load 2s infinite ease-in-out;
        }
        @keyframes load {
            0% { width: 0%; left: 0; }
            50% { width: 50%; left: 50%; }
            100% { width: 0%; left: 100%; }
        }

        .footer-text { margin-top: 25px; font-size: 11px; color: var(--text-secondary); opacity: 0.7; }
    </style>
</head>

<body>

    <div class="login-card">
        <div class="loading-bar" id="loadingBar"><div></div></div>

        <div class="logo-area">
            <i class='bx bxs-bolt-circle'></i>
            <div class="system-name">ELETRO BUSINESS</div>
        </div>

        <!-- ETAPA 1: EMAIL -->
        <div id="step1" class="step">
            <h1>Acessar Sistema</h1>
            <p>Digite seu e-mail para continuar</p>
            <form id="formStep1">
                <div class="input-group">
                    <label>E-mail Corporativo</label>
                    <input type="email" id="emailInput" class="input-field" placeholder="ex: nome@eletro.com" required autofocus>
                </div>
                <button type="submit" class="btn-action">Continuar</button>
            </form>
        </div>

        <!-- ETAPA 2: SENHA -->
        <div id="step2" class="step" style="display: none;">
            <div class="user-preview" id="userEmailDisplay">
                <i class='bx bx-user-circle'></i>
                <span id="emailText">...</span>
            </div>
            <h1>Bem-vindo</h1>
            <p>Confirme sua senha de acesso</p>
            <form id="formStep2">
                <div class="input-group">
                    <label>Sua Senha</label>
                    <input type="password" id="passwordInput" class="input-field" placeholder="••••••••" required>
                </div>
                <button type="submit" class="btn-action">Entrar no Sistema</button>
                <button type="button" class="btn-action btn-back" id="btnBack">Voltar</button>
            </form>
        </div>

        <div class="error-msg" id="errorMsg"></div>
        <div class="footer-text">Sistema ELETRO &copy; 2025</div>
    </div>

    <!-- Scripts do Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyAVQ3tf6Qu4_9PajpJclZAJjVvRgB4ZE2I",
            authDomain: "super-app25.firebaseapp.com",
            projectId: "super-app25",
            storageBucket: "super-app25.firebasestorage.app",
            messagingSenderId: "810900166273",
            appId: "1:810900166273:web:24b8f055a68c9f0a6b5f80"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const formStep1 = document.getElementById('formStep1');
        const formStep2 = document.getElementById('formStep2');
        
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const emailText = document.getElementById('emailText');
        const btnBack = document.getElementById('btnBack');
        const errorMsg = document.getElementById('errorMsg');
        const loadingBar = document.getElementById('loadingBar');

        let currentEmail = "";

        // --- VERIFICAR URL PARA PREENCHIMENTO AUTOMÁTICO ---
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const preFilledEmail = urlParams.get('email');
            const reauth = urlParams.get('reauth');

            if (preFilledEmail) {
                // Se houver email na URL, valida e pula para etapa 2
                if (validateEmail(preFilledEmail)) {
                    emailInput.value = preFilledEmail;
                    currentEmail = preFilledEmail;
                    
                    // Vai direto para etapa 2
                    emailText.textContent = currentEmail;
                    step1.style.display = 'none';
                    step2.style.display = 'block';
                    step2.style.opacity = '1';
                    step2.style.transform = 'translateX(0)';
                    
                    if(reauth) {
                        // Foca direto na senha
                        passwordInput.focus();
                    }
                }
            }
        });

        formStep1.addEventListener('submit', (e) => {
            e.preventDefault();
            errorMsg.style.display = 'none';

            const email = emailInput.value.trim();
            if (validateEmail(email)) {
                currentEmail = email;
                goToStep2();
            } else {
                showError("Por favor, insira um e-mail válido.");
            }
        });

        formStep2.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorMsg.style.display = 'none';
            loadingBar.style.display = 'block';

            const password = passwordInput.value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, currentEmail, password);
                const user = userCredential.user;
                
                const sessionToken = {
                    username: user.email.split('@')[0], 
                    email: user.email,
                    photo: null,
                    uid: user.uid,
                    expires: new Date().getTime() + (24 * 60 * 60 * 1000)
                };

                localStorage.setItem('session_token', JSON.stringify(sessionToken));
                window.location.href = 'conta.html';

            } catch (error) {
                loadingBar.style.display = 'none';
                console.error(error.code);
                
                if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    showError("Senha incorreta. Tente novamente.");
                } else if (error.code === 'auth/user-not-found') {
                    showError("Usuário não encontrado.");
                } else if (error.code === 'auth/too-many-requests') {
                    showError("Muitas tentativas falhas. Aguarde um momento.");
                } else {
                    showError("Erro ao acessar: " + error.message);
                }
            }
        });

        btnBack.addEventListener('click', () => {
            // Se veio por redirecionamento, limpa a URL para não voltar automaticamente ao recarregar
            if(window.location.search) {
                window.history.replaceState({}, document.title, window.location.pathname);
            }
            goToStep1();
        });

        function goToStep2() {
            emailText.textContent = currentEmail;
            step1.style.opacity = '0';
            step1.style.transform = 'translateX(-20px)';
            
            setTimeout(() => {
                step1.style.display = 'none';
                step2.style.display = 'block';
                setTimeout(() => {
                    step2.style.opacity = '1';
                    step2.style.transform = 'translateX(0)';
                    passwordInput.focus();
                }, 50);
            }, 300);
        }

        function goToStep1() {
            passwordInput.value = '';
            errorMsg.style.display = 'none';
            
            step2.style.opacity = '0';
            step2.style.transform = 'translateX(20px)';
            
            setTimeout(() => {
                step2.style.display = 'none';
                step1.style.display = 'block';
                setTimeout(() => {
                    step1.style.opacity = '1';
                    step1.style.transform = 'translateX(0)';
                    emailInput.focus();
                }, 50);
            }, 300);
        }

        function showError(msg) {
            errorMsg.textContent = msg;
            errorMsg.style.display = 'block';
            const card = document.querySelector('.login-card');
            card.style.transform = 'translateX(5px)';
            setTimeout(() => card.style.transform = 'translateX(-5px)', 100);
            setTimeout(() => card.style.transform = 'translateX(0)', 200);
        }

        function validateEmail(email) {
            return String(email).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);
        }
    </script>

</body>
</html>