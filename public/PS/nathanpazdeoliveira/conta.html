<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/assets/img/iconWeb.png">
  <title>Meus Serviços | ELETRO</title>

  <link rel="stylesheet" href="/assets/css/main.css">
  <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>

  <style>
    /* Tela de login */
    #login-container {
      display: none;
      height: 100vh;
      width: 100%;
      background: #f8f9fa;
      justify-content: center;
      align-items: center;
    }

    #login-box {
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      width: 300px;
      text-align: center;
    }

    #login-box h2 { margin-bottom: 20px; color: #c50037; }

    #login-box input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      outline: none;
    }

    #login-box button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #c50037;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
    }
    #login-box button:hover { background: #ab0030; }

    /* Tela de carregamento */
    #loading-screen {
      position: fixed;
      top: 0; left: 0;
      height: 100vh; width: 100%;
      background: rgba(255,255,255,0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.2rem;
      color: #c50037;
      z-index: 9999;
    }

    .trabalhos-container {
            padding: 0 15px 120px 15px;
            margin-top: 20px;
        }

        .trabalhos-container h2 {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 15px;
        }

        .trabalho-item {
            background-color: #fff;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #ccc;
        }

        .trabalho-item-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Cores da borda por status */
        .trabalho-item.status-andamento {
            border-color: #ab0030;
        }

        .trabalho-item.status-concluido {
            border-color: #28a745;
        }

        .trabalho-item.status-pendente {
            border-color: #ffc107;
        }

        .trabalho-icon {
            font-size: 2rem;
            color: #555;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-andamento .trabalho-icon {
            background-color: #ffe6e6;
            color: #ab0030;
        }

        .status-concluido .trabalho-icon {
            background-color: #e2f5e3;
            color: #28a745;
        }

        .status-pendente .trabalho-icon {
            background-color: #fff8e1;
            color: #ffc107;
        }

        .trabalho-info {
            flex-grow: 1;
        }

        .trabalho-info h3 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            color: #222;
        }

        .trabalho-info p {
            margin: 0 0 10px 0;
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
        }

        .progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 5px;
            height: 8px;
            overflow: hidden;
        }

        .progress-bar2 {
            height: 100%;
            background-color: #c50037;
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }

        .progress-bar2.status-concluido {
            background-color: #28a745;
        }

        .progress-bar2.status-pendente {
            background-color: #ffc107;
        }

        /* Botão de detalhes */
        .detalhes-btn {
            margin-top: 10px;
            background: none;
            border: none;
            color: #c50037;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .detalhes-btn:hover {
            text-decoration: underline;
        }

        /* Linha do tempo */
        .timeline {
            margin-top: 10px;
            padding-left: 20px;
            border-left: 2px solid #c50037;
            display: none;
        }

        .timeline-item {
            margin-bottom: 10px;
            position: relative;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 5px;
            width: 10px;
            height: 10px;
            background: #ab0030;
            border-radius: 50%;
        }

        .timeline-date {
            font-size: 0.8rem;
            font-weight: bold;
            color: #ab0030;
        }

        .timeline-desc {
            font-size: 0.85rem;
            color: #444;
        }

  </style>
</head>

<body class="painel-adm1">

  <!-- Tela de carregamento -->
  <div id="loading-screen">Verificando acesso...</div>

  <!-- Tela de login -->
  <div id="login-container">
    <div id="login-box">
      <h2>Login</h2>
      <input type="text" id="username" placeholder="Usuário">
      <input type="password" id="password" placeholder="Senha">
      <button onclick="login()">Entrar</button>
      <p id="login-error" style="color:red; font-size:0.9rem; display:none;">Usuário ou senha inválidos.</p>
    </div>
  </div>

  <!-- Conteúdo protegido -->
  <div id="conteudo" style="display:none;">
    <div class="mensagerLocal" style="display: none;">
            <div class="mensager">
                <img src="/assets/img/eFriend.png">
                <div>
                    <h1>Bem vindo de volta,<span>Nathan</span>,</h1>
                    <p>Aqui estão seus serviços de hoje!</p>
                </div>
                <div class="progress-bar2"></div>
            </div>
        </div>
        <script>
            const MENSAGEM_KEY = 'ultimaMensagemEletro';
            const INTERVALO_HORAS = 20;
            const INTERVALO_MS = INTERVALO_HORAS * 60 * 60 * 1000;
            const agora = new Date().getTime();
            const ultimaVisualizacao = localStorage.getItem(MENSAGEM_KEY);
            const mensagemEl = document.querySelector('.mensagerLocal');
            if (!ultimaVisualizacao || (agora - parseInt(ultimaVisualizacao)) > INTERVALO_MS) {
                mensagemEl.style.display = 'flex';
                setTimeout(() => {
                    mensagemEl.style.transition = "opacity 0.5s ease";
                    mensagemEl.style.opacity = 0;
                    setTimeout(() => {
                        mensagemEl.style.display = "none";
                    }, 500);
                }, 6200);
                localStorage.setItem(MENSAGEM_KEY, agora);
            } else {
                mensagemEl.style.display = 'none';
            }
        </script>

        <main class="main-content">
            <div class="info">
                <div class="photo-profile">
                    <img
                        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhI0u0Kr3HLX6o-nBt4HKbEembHeFt9lssCKsc5dcq2qWN3hrBkL4cPowBSDePJ-r1wux8rGExJrs-RYGh86xWx97NOSRhGlCt0eH_mACN0Uqfo9DQAxWGlwUYSLg3P_zhlI4I68d_HLZmwp5Nv3RqUvl7RSNp7ELOm_3AKbR-NgJtHBH4HVG_QD9GlSfU/s320/459014051_1562356184369199_5576365318911314641_n.jpg">
                    <div class="detals">
                        <h1>Olá, Nathan!</h1>
                        <p>Prestador de Serviços</p>
                    </div>
                    <i class="fi fi-rr-shield-trust"></i>
                </div>
                <div class="balance">
                    <p>Saldo em conta</p>
                    <div class="saldo">
                        <span id="valor1" class="skeleton shimmer"></span>
                        <i class='bx bx-eye' id="toggle-balance-icon"></i>
                    </div>
                    <div class="pending">
                        <p>Serviços a receber: </p>
                        <span id="valor2" class="skeleton shimmer"></span>
                    </div>
                </div>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const url = `https://script.google.com/macros/s/AKfycby8x6--ITfvIW7ui6c24reBqzL3LUhqL30hf4-gaJCS0xB0EDPM50TcSji_W-IuNU33/exec?pagina=6`;

                    const valor1Element = document.getElementById('valor1');
                    const valor2Element = document.getElementById('valor2');
                    const toggleIcon = document.getElementById('toggle-balance-icon');

                    let valor1Original = '';
                    let valor2Original = '';
                    let isBalanceVisible = localStorage.getItem('balanceVisible') === 'true';

                    function toggleBalanceDisplay() {
                        if (isBalanceVisible) {
                            valor1Element.textContent = valor1Original;
                            valor2Element.textContent = valor2Original;
                        } else {
                            valor1Element.textContent = 'R$ *******';
                            valor2Element.textContent = 'R$ ********';
                        }
                        toggleIcon.classList.toggle('bx-eye', isBalanceVisible);
                        toggleIcon.classList.toggle('bx-eye-closed', !isBalanceVisible);
                    }

                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (valor1Element) {
                                valor1Original = data.valor1;
                                valor1Element.classList.remove('skeleton', 'shimmer');
                            }
                            if (valor2Element) {
                                valor2Original = data.valor2;
                                valor2Element.classList.remove('skeleton', 'shimmer');
                            }
                            toggleBalanceDisplay();
                        })
                        .catch(error => {
                            console.error('Erro ao buscar dados:', error);
                            valor1Element.textContent = 'Erro ao carregar';
                            valor2Element.textContent = 'Erro ao carregar';
                        });

                    if (toggleIcon) {
                        toggleIcon.addEventListener('click', () => {
                            isBalanceVisible = !isBalanceVisible;
                            localStorage.setItem('balanceVisible', isBalanceVisible);
                            toggleBalanceDisplay();
                        });
                    }
                });
            </script>

            <div class="trabalhos-container">
                <h2>Meus Trabalhos</h2>
                <div id="lista-trabalhos"></div>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const trabalhosDisponiveis = [
                        {
                            icone: 'bxs-capture',
                            titulo: 'Produção de Vídeo',
                            descricao: 'Atuação em vídeo',
                            progresso: 65,
                            status: 'andamento',
                            timeline: [
                                { data: '25/09', desc: 'Envio de roteiro' },
                                { data: '26/09', desc: 'Atuação agendada' },
                                { data: '27/09', desc: 'Atuação realizada' }
                            ]
                        }
                    ];

                    const container = document.getElementById('lista-trabalhos');
                    const statusOrdem = { 'Em Andamento': 1, 'Pendente': 2, 'Concluído': 3 };
                    const trabalhosOrdenados = trabalhosDisponiveis.sort((a, b) => statusOrdem[a.status] - statusOrdem[b.status]);

                    trabalhosOrdenados.forEach((trabalho, index) => {
                        const statusClass = `status-${trabalho.status.toLowerCase().replace(' ', '')}`;

                        const itemDiv = document.createElement('div');
                        itemDiv.className = `trabalho-item ${statusClass}`;

                        let timelineHTML = '';
                        if (trabalho.timeline) {
                            timelineHTML = `
                            <button class="detalhes-btn" data-index="${index}">
                                <i class='bx bx-detail'></i> Detalhes
                            </button>
                            <div class="timeline" id="timeline-${index}">
                                ${trabalho.timeline.map(evento => `
                                    <div class="timeline-item">
                                        <div class="timeline-date">${evento.data}</div>
                                        <div class="timeline-desc">${evento.desc}</div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        }

                        itemDiv.innerHTML = `
                        <div class="trabalho-item-header">
                            <div class="trabalho-icon">
                                <i class='bx ${trabalho.icone}'></i>
                            </div>
                            <div class="trabalho-info">
                                <h3>${trabalho.titulo}</h3>
                                <p>${trabalho.descricao}</p>
                                <div class="progress-container">
                                    <div class="progress-bar2 ${statusClass}" style="width: ${trabalho.progresso}%;"></div>
                                </div>
                                ${timelineHTML}
                            </div>
                        </div>
                    `;

                        container.appendChild(itemDiv);
                    });

                    document.querySelectorAll('.detalhes-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const index = btn.getAttribute('data-index');
                            const timeline = document.getElementById(`timeline-${index}`);
                            timeline.style.display = timeline.style.display === 'block' ? 'none' : 'block';
                        });
                    });
                });
            </script>

        </main>

        <div class="navigation">
            <ul>
                <li class="list active"> <a href="#">
                        <span class="icon"><i class='bx bxs-briefcase-alt-2'></i></span>
                        <span class="text">Serviços</span>
                    </a>
                </li>
                <div class="indicator color11"></div>
            </ul>
        </div>
  </div>

  <script src="/assets/js/loading.js"></script>

  <script>
    const TOKEN_KEY = "authToken002134";
    const TOKEN_EXP_KEY = "authTokenExp";
    const TOKEN_VALIDITY = 30 * 60 * 1000; // 30 min em ms

    function mostrarLoading(show) {
      const loadingEl = document.getElementById("loading-screen");
      if (loadingEl) loadingEl.style.display = show ? "flex" : "none";
    }

    function verificarAcesso() {
      mostrarLoading(true);

      setTimeout(() => {
        const token = localStorage.getItem(TOKEN_KEY);
        const exp   = localStorage.getItem(TOKEN_EXP_KEY);
        const agora = Date.now();

        if (token && exp && agora < parseInt(exp)) {
          // Token válido
          document.getElementById("conteudo").style.display = "block";
          document.getElementById("login-container").style.display = "none";
        } else {
          // Token inválido ou expirado
          localStorage.removeItem(TOKEN_KEY);
          localStorage.removeItem(TOKEN_EXP_KEY);
          document.getElementById("conteudo").style.display = "none";
          document.getElementById("login-container").style.display = "flex";
        }

        mostrarLoading(false);
      }, 1000); // simulação de verificação
    }

    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();

      const usuarioCorreto = "Eduardo";
      const senhaCorreta = "12345";

      if (user === usuarioCorreto && pass === senhaCorreta) {
        const agora = Date.now();
        const expiraEm = agora + TOKEN_VALIDITY;

        localStorage.setItem(TOKEN_KEY, "TOKEN_" + agora);
        localStorage.setItem(TOKEN_EXP_KEY, expiraEm);

        document.getElementById("login-container").style.display = "none";
        document.getElementById("conteudo").style.display = "block";
      } else {
        document.getElementById("login-error").style.display = "block";
      }
    }

    document.addEventListener("DOMContentLoaded", verificarAcesso);
  </script>
</body>
</html>
