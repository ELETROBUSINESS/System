<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rádio Eletrobusiness</title>
    <!-- Tailwind CSS (Estilo) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Ícones -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* Estilo Vidro Clean */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Equalizador Simples */
        .bar { animation: bounce 1s infinite ease-in-out; }
        .bar:nth-child(2) { animation-delay: 0.1s; }
        .bar:nth-child(3) { animation-delay: 0.2s; }
        .bar:nth-child(4) { animation-delay: 0.3s; }
        
        @keyframes bounce {
            0%, 100% { height: 4px; }
            50% { height: 16px; }
        }
        .paused .bar { animation-play-state: paused; height: 4px; }

        /* Slider Clean */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px;
            border-radius: 50%; background: #1e293b; cursor: pointer; margin-top: -6px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px;
        }

        /* Esconde elementos do YouTube */
        .ytp-chrome-top, .ytp-watermark { display: none !important; }
        
        /* Container do Player (Vídeo Escondido/Discreto) */
        #player-container {
            filter: grayscale(100%);
            opacity: 0.5;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        /* Classe para esconder vídeo (Regra do canal) 
           NOTA: Usamos 0.01 em vez de 0 para evitar que navegadores pausem o áudio em background
        */
        .hide-video { opacity: 0.01 !important; }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center text-slate-800 overflow-hidden">

    <!-- Botão de Início (Necessário para áudio web) -->
    <div id="start-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-2xl shadow-xl text-center">
            <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="radio" class="w-8 h-8 text-slate-700"></i>
            </div>
            <h1 class="text-xl font-bold mb-6">Rádio</h1>
            <button onclick="startRadio()" class="bg-slate-900 text-white px-8 py-3 rounded-lg hover:bg-slate-800 transition flex items-center gap-2 mx-auto">
                <i data-lucide="play" class="w-4 h-4"></i> Iniciar Transmissão
            </button>
        </div>
    </div>

    <!-- Player Principal -->
    <main class="w-full max-w-md p-4">
        <div class="glass-panel rounded-3xl p-8 relative">
            
            <!-- Topo: Status, Duração e Pop-out -->
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-2">
                    <!-- Status Badge -->
                    <div class="flex items-center gap-2 bg-white/50 px-3 py-1 rounded-full border border-slate-100">
                        <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                        <span class="text-[10px] font-bold tracking-widest text-slate-400">NO AR</span>
                    </div>
                    
                    <!-- Duração Badge -->
                    <div class="flex items-center gap-1.5 bg-white/50 px-3 py-1 rounded-full border border-slate-100 text-[10px] font-bold tracking-widest text-slate-400" title="Duração total da playlist">
                        <i data-lucide="clock" class="w-3 h-3 text-slate-400"></i>
                        <span id="playlist-total-duration">-- min</span>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <!-- Equalizador -->
                    <div id="visualizer" class="flex items-end gap-1 h-5 paused">
                        <div class="bar w-1 bg-slate-800 rounded-full"></div>
                        <div class="bar w-1 bg-slate-400 rounded-full"></div>
                        <div class="bar w-1 bg-slate-600 rounded-full"></div>
                        <div class="bar w-1 bg-slate-800 rounded-full"></div>
                    </div>
                    
                    <!-- Botão Pop-out (Nova Janela) -->
                    <button onclick="openPopup()" class="text-slate-400 hover:text-slate-800 transition-colors p-1" title="Abrir em janela separada (Não para a música)">
                        <i data-lucide="external-link" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- YouTube (Escondido/Fundo) -->
            <div class="relative w-full aspect-video bg-slate-900 rounded-xl overflow-hidden mb-6 shadow-inner">
                <div id="player-container" class="w-full h-full">
                    <div id="player"></div>
                </div>
                <!-- Ícone Decorativo -->
                <div class="absolute inset-0 flex items-center justify-center opacity-20">
                    <i data-lucide="music" class="w-12 h-12 text-white"></i>
                </div>
            </div>

            <!-- Infos -->
            <div class="text-center mb-6">
                <h2 id="track-title" class="text-lg font-bold leading-tight line-clamp-2 h-14 flex items-center justify-center px-2">
                    Carregando...
                </h2>
                <p id="track-artist" class="text-sm text-slate-500">Aguardando</p>
            </div>

            <!-- Controles -->
            <div class="flex flex-col gap-6">
                <!-- Progresso -->
                <div>
                    <div class="w-full h-2 bg-slate-200 rounded-full overflow-hidden">
                        <div id="progress-bar" class="bg-slate-800 h-full w-0 transition-all duration-500 relative"></div>
                    </div>
                    <div class="flex justify-between mt-2 px-1 text-[10px] font-mono text-slate-400">
                        <span id="current-time">00:00</span>
                        <span id="total-time">00:00</span>
                    </div>
                </div>

                <!-- Botões -->
                <div class="flex items-center justify-center gap-8">
                    <button onclick="changeTrack(-1)" class="p-3 text-slate-400 hover:text-slate-800">
                        <i data-lucide="skip-back" class="w-6 h-6 fill-current"></i>
                    </button>
                    
                    <button id="play-btn" onclick="togglePlay()" class="w-16 h-16 bg-slate-900 text-white rounded-full flex items-center justify-center shadow-xl hover:scale-105 transition">
                        <i data-lucide="play" class="w-6 h-6 fill-current ml-1"></i>
                    </button>
                    
                    <button onclick="changeTrack(1)" class="p-3 text-slate-400 hover:text-slate-800">
                        <i data-lucide="skip-forward" class="w-6 h-6 fill-current"></i>
                    </button>
                </div>

                <!-- Volume -->
                <div class="flex items-center gap-3">
                    <i id="vol-icon" data-lucide="volume-2" class="w-4 h-4 text-slate-400"></i>
                    <input type="range" min="0" max="100" value="50" oninput="setVolume(this.value)" class="flex-1">
                </div>
            </div>
            
        </div>
    </main>

    <script>
        // CONFIGURAÇÃO DA PLAYLIST ORIGINAL
        const PLAYLIST = [
            { id: '9zWxHUWdoXE', title: 'Halo', artist: 'Beyoncé', duration: 225 },
            { id: 'GVSS3lh_lCY', title: 'Poker Face', artist: 'Lady Gaga', duration: 237 },
            { id: 'IyazT0gd8vQ', title: 'Just The Way You Are', artist: 'Bruno Mars', duration: 221 },
            { id: '6p7RnpkrItc', title: 'Happy', artist: 'Pharrell Williams', duration: 248 },
            { id: 'PLTECT3TR0s', title: 'Safe And Sound', artist: 'Capital Cities', duration: 193 },
            { id: 't616WDzKOfQ', title: 'Little Talks', artist: 'Of Monsters And Men', duration: 252 },
            { id: 'N9WB3dq4cGE', title: 'Pumped Up Kicks', artist: 'Foster The People', duration: 239 },
            { id: 'f9NK93agbXU', title: 'Shape of You', artist: 'Ed Sheeran', duration: 264 },
            { id: 'I60iMpnwaVc', title: 'Uptown Funk', artist: 'Mark Ronson', duration: 271 }
        ];

        let player, queue = [], currentIndex = 0, isPlaying = false, progressInterval;

        // Proteção contra fechamento acidental
        window.addEventListener('beforeunload', function (e) {
            if (isPlaying) {
                e.preventDefault();
                e.returnValue = ''; // Mensagem padrão do navegador
            }
        });

        // Função para abrir em janela separada (Pop-out)
        function openPopup() {
            // Abre a URL atual em uma nova janela pequena
            window.open(window.location.href, 'RadioLojaPlayer', 'width=400,height=700,menubar=no,toolbar=no,location=no,status=no');
            // Opcional: Pausar o player atual para não tocar duplicado
            if(player && player.pauseVideo) player.pauseVideo();
        }

        // Inicialização
        lucide.createIcons();
        shuffleQueue();
        calculateTotalTime();

        // Carrega API do YouTube
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%', width: '100%',
                videoId: queue[currentIndex].id,
                playerVars: {
                    'playsinline': 1, 'controls': 0, 'disablekb': 1, 'fs': 0, 
                    'iv_load_policy': 3, 'rel': 0, 'modestbranding': 1,
                    // Garante a compatibilidade no domínio real
                    'origin': window.location.origin 
                },
                events: {
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        function startRadio() {
            document.getElementById('start-overlay').style.display = 'none';
            if(player && player.playVideo) player.playVideo();
        }

        function onPlayerStateChange(event) {
            const vis = document.getElementById('visualizer');
            const btn = document.getElementById('play-btn');
            
            checkChannel();

            if (event.data == YT.PlayerState.PLAYING) {
                isPlaying = true;
                vis.classList.remove('paused');
                btn.innerHTML = '<i data-lucide="pause" class="w-6 h-6 fill-current"></i>';
                lucide.createIcons();
                updateUI();
                startTimer();
            } else {
                isPlaying = false;
                vis.classList.add('paused');
                btn.innerHTML = '<i data-lucide="play" class="w-6 h-6 fill-current ml-1"></i>';
                lucide.createIcons();
                stopTimer();
                if(event.data == YT.PlayerState.ENDED) changeTrack(1);
            }
        }

        // TRATAMENTO DE ERRO
        function onPlayerError(e) {
            console.log("Erro " + e.data + " detectado. Tentando próxima...");
            setTimeout(() => changeTrack(1), 1000);
        }

        function togglePlay() {
            if(!player) return;
            isPlaying ? player.pauseVideo() : player.playVideo();
        }

        function changeTrack(direction) {
            currentIndex += direction;
            if(currentIndex >= queue.length) { shuffleQueue(); currentIndex = 0; }
            if(currentIndex < 0) currentIndex = queue.length - 1;
            
            loadTrack();
        }

        function loadTrack() {
            updateUI();
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('current-time').innerText = "00:00";
            if(player && player.loadVideoById) player.loadVideoById(queue[currentIndex].id);
        }

        function checkChannel() {
            if(player && player.getVideoData) {
                const data = player.getVideoData();
                const el = document.getElementById('player-container');
                if(data.author && (data.author.includes('A Voz das Vendas') || data.author.includes('Voz das Vendas'))) {
                    el.classList.add('hide-video');
                } else {
                    el.classList.remove('hide-video');
                }
            }
        }

        function updateUI() {
            const track = queue[currentIndex];
            document.getElementById('track-title').innerText = track.title;
            document.getElementById('track-artist').innerText = track.artist;
        }

        function setVolume(val) {
            if(player) player.setVolume(val);
            const icon = document.getElementById('vol-icon');
            if(val == 0) icon.setAttribute('data-lucide', 'volume-x');
            else if(val < 50) icon.setAttribute('data-lucide', 'volume-1');
            else icon.setAttribute('data-lucide', 'volume-2');
            lucide.createIcons();
        }

        function startTimer() {
            stopTimer();
            progressInterval = setInterval(() => {
                if(!player || !player.getCurrentTime) return;
                const cur = player.getCurrentTime();
                const dur = player.getDuration();
                if(dur > 0) {
                    document.getElementById('progress-bar').style.width = (cur/dur*100) + '%';
                    document.getElementById('current-time').innerText = fmt(cur);
                    document.getElementById('total-time').innerText = fmt(dur);
                }
            }, 1000);
        }

        function stopTimer() { clearInterval(progressInterval); }
        
        function shuffleQueue() {
            queue = [...PLAYLIST].sort(() => Math.random() - 0.5);
        }

        function calculateTotalTime() {
            let totalSeconds = PLAYLIST.reduce((acc, curr) => acc + (curr.duration || 0), 0);
            let hours = Math.floor(totalSeconds / 3600);
            let minutes = Math.floor((totalSeconds % 3600) / 60);
            
            let timeString = "";
            if(hours > 0) {
                timeString = `${hours}h ${minutes}min`;
            } else {
                timeString = `${minutes} min`;
            }
            
            document.getElementById('playlist-total-duration').innerText = timeString;
        }
        
        function fmt(s) {
            if(isNaN(s)) return "00:00";
            const m = Math.floor(s/60), sec = Math.floor(s%60);
            return `${m}:${sec<10?'0'+sec:sec}`;
        }
    </script>
</body>
</html>