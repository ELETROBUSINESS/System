<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/assets/img/iconWeb.png">
    <title>Ponto de Venda | ELETRO</title>

    <link rel="stylesheet" href="style.css?v=3">
    <link rel="stylesheet" href="pdv_payment.css?v=1">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-solid-straight/css/uicons-solid-straight.css'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BV6V3GTMR0"></script>

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-BV6V3GTMR0');
    </script>
</head>

<body>


    <div class="modal-overlay" id="print-selection-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Como deseja o comprovante?</h3>
                <button class="close-modal-btn" data-target="print-selection-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p class="text-center mb-16 text-light">Escolha o formato ideal para o cliente.</p>

                <div class="print-options-grid">
                    <div id="btn-print-thermal" class="print-option-card">
                        <i class='bx bx-receipt print-icon'></i>
                        <h4>Cupom Fiscal</h4>
                        <p class="text-sm text-light text-center">Térmica (80mm)<br>Compacto</p>
                    </div>

                    <div id="btn-print-a4" class="print-option-card">
                        <i class='bx bx-file-blank print-icon' style="color: #4f46e5;"></i>
                        <h4>Folha A4</h4>
                        <p class="text-sm text-light text-center">Impressora Comum<br>Detalhado</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tipo de PIX -->
    <div class="modal-overlay" id="pix-type-modal" style="z-index: 9999;">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>Tipo de PIX</h3>
                <button class="close-modal-btn" data-target="pix-type-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p class="text-center mb-16 text-light">Qual forma de PIX foi utilizada?</p>
                <div class="print-options-grid"> <!-- Reusing grid style -->
                    <div id="btn-pix-qrcode" class="print-option-card">
                        <i class='bx bx-qr-scan print-icon' style="color: #10b981;"></i>
                        <h4>QR Code</h4>
                        <p class="text-sm text-light text-center">Loja / Estático</p>
                    </div>
                    <div id="btn-pix-maquininha" class="print-option-card">
                        <i class='bx bx-calculator print-icon' style="color: #3b82f6;"></i>
                        <h4>Maquininha</h4>
                        <p class="text-sm text-light text-center">InfinitePay</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="loading-overlay">
        <i class='bx bx-loader-alt bx-spin'></i>
        <p id="loading-message">Verificando status do caixa...</p>
    </div>

    <!-- Promo Banner Fixed -->
    <!-- <div class="promo-banner-fixed">
        <span class="promo-text-small">ATÉ</span>
        <span class="promo-text-large">10X</span>
        <span class="promo-text-sub">*Material escolar</span>
    </div> -->

    <div id="sale-processing-notification" class="notification-sidebar">
        <div class="notif-icon-wrapper">
            <!-- Spinner Circle -->
            <svg class="spinner-svg" viewBox="0 0 50 50">
                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle>
            </svg>
            <!-- Success/Error Icons (Hidden by default) -->
            <i class='bx bx-check success-icon'></i>
            <i class='bx bx-x error-icon'></i>
        </div>
        <div class="notif-content">
            <span id="notif-title">Processando...</span>
            <p id="notif-status">Aguarde um momento</p>
        </div>
    </div>

    <div class="modal-overlay" id="client-selection-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Identificar Cliente</h3>
                <button class="close-modal-btn" data-target="client-selection-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="search-row-modern">
                    <div class="input-modern-wrapper">
                        <i class='bx bx-search' style="color: #9ca3af; font-size: 1.2rem;"></i>
                        <input type="text" id="client-selection-input" class="input-modern"
                            placeholder="Busque por nome..." autocomplete="off" data-primary-focus="true">
                    </div>

                    <button class="btn-square-add" id="btn-new-client-modal" title="Novo Cliente">
                        <i class='bx bx-plus'></i>
                    </button>
                </div>

                <div class="client-results-modern" id="client-selection-results" style="display:none;"></div>

                <p class="text-center text-light mt-20 text-sm" id="client-search-hint">
                    Digite para buscar...
                </p>
            </div>
        </div>
    </div>

    <div class="modal-overlay z-high" id="image-viewer-modal">
        <div class="modal-content modal-fullscreen">
            <div class="modal-header">
                <h3>Visualizar Comprovante</h3>
                <button class="close-modal-btn" data-target="image-viewer-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body viewer-body">
                <p id="viewer-loading" class="viewer-loading">
                    <i class='bx bx-loader-alt bx-spin'></i> Carregando imagem...
                </p>
                <iframe id="viewer-iframe" src="" class="viewer-iframe"></iframe>
            </div>
        </div>
    </div>

    <!-- Advanced Search Modal -->
    <div class="modal-overlay" id="adv-search-modal" style="z-index: 10001;">
        <div class="modal-content modal-lg" style="height: 80vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3>Pesquisa de Produtos</h3>
                <button class="close-modal-btn" data-target="adv-search-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body" style="padding: 0; display: flex; flex-direction: column; overflow: hidden;">
                <div class="adv-search-bar" style="padding: 16px; border-bottom: 1px solid #e5e7eb; background: #fff;">
                    <div class="input-group-modern">
                        <i class='bx bx-search'></i>
                        <input type="text" id="adv-search-input" placeholder="Digite nome, código ou marca..."
                            autocomplete="off">
                    </div>
                </div>
                <div id="adv-search-results" class="adv-results-grid">
                    <!-- Results will be injected here -->
                    <div class="text-center w-full" style="grid-column: 1 / -1; padding: 40px; color: #9ca3af;">
                        <p>Digite para pesquisar...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="cliente-details-modal">
        <div class="modal-content">
            <div class="modal-header" style="justify-content: space-between; align-items: center;">
                <h3>Ficha do Cliente</h3>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="position: relative;">
                        <button id="btn-client-options" class="btn-icon-soft">
                            <i class='bxr  bx-sparkles-alt'></i>
                        </button>
                        <div id="client-options-dropdown" class="client-options-dropdown">
                            <div class="dropdown-item" data-action="dados">
                                <i class='bx bx-id-card'></i> Dados
                            </div>
                            <div class="dropdown-item restricted" data-action="renegociar">
                                <i class='bx bx-calendar-edit'></i> Renegociar
                            </div>
                            <div class="dropdown-item restricted" data-action="limite">
                                <i class='bx bx-coin-stack'></i> Limite
                            </div>
                            <div class="dropdown-item restricted" data-action="manual_venc">
                                <i class='bx bx-time'></i> Prazo
                            </div>
                            <div class="dropdown-item restricted" data-action="acesso">
                                <i class='bx bx-qr-scan'></i> Gerar acesso QRCODE
                            </div>
                        </div>
                    </div>

                    <!-- Botão Expandir Janela (Cliente) -->
                    <button class="window-control-btn" id="btn-maximize-client-modal" title="Expandir janela">
                        <i class='bx bx-expand'></i>
                    </button>

                    <button class="btn-icon-soft close-modal-btn" data-target="cliente-details-modal">
                        <i class='bx bx-x'></i>
                    </button>
                </div>
            </div>

            <div class="modal-body">
                <div class="client-profile-header"
                    style="position: relative; display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                    <div class="client-avatar" style="width: 50px; height: 50px; font-size: 1.5rem;"><i
                            class='bx bx-user'></i></div>
                    <div style="flex-grow: 1;">
                        <h4 id="detail-cliente-nome" style="margin:0; font-size: 1.1rem; color: #111;">Carregando...
                        </h4>
                        <p id="detail-cliente-apelido" class="text-light" style="margin:0; font-size: 0.9rem;">...</p>
                    </div>
                </div>

                <div class="detail-info-row" style="gap: 8px;">
                    <div class="detail-info-card">
                        <span class="label">Saldo Devedor</span>
                        <span class="value" id="detail-cliente-saldo">R$ 0,00</span>
                    </div>
                    <div class="detail-info-card">
                        <span class="label">Próximo Venc.</span>
                        <span class="value" id="detail-cliente-vencimento">--/--/----</span>
                    </div>
                    <div class="detail-info-card">
                        <span class="label">Parcelas Rest.</span>
                        <span class="value" id="detail-cliente-qtd-parcelas">-</span>
                    </div>
                    <div class="detail-info-card">
                        <span class="label">Valor Parcela</span>
                        <span class="value" id="detail-cliente-valor-parcela-mensal">-</span>
                    </div>
                </div>

                <!-- QR Code Container (Modernizado) -->
                <div id="qrcode-container" class="qr-modern-container">
                    <button class="qr-close-btn"
                        onclick="document.getElementById('qrcode-container').classList.remove('active');"><i
                            class='bx bx-x'></i></button>
                    <div id="qrcode-canvas"></div>
                    <div id="link-acesso-text" class="qr-link-box"></div>
                </div>

                <div class="limit-container" style="margin-top: 20px;">
                    <div class="limit-header">
                        <span>Limite: <strong id="detail-cliente-limite-total">R$ 0,00</strong></span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" id="detail-cliente-progress"></div>
                    </div>
                    <div class="limit-stats">
                        <span id="detail-cliente-disponivel">Disponível: R$ 0,00</span>
                        <span id="detail-cliente-percentual">0% usado</span>
                    </div>
                </div>

                <div class="history-section" style="margin-top: 25px;">
                    <h4><i class='bx bx-history'></i> Histórico Recente</h4>
                    <div class="history-list-container" id="detail-history-container">
                        <p class="text-center loading-text">Carregando...</p>
                    </div>
                </div>

                <div class="form-group mt-16">
                    <label>Contato</label>
                    <div class="info-box">
                        <p><i class='bx bx-phone'></i> <span id="detail-cliente-telefone">--</span></p>
                        <p><i class='bx bx-map'></i> <span id="detail-cliente-endereco">--</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-admin-auth" class="modal-overlay">
        <div class="modal-content modal-auth-content">
            <div class="modal-header auth-header">
                <div class="auth-icon-wrapper">
                    <i class='bx bxs-lock-alt'></i>
                </div>
            </div>
            <div class="modal-body" style="padding: 0;">
                <h3 class="auth-title">Área Restrita</h3>
                <p class="auth-subtitle">Digite a senha de administrador.</p>

                <input type="password" id="admin-password-input" class="auth-input" placeholder="Senha...">
                <p id="auth-error-msg" class="auth-error">Senha incorreta!</p>

                <div class="auth-actions">
                    <button id="btn-cancel-auth" class="btn-auth-cancel">Cancelar</button>
                    <button id="btn-confirm-auth" class="btn-auth-confirm">Entrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Dados Cliente (NOVO) -->
    <div id="modal-edit-client-data" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class='bx bx-edit'></i> Editar Dados</h3>
                <button class="close-modal-btn" data-target="modal-edit-client-data"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p class="mb-16">Atualize as informações de contato.</p>

                <div class="form-group">
                    <label>Telefone / Celular</label>
                    <input type="text" id="input-edit-telefone" class="form-input" placeholder="(00) 00000-0000">
                </div>

                <div class="form-group">
                    <label>Endereço Completo</label>
                    <textarea id="input-edit-endereco" class="form-input" rows="3"
                        placeholder="Rua, Número, Bairro..."></textarea>
                </div>

                <button id="btn-save-client-data" class="primary-btn" style="width: 100%; margin-top: 15px;">
                    SALVAR ALTERAÇÕES
                </button>
            </div>
        </div>
    </div>

    <div id="modal-renegociar" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class='bx bx-calendar-edit'></i> Renegociar (Admin)</h3>
                <span class="close-modal" id="close-renegociar">&times;</span>
            </div>
            <div class="modal-body">
                <div
                    style="background: #fdf2f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #fbcfe8; text-align: center;">
                    <p style="font-size: 0.8rem; color: #db0038; font-weight: 600; text-transform: uppercase;">Saldo
                        Devedor Total</p>
                    <p style="font-size: 1.8rem; font-weight: 800; color: #be185d;" id="reneg-saldo-atual">R$ 0,00</p>
                </div>

                <div class="form-group">
                    <label>Vencimento Atual</label>
                    <input type="text" id="reneg-vencimento-atual" class="form-input" disabled
                        style="background: #e5e7eb; color: #555;">
                </div>

                <div class="form-group">
                    <label style="color: #db0038; font-weight: 700;">Parcelamento da Dívida</label>
                    <select id="reneg-parcelas" class="form-input" style="border: 2px solid #db0038;">
                        <option value="1">1x (Manter valor total)</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                        <option value="5">5x</option>
                        <option value="6">6x</option>
                        <option value="7">7x</option>
                        <option value="8">8x</option>
                        <option value="9">9x</option>
                        <option value="10">10x</option>
                        <option value="11">11x</option>
                        <option value="12">12x (Não recomendado)</option>
                        <option value="13">13x (Não recomendado)</option>
                        <option value="14">14x (Não recomendado)</option>
                        <option value="15">15x (Não recomendado)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label style="color: #db0038; font-weight: 700;">Nova Data de Vencimento</label>
                    <input type="date" id="reneg-nova-data" class="form-input" style="border: 2px solid #db0038;">
                    <p style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                        Isso altera a data manualmente, tirando o cliente do atraso até o dia escolhido.
                    </p>
                </div>

                <button id="btn-confirmar-renegociacao" class="primary-btn"
                    style="width: 100%; margin-top: 15px; background: #db0038;">
                    CONFIRMAR ALTERAÇÃO
                </button>
            </div>
        </div>
    </div>

    <!-- Banner de Atualização (Top Bar) -->
    <style>
        #system-update-banner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 10000;
            background: #db0038;
            /* Vermelho Primário */
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateY(-100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            font-family: 'Inter', sans-serif;
        }

        #system-update-banner.visible {
            transform: translateY(0);
        }

        .update-banner-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .update-banner-icon {
            font-size: 1.4rem;
            animation: spin-slow 3s linear infinite;
        }

        .update-banner-text {
            font-size: 1rem;
            font-weight: 500;
        }

        .update-banner-text strong {
            font-weight: 700;
            text-transform: uppercase;
        }

        .btn-update-banner {
            background: white;
            color: #db0038;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-update-banner:hover {
            background: #111;
            color: white;
        }

        @keyframes spin-slow {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }
    </style>

    <div id="system-update-banner">
        <div class="update-banner-content">
            <i class='bx bx-refresh update-banner-icon'></i>
            <span class="update-banner-text">
                <strong>Atualização Necessária:</strong> Uma nova versão do sistema está disponível.
            </span>
        </div>
        <button id="btn-update-refresh" class="btn-update-banner">
            <i class='bx bx-download' style="margin-right: 6px;"></i> ATUALIZAR AGORA (F5)
        </button>
    </div>

    <div class="modal-overlay" id="cliente-pay-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Receber de Cliente</h3>
                <button class="close-modal-btn" data-target="cliente-pay-modal"><i class='bx bx-x'></i></button>
            </div>
            <form id="cliente-pay-form">
                <div class="modal-body">
                    <p>Registrar pagamento para: <strong id="pay-cliente-nome">...</strong></p>
                    <p class="text-sm text-light mb-16">
                        Saldo Atual: <span id="pay-cliente-saldo-atual" class="text-danger font-bold">R$ 0,00</span>
                    </p>

                    <div class="form-group">
                        <label for="pay-valor">Valor do Pagamento (R$) *</label>
                        <input type="number" id="pay-valor" step="0.01" min="0.01" placeholder="0,00" required
                            data-primary-focus="true">
                    </div>

                    <div class="form-group">
                        <label for="pay-metodo">Forma de Pagamento *</label>
                        <select id="pay-metodo" required>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="PIX">PIX</option>
                            <option value="Cartão">Cartão</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn"
                        data-target="cliente-pay-modal">Cancelar</button>
                    <button type="submit" class="btn btn-success">
                        <i class='bx bx-dollar-circle'></i> Confirmar Pagamento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="main-content" id="main-content">

        <div class="app-header">
            <h1>Ponto de Venda</h1>
            <div style="display: flex; gap: 12px; align-items: center;">
                <button class="btn-radio" onclick="window.open('radio.html', '_blank')">
                    <div class="sound-wave-icon">
                        <span class="sound-wave-bar"></span>
                        <span class="sound-wave-bar"></span>
                        <span class="sound-wave-bar"></span>
                        <span class="sound-wave-bar"></span>
                    </div>
                    Rádio
                </button>
                <button class="btn btn-danger" id="header-close-caixa-btn" style="display: none;">
                    <i class='bx  bxs-store-alt-2'></i> Fechar Loja
                </button>
            </div>
        </div>


        <nav class="navbar" id="main-navbar">
            <span class="navbar-item active" data-page="pdv">PDV</span>
            <span class="navbar-item" data-page="pedidos">Pedidos</span>
            <span class="navbar-item" data-page="historico">Histórico</span>

            <div class="navbar-more-container">
                <div class="navbar-item" id="more-menu-btn">
                    Gerenciamento
                    <i class='bx bx-chevron-down' id="more-menu-icon"></i>
                </div>

                <div class="more-menu-modal" id="more-menu-modal">
                    <div class="more-menu-item" data-page="produtos">
                        <div class="item-icon-box"><i class='bx bx-package'></i></div>
                        <div class="item-content">
                            <strong>Produtos</strong>
                            <span></span>
                        </div>
                    </div>

                    <div class="more-menu-item" data-page="clientes">
                        <div class="item-icon-box"><i class='bx bx-group'></i></div>
                        <div class="item-content">
                            <div class="title-row">
                                <strong>Crediário Digital</strong>
                                <span class="pro-tag">Pro</span>
                            </div>
                            <span></span>
                        </div>
                    </div>

                    <div class="menu-divider"></div>

                    <div class="more-menu-item" data-page="infinitepay">
                        <div class="item-icon-box"><i class='bx bx-percentage'></i></div>
                        <div class="item-content">
                            <strong>InfinitePay</strong>
                            <span></span>
                        </div>
                    </div>

                    <div class="more-menu-item" data-page="notas">
                        <div class="item-icon-box"><i class='bx bx-file'></i></div>
                        <div class="item-content">
                            <strong>Notas Fiscais</strong>
                            <span></span>
                        </div>
                    </div>

                    <div class="more-menu-item" data-page="configuracoes">
                        <div class="item-icon-box"><i class='bx bx-cog'></i></div>
                        <div class="item-content">
                            <strong>Configurações</strong>
                            <span></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="navbar-highlight" id="navbar-highlight"></div>
        </nav>



        <div id="pdv-page" class="page-content">
            <div class="pdv-layout">
                <div class="pdv-main">
                    <div class="scan-search-container">
                        <div class="tooltip" style="flex-grow: 1;">
                            <div class="barcode-scanner">
                                <i class='bx bx-barcode-reader'></i>
                                <input type="text" id="barcode-input" placeholder="Carregando produtos..." disabled
                                    autocomplete="off">
                            </div>
                            <span class="tooltip-text">Digite o código</span>
                        </div>
                        <button class="btn-search-pdv" id="btn-open-adv-search" title="Pesquisar Produto (F2)">
                            <i class='bx bx-search'></i>
                        </button>
                    </div>
                    <p class="shortcut-hint" id="barcode-hint">Carregando produtos...</p>

                    <div class="item-list-container empty" id="item-list-container">

                        <div class="empty-state" id="empty-state" style="display: flex;">
                            <div class="empty-content-wrapper">
                                <img src="assets/dtudo.png" alt="Logo da Loja" class="empty-store-logo"
                                    onerror="this.style.display='none'; document.getElementById('fallback-icon').style.display='block'">

                                <i class='bx bx-store-alt' id="fallback-icon" style="display:none;"></i>

                                <h3 class="empty-title">Caixa Livre</h3>
                                <p class="empty-subtitle">Aguardando leitura de produtos...</p>

                                <div class="scanner-line-anim"></div>
                            </div>
                        </div>

                        <table class="item-list-table" id="item-list-table" style="display: none;">
                            <thead>
                                <tr>
                                    <th style="padding-left: 20px;">Produto</th>
                                    <th class="text-center">Qtd.</th>
                                    <th class="text-center">Unitário</th>
                                    <th class="text-center">Desc. %</th>
                                    <th class="text-right" style="padding-right: 20px;">Total</th>
                                    <th width="50"></th>
                                </tr>
                            </thead>
                            <tbody id="cart-items-body"></tbody>
                        </table>
                    </div>
                </div>

                <aside class="pdv-summary">
                    <div class="card pdv-summary-card">

                        <div class="client-summary-box" id="summary-client-card">
                            <div class="client-box-header">
                                <div class="client-info-wrapper">
                                    <div class="client-icon-avatar" id="client-avatar-icon">
                                        <i class='bx bx-user'></i>
                                    </div>
                                    <div class="client-text-data">
                                        <span class="client-label">Cliente</span>
                                        <strong id="summary-client-name-text">Consumidor Final</strong>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn-icon-small btn-danger-soft" id="btn-remove-client"
                                        style="display: none;" title="Remover">
                                        <i class='bx bx-x'></i>
                                    </button>
                                    <button class="btn-icon-small" id="btn-change-summary-client" title="Pesquisar">
                                        <i class='bx bx-search'></i>
                                    </button>
                                </div>
                            </div>
                            <div id="client-credit-info" style="display: none; margin-top: 10px;">
                                <div class="summary-limit-bar">
                                    <div class="summary-limit-fill" id="summary-limit-fill"></div>
                                </div>
                                <div class="summary-limit-text">
                                    <span id="summary-limit-label">Limite Disp.</span>
                                    <span id="summary-limit-value">R$ 0,00</span>
                                </div>
                            </div>
                        </div>

                        <div class="spacer-20"></div>

                        <div class="summary-controls-title">Ações da Venda</div>
                        <div class="summary-controls-grid">

                            <div class="control-btn" id="discount-toggle-row">
                                <div class="c-icon"><i class='bx bx-purchase-tag'></i></div>
                                <div class="c-label">Desconto</div>
                                <div class="c-value" id="summary-discount-btn-val">R$ 0,00</div>
                            </div>

                            <div class="control-btn" id="payment-toggle-row">
                                <div class="c-icon"><i class='bx bx-credit-card'></i></div>
                                <div class="c-label">Pagamento</div>
                                <div class="c-value highlight" id="summary-payment-method">Escolher</div>
                            </div>

                            <div class="control-btn" id="seller-toggle-row">
                                <div class="c-icon"><i class='bx bx-id-card'></i></div>
                                <div class="c-label">Vendedor</div>
                                <div class="c-value" id="summary-seller-name">Nubia</div>
                            </div>

                        </div>

                        <div class="discount-popover" id="discount-popover">
                            <div class="popover-inner">
                                <label>Valor em R$</label>
                                <div class="input-group-modern">
                                    <input type="number" id="discount-input-r" placeholder="0,00" step="0.01">
                                </div>

                                <!-- Porcentagem removed as requested -->
                                <label style="margin-top: 10px;">Rápido</label>
                                <div class="discount-perc-buttons" id="perc-btn-container">
                                    <button class="perc-btn" data-perc="3">3%</button>
                                    <button class="perc-btn" data-perc="5">5%</button>
                                    <button class="perc-btn" data-perc="7">7%</button>
                                    <button class="perc-btn" data-perc="10">10%</button>
                                </div>
                                <button class="btn-remove-discount" id="remove-discount-btn">Remover</button>
                            </div>
                        </div>
                        <div class="discount-popover" id="seller-popover">
                            <div class="popover-inner">
                                <div class="seller-grid">
                                    <button class="perc-btn seller-btn" data-name="Nubia">Nubia</button>
                                    <button class="perc-btn seller-btn" data-name="Evelyn">Evelyn</button>
                                    <button class="perc-btn seller-btn" data-name="Ryan">Ryan</button>
                                    <button class="perc-btn seller-btn" data-name="Oliveira">Oliveira</button>
                                </div>
                            </div>
                        </div>

                        <div class="spacer-auto"></div>

                        <div class="receipt-calculation-box">
                            <div class="calc-row">
                                <span class="calc-label">Subtotal (<span id="item-count">0</span> itens)</span>
                                <span class="calc-val" id="summary-subtotal">R$ 0,00</span>
                            </div>

                            <div class="calc-row discount-row" id="row-discount-display"
                                style="display:none; color: var(--success-green);">
                                <span class="calc-label">Descontos Aplicados</span>
                                <span class="calc-val" id="summary-discount">- R$ 0,00</span>
                            </div>

                            <div class="divider-dashed"></div>

                            <div class="calc-row total-row">
                                <span class="calc-label">TOTAL A PAGAR</span>
                                <span class="calc-val-lg" id="summary-total">R$ 0,00</span>
                            </div>

                            <div class="change-display-row" id="summary-change-row" style="display: none;">
                                <span class="change-label">Troco Estimado</span>
                                <span class="change-value" id="summary-change-value">R$ 0,00</span>
                            </div>

                            <div class="calc-row" id="open-tax-modal">
                                <span class="calc-label">Imposto</span>
                                <span id="tax-counter-val">0,00</span>
                            </div>

                            <div class="calc-row" id="infinitepay-tax-row">
                                <span class="calc-label">Taxa InfinitePay</span>
                                <span id="infinitepay-tax-val">R$ 0,00</span>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary btn-lg" id="finish-sale-btn">
                                <i class='bxrdm  bx-basket'></i>
                                <div style="display:flex; flex-direction:column; align-items:flex-start;">
                                    <span>Finalizar</span>
                                    <span style="font-size: 0.75rem; opacity: 0.8;"></span>
                                </div>
                            </button>
                            <button class="btn btn-secondary-icon" id="cancel-sale-btn" title="Cancelar Venda">
                                <i class='bx bx-trash'></i>
                            </button>
                        </div>

                    </div>
                </aside>
            </div>
        </div>

        <div id="pedidos-page" class="page-content" style="display: none;">
            <div class="card card-lg card-transparent">
                <div class="page-header header-styled">
                    <div>
                        <h2><i class='bx bx-shopping-bag'></i> Pedidos Online</h2>
                        <p class="text-light no-margin">Gerencie as vendas em tempo real.</p>
                    </div>
                    <div>
                        <button class="btn btn-secondary btn-auto">
                            <i class='bx bx-refresh'></i> Atualizar
                        </button>
                    </div>
                </div>

                <div class="orders-tabs" id="order-status-tabs">
                    <div class="order-tab active" data-status="pendente">
                        Pendentes <span class="badge warning" id="count-pendente">0</span>
                    </div>
                    <div class="order-tab" data-status="preparando">
                        Preparando <span class="badge neutral" id="count-preparando">0</span>
                    </div>
                    <div class="order-tab" data-status="enviado">
                        Enviados
                    </div>
                    <div class="order-tab" data-status="finalizado">
                        Finalizados
                    </div>
                </div>

                <div id="orders-grid-container" class="orders-grid">
                    <p class="grid-full text-center text-light pad-40">
                        <i class='bx bx-loader-alt bx-spin font-2rem'></i><br>Carregando...
                    </p>
                </div>
            </div>
        </div>

        <div id="produtos-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header">
                    <div>
                        <h2>Gerenciador de Produtos</h2>
                        <p class="text-light mt-4 mb-0 text-sm">Controle de estoque e definições fiscais.</p>
                    </div>
                    <div style="display: flex; gap: 5px; max-height: 15px;">
                        <a class='btn btn-primary' href='/pdv/price'>
                            <i class='bx  bxs-pencil-sparkles'></i> Novo
                        </a>
                        <br>
                        <button class="btn btn-primary" id="btn-add-product" title="Cadastrar Novo Item">
                            <i class='bx bx-plus'></i> Adicionar
                        </button>
                    </div>
                </div>

                <div class="toolbar-products mb-24">
                    <div class="search-box-wrapper" style="flex: 1;">
                        <div class="client-search-container">
                            <i class='bx bx-search client-search-icon'></i>
                            <input type="text" id="products-search-input" class="client-search-input"
                                placeholder="Buscar por nome, código ou NCM..." autocomplete="off">
                        </div>
                    </div>

                    <div class="filter-capsules" id="product-filters">
                        <button class="filter-cap active" data-filter="all">
                            Todos <span class="badge-count" id="count-all">0</span>
                        </button>
                        <button class="filter-cap" data-filter="fiscal_ok">
                            <i class='bx bx-check-circle'></i> Fiscal OK <span class="badge-count"
                                id="count-ok">0</span>
                        </button>
                        <button class="filter-cap" data-filter="fiscal_pending">
                            <i class='bx bx-error-circle'></i> Pendente <span class="badge-count"
                                id="count-pending">0</span>
                        </button>
                    </div>
                </div>

                <div id="produtos-table-container" class="products-list-wrapper">
                </div>
            </div>
        </div>

        <div id="clientes-page" class="page-content" style="display: none;">
            <div class="card">
                <div class="page-header">
                    <div>
                        <div class="title-page">
                            <h2>Crediário Digital</h2>
                            <span class="pro-badge-main pro-tag">PRO</span>
                        </div>
                        <p class="text-light mt-4 mb-0 text-sm">Gerencie pagamentos e inadimplência.</p>
                    </div>
                    <button class="btn btn-primary btn-auto" id="add-cliente-btn">
                        <i class='bx bx-user-plus'></i> Novo Cliente
                    </button>
                </div>

                <div class="search-box-wrapper mb-20">
                    <div class="client-search-container">
                        <i class='bx bx-search client-search-icon'></i>
                        <input type="text" id="clientes-page-search" class="client-search-input"
                            placeholder="Buscar cliente por nome ou apelido..." autocomplete="off">
                    </div>
                </div>
                <div id="clientes-list-container">
                </div>
            </div>
        </div>


        <div id="infinitepay-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header header-styled">
                    <div>
                        <h2>InfinitePay</h2>
                        <div class="dropdown-badge-container">
                            <span class="dropdown-badge-label">Faturamento Mensal</span>
                            <div class="dropdown-badge">
                                R$ 20.000,00 <i class='bx bx-chevron-down'></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <a href="https://www.infinitepay.io/taxas" target="_blank" class="btn btn-secondary btn-auto">
                            <i class='bx bx-link-external'></i> Verificar Online
                        </a>
                    </div>
                </div>

                <div class="rates-overview-grid"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="rate-highlight-card"
                        style="background: #f0fdf4; border: 1px solid #bbf7d0; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 3rem; color: #16a34a; margin-bottom: 10px;"><i class='bx bx-money'></i>
                        </div>
                        <h3 style="color: #166534; margin: 0;">Grátis</h3>
                        <p style="color: #15803d; font-weight: 600; margin-top: 5px;">PIX</p>
                        <small style="color: #14532d;">Recebimento Imediato</small>
                    </div>

                    <div class="rate-highlight-card"
                        style="background: #eff6ff; border: 1px solid #bfdbfe; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 3rem; color: #2563eb; margin-bottom: 10px;"><i
                                class='bx bx-credit-card-front'></i></div>
                        <h3 style="color: #1e40af; margin: 0;">0,85%</h3>
                        <p style="color: #1d4ed8; font-weight: 600; margin-top: 5px;">Débito</p>
                        <small style="color: #1e3a8a;">Receba na hora</small>
                    </div>

                    <div class="rate-highlight-card"
                        style="background: #fff7ed; border: 1px solid #fed7aa; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 3rem; color: #ea580c; margin-bottom: 10px;"><i
                                class='bx bx-credit-card'></i>
                        </div>
                        <h3 style="color: #9a3412; margin: 0;">2,89%</h3>
                        <p style="color: #c2410c; font-weight: 600; margin-top: 5px;">Crédito à Vista</p>
                        <small style="color: #7c2d12;">Receba na hora</small>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                    <i class='bx bx-layer'></i> Parcelamento Inteligente - Recebimento em 1 dia útil
                </h3>

                <div class="rates-tables-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">

                    <!-- Tabela Visa/Master -->
                    <div class="rate-table-card"
                        style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; background: #fff;">
                        <div
                            style="display: flex; gap: 15px; margin-bottom: 20px; justify-content: center; align-items: center; height: 50px;">
                            <img src="https://cdn.prod.website-files.com/65c1399ac999a342139b5069/65c1399ac999a342139b50c9_visa-color.svg"
                                alt="Visa" style="height: 100%; max-height: 25px;">
                            <img src="https://cdn.prod.website-files.com/65c1399ac999a342139b5069/65c1399ac999a342139b50b0_mastercard-color.svg"
                                alt="Mastercard" style="height: 100%; max-height: 30px;">
                        </div>

                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <tbody>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">Pix</td>
                                    <td style="text-align: right; color: #8b5cf6; font-weight: 700;">GRÁTIS</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">Débito</td>
                                    <td style="text-align: right; font-weight: 600;">0,85%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">Crédito à vista</td>
                                    <td style="text-align: right; font-weight: 600;">2,89%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">2x</td>
                                    <td style="text-align: right; font-weight: 600;">4,22%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">3x</td>
                                    <td style="text-align: right; font-weight: 600;">4,83%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">4x</td>
                                    <td style="text-align: right; font-weight: 600;">5,44%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">5x</td>
                                    <td style="text-align: right; font-weight: 600;">6,05%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">6x</td>
                                    <td style="text-align: right; font-weight: 600;">6,64%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">7x</td>
                                    <td style="text-align: right; font-weight: 600;">7,24%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">8x</td>
                                    <td style="text-align: right; font-weight: 600;">7,82%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">9x</td>
                                    <td style="text-align: right; font-weight: 600;">8,41%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">10x</td>
                                    <td style="text-align: right; font-weight: 600;">8,98%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">11x</td>
                                    <td style="text-align: right; font-weight: 600;">9,56%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">12x</td>
                                    <td style="text-align: right; font-weight: 600;">10,12%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Tabela Elo/Amex -->
                    <div class="rate-table-card"
                        style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; background: #fff;">
                        <div
                            style="display: flex; gap: 15px; margin-bottom: 20px; justify-content: center; align-items: center; height: 50px;">
                            <img src="https://cdn.prod.website-files.com/65c1399ac999a342139b5069/66765121a8248fc1ad184e0b_elo_badge.webp"
                                alt="Elo" style="height: 100%; max-height: 30px;">
                            <img src="https://cdn.prod.website-files.com/65c1399ac999a342139b5069/65d3ebcbef002fade4c9fd32_icon-flag-amex.svg"
                                alt="Amex" style="height: 100%; max-height: 30px;">
                        </div>

                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <tbody>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">Pix</td>
                                    <td style="text-align: right; color: #8b5cf6; font-weight: 700;">GRÁTIS</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">Débito</td>
                                    <td style="text-align: right; font-weight: 600;">2,08%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">Crédito à vista</td>
                                    <td style="text-align: right; font-weight: 600;">4,65%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">2x</td>
                                    <td style="text-align: right; font-weight: 600;">6,09%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">3x</td>
                                    <td style="text-align: right; font-weight: 600;">6,69%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">4x</td>
                                    <td style="text-align: right; font-weight: 600;">7,28%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">5x</td>
                                    <td style="text-align: right; font-weight: 600;">7,87%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">6x</td>
                                    <td style="text-align: right; font-weight: 600;">8,46%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">7x</td>
                                    <td style="text-align: right; font-weight: 600;">9,05%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">8x</td>
                                    <td style="text-align: right; font-weight: 600;">9,63%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">9x</td>
                                    <td style="text-align: right; font-weight: 600;">10,20%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">10x</td>
                                    <td style="text-align: right; font-weight: 600;">10,76%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">11x</td>
                                    <td style="text-align: right; font-weight: 600;">11,33%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 8px 0;">12x</td>
                                    <td style="text-align: right; font-weight: 600;">11,88%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="caixa-page" class="page-content" style="display: none;"></div>

        <div id="historico-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header header-styled">
                    <div>
                        <h2><i class='bx bx-history'></i> Vendas de Hoje</h2>
                        <p class="text-light mt-4 mb-0 text-sm">Resumo das movimentações do caixa atual.</p>
                    </div>
                    <button class="btn btn-secondary btn-auto" id="btn-refresh-history">
                        <i class='bx bx-refresh'></i> Atualizar
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="products-table" id="history-table">
                        <thead>
                            <tr>
                                <th>Hora</th>
                                <th>Cliente</th>
                                <th>Pagamento</th>
                                <th>Valor</th>
                                <th class="text-center">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="sales-history-list">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="notas-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header header-styled">
                    <div>
                        <h2><i class='bx bx-receipt'></i> Notas Fiscais</h2>
                        <p class="text-light mt-4 mb-0 text-sm">Histórico de emissões e regularização de produtos.</p>
                    </div>
                    <div class="header-actions">
                        <span class="badge warning"> Ambiente Produção</span>
                    </div>
                </div>

                <div class="orders-tabs" id="notas-tabs">
                    <div class="order-tab active" data-view="emitidas">Emitidas</div>
                    <div class="order-tab" data-view="pendentes">Itens Pendentes</div>
                </div>

                <div id="view-notas-emitidas" class="mt-20">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th width="150px">N° da Nota</th>
                                <th>Destinatário</th>
                                <th>Emissão</th>
                                <th>Valor</th>
                                <th class="text-right">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="lista-notas-emitidas">
                        </tbody>
                    </table>
                </div>

                <div id="view-notas-pendentes" class="mt-20" style="display: none;">
                    <div class="status-box warning" style="text-align: left; padding: 15px; margin-bottom: 20px;">
                        <i class='bx bx-info-circle'></i>
                        <span>Estes itens foram vendidos mas removidos da nota fiscal por falta de cadastro completo.
                            Complete o cadastro em "Produtos" para futuras vendas.</span>
                    </div>
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Venda Origem</th>
                                <th>Motivo</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody id="lista-itens-pendentes">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="modal-ver-nota">
            <div class="modal-content modal-md">
                <div class="modal-header">
                    <h3>DANFE NFC-e (Homologação)</h3>
                    <button class="close-modal-btn" data-target="modal-ver-nota"><i class='bx bx-x'></i></button>
                </div>
                <div class="modal-body"
                    style="background: #fff8dc; color: #5d4037; font-family: 'Courier New', monospace; padding: 20px; border: 1px dashed #333;">
                    <div
                        style="text-align: center; border-bottom: 1px dashed #333; padding-bottom: 10px; margin-bottom: 10px;">
                        <h4>A N F DA SILVA LTDA</h4>
                        <p>CNPJ: 45.692.327/0001-00</p>
                        <p><strong>AMBIENTE DE HOMOLOGAÇÃO - SEM VALOR FISCAL</strong></p>
                    </div>
                    <div id="danfe-itens-list"></div>
                    <div
                        style="border-top: 1px dashed #333; margin-top: 10px; padding-top: 10px; display: flex; justify-content: space-between; font-weight: bold;">
                        <span>TOTAL R$</span>
                        <span id="danfe-total-valor">0,00</span>
                    </div>
                    <div style="text-align: center; margin-top: 20px; font-size: 0.8rem;">
                        <p>EMISSÃO NORMAL</p>
                        <p id="danfe-chave">1525 1245 6923 ...</p>
                        <p>Consulte pela Chave de Acesso em<br>www.sefaz.pa.gov.br</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="emission-loader-overlay"
            style="display: none; align-items: center; justify-content: center;">
            <div class="modal-content"
                style="max-width: 400px; text-align: center; padding: 40px; border-radius: var(--radius-lg);">

                <div class="fiscal-animation-box">
                    <div class="main-icon-wrapper">
                        <i class='bx bx-file-find' id="loader-main-icon"></i>
                        <div class="scan-bar"></div>
                    </div>
                </div>

                <h3 id="loader-title" style="margin-top: 20px; color: var(--text-dark); font-weight: 700;">Processando
                </h3>
                <p id="loader-status" style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 25px;">
                    Aguardando sistema...</p>

                <div class="progress-wrapper"
                    style="background: #f1f5f9; height: 8px; border-radius: 10px; overflow: hidden; margin-bottom: 30px;">
                    <div id="emission-progress"
                        style="width: 0%; height: 100%; background: var(--primary-color); transition: width 0.4s ease;">
                    </div>
                </div>

                <div id="fiscal-steps-container" class="steps-grid">
                    <div class="step-row" id="step-1"><i class='bx bx-circle'></i> <span>Gerando XML</span></div>
                    <div class="step-row" id="step-2"><i class='bx bx-circle'></i> <span>Assinando Dados</span></div>
                    <div class="step-row" id="step-3"><i class='bx bx-circle'></i> <span>Comunicando SEFAZ</span></div>
                    <div class="step-row" id="step-4"><i class='bx bx-circle'></i> <span>Autorizando</span></div>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="sale-details-modal">
            <div class="modal-content modal-md sale-details-modern">
                <div class="modal-header">
                    <div class="header-title-group">
                        <div>
                            <h3>Detalhes da Venda</h3>
                            <small id="hist-det-id" style="color:var(--text-light)">ID: #000000</small>
                        </div>
                    </div>
                    <button class="close-modal-btn" data-target="sale-details-modal"><i class="bx bx-x"></i></button>
                </div>

                <div class="modal-body">
                    <div class="summary-card">
                        <div class="summary-item">
                            <small>Total da Venda</small>
                            <h2 id="hist-det-valor">R$ 0,00</h2>
                        </div>
                        <div class="summary-badge-wrapper">
                            <span class="modern-badge" id="hist-det-pagamento">PIX</span>
                        </div>
                    </div>

                    <div class="info-details-grid">
                        <div class="info-box">
                            <i class='bx bx-user'></i>
                            <div>
                                <small>Cliente</small>
                                <strong id="hist-det-cliente">Cliente Balcão</strong>
                            </div>
                        </div>
                        <div class="info-box">
                            <i class='bx bx-id-card'></i>
                            <div>
                                <small>Vendedor</small>
                                <strong id="hist-det-vendedor">Caixa Principal</strong>
                            </div>
                        </div>
                        <div class="info-box">
                            <i class='bx bx-time-five'></i>
                            <div>
                                <small>Data e Hora</small>
                                <strong id="hist-det-hora">00/00/0000 00:00</strong>
                            </div>
                        </div>
                    </div>

                    <div class="items-section">
                        <h4 class="section-title"><i class='bx bx-list-ul'></i> Itens do Pedido</h4>
                        <div class="modern-items-list" id="hist-det-itens">
                        </div>
                    </div>
                </div>

                <div class="modal-footer footer-horizontal">
                    <button class="btn btn-secondary close-modal-btn" data-target="sale-details-modal">
                        Fechar
                    </button>
                    <button class="btn btn-primary btn-lg" id="btn-reprint-history">
                        <i class="bx bx-printer"></i> Reimprimir Comprovante
                    </button>
                </div>
            </div>
        </div>

        <div id="configuracoes-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header">
                    <h2>Configurações</h2>
                </div>
                <div class="setting-row">
                    <div class="setting-info">
                        <h3>Arredondamento Inteligente de Troco</h3>
                        <p>Quando ativado, os descontos por porcentagem arredondam o valor total da compra para o R$
                            0,50 mais próximo.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="smart-rounding-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <div class="setting-info">
                        <h3>Cache de Produtos</h3>
                        <p>Recarrega a lista de produtos do banco de dados.</p>
                    </div>
                    <button class="btn btn-secondary btn-auto" id="reload-cache-btn">
                        <i class='bx bx-sync'></i> Recarregar
                    </button>
                </div>
            </div>
        </div>

    </div>

    <div class="modal-overlay" id="open-caixa-modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>Abrir Caixa</h3>
            </div>
            <form id="open-caixa-form">
                <div class="modal-body">
                    <p>Informe o valor inicial para troco ou abra sem valor.</p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="open-caixa-notas">Valor em Notas (R$)</label>
                            <input type="number" id="open-caixa-notas" step="0.01" min="0" placeholder="0,00"
                                data-primary-focus="true">
                        </div>
                        <div class="form-group">
                            <label for="open-caixa-moedas">Valor em Moedas (R$)</label>
                            <input type="number" id="open-caixa-moedas" step="0.01" min="0" placeholder="0,00">
                        </div>
                    </div>
                    <div class="toggle-switch-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="open-caixa-sem-valor">
                            <span class="slider"></span>
                        </label>
                        <label for="open-caixa-sem-valor">Abrir caixa sem valor inicial</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="open-caixa-save-btn">
                        <i class='bx bx-check'></i> Confirmar Abertura
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="tax-details-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Transparência Tributária 2026</h3>
                <button class="close-modal-btn" data-target="tax-details-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="tax-breakdown-header">
                    <p>Com base na Reforma Tributária, veja a composição do que será recolhido nesta venda:</p>
                </div>

                <table class="tax-table">
                    <thead>
                        <tr>
                            <th>Tributo</th>
                            <th>% Part.</th>
                            <th>Valor (R$)</th>
                        </tr>
                    </thead>
                    <tbody id="tax-breakdown-body">
                    </tbody>
                </table>

                <div class="tax-footer-info">
                    <p><i class='bx bx-info-circle'></i> <strong>Nota:</strong> Em 2026, as empresas do Simples Nacional
                        estão em fase de transição. O valor acima é uma estimativa da repartição tributária dentro da
                        guia DAS.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="modal-confirm-fiscal" style="z-index: 10000;">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class='bx bx-spreadsheet'></i> Emissão NFC-e</h3>
                <button class="close-modal-btn" data-target="modal-confirm-fiscal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body fiscal-body-vertical">

                <div class="fiscal-section">
                    <h4 class="section-label"><i class='bx bx-money'></i> Resumo do Recebimento</h4>
                    <div class="fiscal-row-grid">
                        <div class="fiscal-stat-item">
                            <span class="lbl">Total da Venda</span>
                            <span class="val" id="confirm-venda-total">R$ 0,00</span>
                        </div>
                        <div class="fiscal-stat-item">
                            <span class="lbl">Forma Pagto</span>
                            <span class="val" id="confirm-fiscal-payment-method">---</span>
                        </div>
                        <div class="fiscal-stat-item">
                            <span class="lbl">Dinheiro Recebido</span>
                            <span class="val" id="confirm-valor-recebido">R$ 0,00</span>
                        </div>
                        <div class="fiscal-stat-item">
                            <span class="lbl">Troco Real</span>
                            <span class="val" id="confirm-troco-real" style="color: var(--primary-red);">R$ 0,00</span>
                        </div>
                    </div>
                </div>

                <div class="fiscal-section">
                    <h4 class="section-label text-success"><i class='bx bx-check-double'></i> Itens Enviados ao Fisco
                        (XML)</h4>
                    <div class="fiscal-items-header">
                        <span>Item / NCM</span>
                        <span class="text-right">Unit. (c/ Desc.)</span>
                        <span class="text-right">Subtotal</span>
                    </div>
                    <div id="confirm-fiscal-apt-list" class="fiscal-scroll-list"></div>
                </div>

                <div class="fiscal-section" id="section-ignored-fiscal" style="display:none;">
                    <h4 class="section-label text-warning"><i class='bx bx-error'></i> Itens Sem Validade Fiscal
                        (*pendente)</h4>
                    <div id="confirm-fiscal-ignored-list" class="fiscal-scroll-list ignored"></div>
                </div>

                <div class="fiscal-summary-box">
                    <div class="summary-line">
                        <span>Base de Cálculo (Total Fiscal):</span>
                        <strong id="confirm-base-fiscal">R$ 0,00</strong>
                    </div>
                    <div class="summary-line">
                        <span title="Valor informado no campo detPag para evitar rejeição de vPag < vNF">Informado à
                            SEFAZ (vPag):</span>
                        <strong id="confirm-vpag-sefaz">R$ 0,00</strong>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="btn-cancel-fiscal">Não Emitir</button>
                <button class="btn btn-primary" id="btn-confirm-emission" style="background: #10b981;">
                    <i class='bx bx-paper-plane'></i> Confirmar e Emitir
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="edit-product-modal">
        <div class="modal-content modal-lg transition-all">
            <div class="modal-header">
                <h3><i class='bx bx-edit'></i> Editar Produto</h3>
                <div class="header-actions">
                    <button class="window-control-btn" id="btn-maximize-modal" title="Expandir/Restaurar">
                        <i class='bx bx-expand'></i>
                    </button>
                    <button class="window-control-btn close-modal-btn" data-target="edit-product-modal" title="Fechar">
                        <i class='bx bx-x'></i>
                    </button>
                </div>
            </div>
            <form id="edit-product-form">
                <div class="modal-body product-edit-layout">

                    <div class="edit-col-left">
                        <div class="image-upload-wrapper">
                            <div class="product-img-preview" id="edit-img-preview">
                                <i class='bx bx-image-add'></i>
                            </div>
                            <label class="url-input-label">URL da Imagem</label>
                            <input type="text" id="edit-prod-img-url" placeholder="https://..." class="sm-input">
                        </div>
                    </div>

                    <div class="edit-col-right">

                        <div class="form-grid">
                            <div class="form-group" style="flex: 1;">
                                <label>Código (Barcode)</label>
                                <div class="input-group-lock">
                                    <input type="text" id="edit-prod-code" disabled class="bg-locked"
                                        style="font-weight:700;">
                                    <button type="button" class="btn-unlock" id="btn-unlock-code"
                                        title="Alterar Código">
                                        <i class='bx bx-lock-alt'></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group" style="flex: 2.5;">
                                <label>Nome do Produto *</label>
                                <input type="text" id="edit-prod-name" required placeholder="Ex: Cabo USB Tipo C">
                            </div>
                        </div>

                        <div class="form-group relative-container">
                            <label>Marca / Fabricante</label>
                            <div class="input-with-icon">
                                <input type="text" id="edit-prod-brand" placeholder="Digite para buscar..."
                                    autocomplete="off">
                                <i class='bx bx-search'></i>
                            </div>
                            <div id="brand-suggestions-list" class="suggestions-dropdown"></div>
                        </div>

                        <div class="pricing-card">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Preço de Custo (R$)</label>
                                    <input type="number" id="edit-prod-cost" step="0.01" placeholder="0,00">
                                </div>
                                <div class="form-group">
                                    <label>Preço de Venda (R$)</label>
                                    <input type="number" id="edit-prod-price" step="0.01" required placeholder="0,00">
                                </div>
                                <div class="form-group">
                                    <label>Estoque Atual</label>
                                    <input type="number" id="edit-prod-stock" disabled class="bg-locked"
                                        title="Use Entrada de Nota">
                                </div>
                            </div>
                            <div class="profit-stats">
                                <div class="stat-item"><span class="lbl">Margem:</span><span class="val"
                                        id="calc-margin">0%</span></div>
                                <div class="stat-item"><span class="lbl">Markup:</span><span class="val"
                                        id="calc-markup">0%</span></div>
                                <div class="stat-item"><span class="lbl">Lucro:</span><span class="val text-success"
                                        id="calc-profit">R$ 0,00</span></div>
                            </div>
                        </div>

                        <div class="fiscal-section-clean">
                            <div class="fiscal-header">
                                <i class='bx bx-file'></i>
                                <span>Dados Fiscais (Simples Nacional)</span>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label>NCM</label>
                                    <input type="text" id="edit-prod-ncm" placeholder="0000.00.00" maxlength="10">
                                </div>
                                <div class="form-group">
                                    <label>CEST <small class="text-light">(Subst. Trib.)</small></label>
                                    <input type="text" id="edit-prod-cest" placeholder="00.000.00" maxlength="9">
                                </div>
                                <div class="form-group">
                                    <label>CFOP</label>
                                    <input type="text" id="edit-prod-cfop" value="5102">
                                </div>
                            </div>

                            <div class="form-grid mt-10">
                                <div class="form-group" style="flex:1;">
                                    <label>Unidade</label>
                                    <select id="edit-prod-unit">
                                        <option value="UN">UN</option>
                                        <option value="KG">KG</option>
                                        <option value="CX">CX</option>
                                        <option value="L">L</option>
                                        <option value="M">M</option>
                                        <option value="PC">PC (Peça)</option>
                                        <option value="PCT">PCT (Pacote)</option>
                                    </select>
                                </div>
                                <div class="form-group" style="flex:2;">
                                    <label>Origem</label>
                                    <select id="edit-prod-origem">
                                        <option value="0">0 - Nacional</option>
                                        <option value="1">1 - Importação Direta</option>
                                        <option value="2">2 - Estrangeira (Adq. Interno)</option>
                                    </select>
                                </div>
                                <div class="form-group" style="flex:3;">
                                    <label>CSOSN</label>
                                    <select id="edit-prod-csosn">
                                        <option value="102">102 - Tributada s/ cred.</option>
                                        <option value="500">500 - Subst. Tributária</option>
                                        <option value="101">101 - Com permissão de cred.</option>
                                        <option value="900">900 - Outros</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn"
                        data-target="edit-product-modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary"><i class='bx bx-save'></i> Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="quick-add-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Produto não encontrado</h3>
                <button class="close-modal-btn" data-target="quick-add-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p>O código <strong id="scanned-barcode"></strong> não está cadastrado. Adicione um item rápido.</p>
                <form id="quick-add-form">
                    <div class="form-group">
                        <label for="quick-product-name">Nome do Produto</label>
                        <input type="text" id="quick-product-name" required data-primary-focus="true">
                    </div>
                    <div class="form-group">
                        <label for="quick-product-price">Preço (R$)</label>
                        <input type="number" id="quick-product-price" step="0.01" min="0.01" placeholder="0,00"
                            required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-modal-btn" data-target="quick-add-modal">Cancelar</button>
                <button class="btn btn-primary" id="quick-add-submit-btn">Adicionar à Venda</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="crediario-flow-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Finalizar Crediário</h3>
                <button class="close-modal-btn" data-target="crediario-flow-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body centered-flow">

                <div id="cred-step-1" class="qr-step-container">
                    <div class="modal-icon info" style="margin-bottom: 20px;">
                        <i class='bx bx-printer font-40'></i>
                    </div>
                    <p class="step-instruction">1. Imprima o comprovante</p>
                    <p class="step-subtext">Cliente: <strong id="cred-flow-client-name"
                            style="color:var(--text-dark)">...</strong></p>

                    <button id="btn-force-print">
                        <i class='bx bx-printer'></i> Imprimir Agora
                    </button>
                </div>

                <div id="cred-step-2" class="qr-step-container" style="display:none;">
                    <p class="step-instruction">2. Anexar Comprovante</p>
                    <p class="step-subtext">Escaneie para enviar a foto assinada:</p>

                    <div class="qr-code-box">
                        <img id="cred-qrcode-img" src="" alt="Gerando QR Code...">
                    </div>
                    <p class="text-xs text-light mt-10" style="font-size: 0.75rem;">
                        Link seguro: eletrobusiness.com.br/comprovante...
                    </p>

                    <div class="mt-24">
                        <button id="btn-finish-crediario-final" class="btn-success-flow">
                            <i class='bx bx-check'></i> Concluir Processo
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal-overlay" id="payment-modal">
        <div class="modal-content modal-modern-payment">
            <div class="modal-header header-minimal">
                <h3>Pagamento</h3>
                <button class="close-modal-btn" data-target="payment-modal"><i class="bx bx-x"></i></button>
            </div>

            <div class="modal-body-custom">
                <!-- Hero Section for Total -->
                <div class="payment-hero">
                    <span class="hero-label">Valor Total</span>
                    <h1 id="payment-total" class="hero-value">R$ 0,00</h1>
                </div>

                <div class="payment-content-wrapper">

                    <!-- Grid de Opções -->
                    <div class="payment-options-grid" id="single-payment-options">
                        <div class="payment-option payment-card" data-method="Dinheiro">
                            <div class="icon-box"><i class="bx bx-dollar-circle"></i></div>
                            <div class="card-info">
                                <span>Dinheiro</span>
                                <small>F6</small>
                            </div>
                        </div>
                        <div class="payment-option payment-card" data-method="PIX">
                            <div class="icon-box"><i class="bx bx-scan"></i></div>
                            <div class="card-info">
                                <span>PIX</span>
                                <small>F7</small>
                            </div>
                        </div>
                        <div class="payment-option payment-card" data-method="C. Crédito">
                            <div class="icon-box"><i class="bx bx-credit-card"></i></div>
                            <div class="card-info">
                                <span>Crédito</span>
                                <small>F8</small>
                            </div>
                        </div>
                        <div class="payment-option payment-card" data-method="C. Débito">
                            <div class="icon-box"><i class="bx bx-credit-card-alt"></i></div>
                            <div class="card-info">
                                <span>Débito</span>
                            </div>
                        </div>
                        <div class="payment-option payment-card" data-method="Movecard">
                            <div class="icon-box"><i class="bx bx-id-card"></i></div>
                            <div class="card-info">
                                <span>Movecard</span>
                            </div>
                        </div>
                        <div class="payment-option payment-card" data-method="Crediário" id="opt-crediario">
                            <div class="icon-box"><i class="bx bx-user-check"></i></div>
                            <div class="card-info">
                                <span>Crediário</span>
                            </div>
                        </div>
                    </div>

                    <div id="crediario-limit-feedback" class="modern-feedback" style="display: none;">
                        <div class="feedback-icon"><i class='bx bx-info-circle'></i></div>
                        <div class="feedback-content">
                            <span id="crediario-limit-text">Limite disponível: R$ 0,00</span>
                            <span id="crediario-status-text" class="status-subtext"></span>
                            <div class="mini-limit-bar">
                                <div class="mini-limit-fill" id="crediario-limit-fill"></div>
                            </div>
                        </div>
                    </div>

                    <div class="split-trigger-row" style="display: none;"">
                        <button class=" btn-text-action" id="split-payment-toggle-btn">
                        <i class='bx bx-columns'></i> Dividir em 2 formas
                        </button>
                    </div>

                    <!-- Split Payment Area -->
                    <div class="split-payment-area modern-split" id="split-payment-area" style="display: none;">
                        <h4 class="sub-title">Divisão de Pagamento</h4>
                        <div class="split-row">
                            <div class="split-col">
                                <label>1ª Forma</label>
                                <select id="split-method-1" class="split-select">
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="PIX">PIX</option>
                                    <option value="Cartão">Cartão</option>
                                </select>
                                <input type="number" id="split-value-1" step="0.01" class="split-input"
                                    placeholder="R$ 0,00">
                            </div>
                            <div class="split-icon"><i class='bx bx-plus'></i></div>
                            <div class="split-col">
                                <label>2ª Forma</label>
                                <select id="split-method-2" class="split-select">
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="PIX">PIX</option>
                                    <option value="Cartão">Cartão</option>
                                </select>
                                <input type="number" id="split-value-2" step="0.01" class="split-input"
                                    placeholder="R$ 0,00">
                            </div>
                        </div>
                        <div class="split-footer">
                            <div class="split-payment-remaining" id="split-payment-remaining">Restante: R$ 0,00</div>
                            <button class="btn-confirm-split" id="confirm-split-payment-btn" disabled>
                                Confirmar Divisão <i class='bx bx-check'></i>
                            </button>
                        </div>
                    </div>

                    <!-- Cash Change Overlay -->
                    <div id="cash-change-section" class="cash-overlay" style="display: none;">
                        <div class="cash-header">
                            <button class="btn-back-payment btn-icon-only"><i class='bx bx-arrow-back'></i></button>
                            <h4>Pagamento em Dinheiro</h4>
                        </div>

                        <div class="cash-box">
                            <label>Valor Recebido</label>
                            <div class="input-hero-wrapper">
                                <span class="currency-symbol">R$</span>
                                <input type="number" id="cash-received" step="0.01" class="input-hero-cash"
                                    placeholder="0,00">
                            </div>
                        </div>

                        <div class="change-info-box">
                            <span class="lbl">Troco</span>
                            <span class="val" id="cash-change-value">R$ 0,00</span>
                        </div>

                        <button class="btn-hero-confirm" id="confirm-cash-btn">
                            CONFIRMAR PAGAMENTO
                        </button>
                    </div>

                    <!-- Credit Card Overlay -->
                    <div id="credit-card-options" class="cash-overlay" style="display: none;">
                        <div class="cash-header">
                            <button class="btn-back-payment btn-icon-only"><i class='bx bx-arrow-back'></i></button>
                            <h4>Detalhes do Cartão</h4>
                        </div>

                        <div class="installments-box">
                            <label>Bandeira</label>
                            <select id="card-flag-select" class="modern-select">
                                <option value="Visa">Visa</option>
                                <option value="Mastercard">Mastercard</option>
                                <option value="Elo">Elo</option>
                                <option value="Hipercard">Hipercard</option>
                                <option value="Amex">Amex</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>

                        <div class="installments-box" style="margin-top: 15px;">
                            <label>Parcelamento</label>
                            <select id="card-installments-select" class="modern-select">
                                <option value="1">1x (Crédito à Vista)</option>
                                <option value="2">2x Sem Juros</option>
                                <option value="3">3x Sem Juros</option>
                                <option value="4">4x Sem Juros</option>
                                <option value="5">5x Sem Juros</option>
                                <option value="6">6x Sem Juros</option>
                                <option value="7">7x Sem Juros</option>
                                <option value="8">8x Sem Juros</option>
                                <option value="9">9x Com Juros</option>
                                <option value="10">10x Com Juros</option>
                                <option value="11">11x Com Juros</option>
                                <option value="12">12x Com Juros</option>
                            </select>
                        </div>

                        <button class="btn-hero-confirm" id="confirm-credit-card-btn">
                            CONFIRMAR CRÉDITO
                        </button>
                    </div>

                    <!-- Crediario Options Overlay -->
                    <div id="crediario-options" class="crediario-overlay" style="display: none;">
                        <div class="cash-header">
                            <button class="btn-back-payment btn-icon-only"><i class='bx bx-arrow-back'></i></button>
                            <h4>Confirmar Crediário</h4>
                        </div>

                        <div class="client-auth-card">
                            <div class="auth-avatar"><i class='bx bx-user'></i></div>
                            <div class="auth-info">
                                <strong id="lbl-cred-client-name">Cliente não selecionado</strong>
                                <button type="button" id="btn-change-cred-client">Trocar</button>
                            </div>
                        </div>

                        <div class="installments-box">
                            <label>Parcelamento</label>
                            <select id="sale-installments" class="modern-select">
                                <option value="1">1x (À vista na Fatura)</option>
                                <option value="2">2x Sem Juros</option>
                                <option value="3">3x Sem Juros</option>
                                <option value="4">4x Sem Juros</option>
                                <option value="5">5x Sem Juros</option>
                                <option value="6">6x Sem Juros</option>
                            </select>
                        </div>

                        <div class="preview-box" id="installment-preview">
                            1x de R$ 0,00
                        </div>

                        <button class="btn-hero-confirm" id="confirm-crediario-btn">
                            LANÇAR NA CONTA
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="receipt-modal">
        <div class="modal-content">
            <div class="modal-body centered">
                <div class="modal-icon success"><i class='bx bx-check font-40'></i></div>
                <h3 class="font-1-5rem mb-8">Venda Finalizada!</h3>
                <p>Venda no valor de <strong id="receipt-total">R$ 0,00</strong> registrada com sucesso.</p>
                <div class="modal-footer flex-col">
                    <button class="btn btn-primary" id="print-receipt-btn">
                        <i class='bx bx-printer'></i> Imprimir Recibo (Não Fiscal)
                    </button>
                    <button class="btn btn-secondary" id="new-sale-btn" data-primary-focus="true">
                        <i class='bx bx-rotate-left'></i> Nova Venda
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="order-details-modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Pedido <span id="modal-order-id" class="text-light">#0000</span></h3>
                <button class="close-modal-btn" data-target="order-details-modal"><i class='bx bx-x'></i></button>
            </div>

            <div class="modal-body">
                <div class="order-progress-track">
                    <div class="step-item" id="step-pendente" onclick="manualSetStatus('pendente')"
                        title="Voltar para Recebido">
                        <div class="step-icon"><i class='bx bx-list-ul'></i></div>
                        <span>Recebido</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" id="step-preparando" onclick="manualSetStatus('preparando')"
                        title="Mudar para Separando">
                        <div class="step-icon"><i class='bx bx-box'></i></div>
                        <span>Separando</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" id="step-enviado" onclick="manualSetStatus('enviado')"
                        title="Mudar para Enviado">
                        <div class="step-icon"><i class='bx bx-car'></i></div>
                        <span>Enviado</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" id="step-finalizado" onclick="manualSetStatus('finalizado')"
                        title="Mudar para Entregue">
                        <div class="step-icon"><i class='bx bx-check-double'></i></div>
                        <span>Entregue</span>
                    </div>
                </div>

                <div class="order-info-box">
                    <h4 class="font-sm mb-8 flex-align gap-8">
                        <i class='bx bx-user'></i> <span id="modal-order-client">Nome do Cliente</span>
                    </h4>
                    <p class="font-sm text-light mb-4">
                        <i class='bx bx-map'></i> <span id="modal-order-address">Endereço...</span>
                    </p>
                    <div class="flex-justify mt-8">
                        <span class="badge-bg" id="modal-payment-method">Pagamento: --</span>
                    </div>
                </div>

                <div class="flex-justify-center mb-10">
                    <h4 class="font-md margin-0">Conferência de Estoque</h4>
                    <small class="text-light">Marque os itens disponíveis</small>
                </div>

                <div id="modal-order-items-list" class="order-items-scroll"></div>

                <div class="financial-breakdown">
                    <div class="financial-row">
                        <span>Subtotal</span>
                        <span id="modal-calc-subtotal">R$ 0,00</span>
                    </div>
                    <div class="financial-row danger" id="row-canceled-items" style="display: none;">
                        <span>Itens Cancelados/Sem Estoque</span>
                        <span id="modal-calc-canceled">- R$ 0,00</span>
                    </div>
                    <div class="financial-row final">
                        <span>Total Final</span>
                        <span id="modal-calc-total" class="text-red">R$ 0,00</span>
                    </div>
                </div>
            </div>

            <div class="modal-footer flex-col gap-10">
                <button id="btn-update-status" class="btn btn-primary">Avançar Status</button>
                <button class="btn btn-close-modal-lg close-modal-btn" data-target="order-details-modal">Fechar
                    Janela</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-body centered">
                <div class="modal-icon danger"><i class='bx bx-error-alt font-40'></i></div>
                <h3 class="font-1-5rem mb-8" id="confirm-title">Tem certeza?</h3>
                <p id="confirm-message">Esta ação não pode ser desfeita.</p>
                <div class="modal-footer justify-center">
                    <button class="btn btn-secondary close-modal-btn" data-target="confirm-modal">Cancelar</button>
                    <button class="btn btn-danger" id="confirm-action-btn" data-primary-focus="true">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="alert-modal">
        <div class="modal-content">
            <div class="modal-body centered">
                <div class="modal-icon info"><i class='bx bx-info-circle font-40'></i></div>
                <h3 class="font-1-5rem mb-8" id="alert-title">Atenção</h3>
                <p id="alert-message">Ocorreu um erro.</p>
                <div class="modal-footer justify-center">
                    <button class="btn btn-primary close-modal-btn" data-target="alert-modal"
                        data-primary-focus="true">Entendi</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="add-cliente-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Cadastrar Novo Cliente</h3>
                <button class="close-modal-btn" data-target="add-cliente-modal"><i class='bx bx-x'></i></button>
            </div>
            <form id="add-cliente-form">
                <div class="modal-body">
                    <h4
                        style="font-size: 0.9rem; color: var(--primary-red); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 16px; font-weight: 700;">
                        <i class='bx bx-id-card'></i> Dados Pessoais
                    </h4>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Apelido / Como prefere ser chamado *</label>
                            <input type="text" id="cliente-apelido" required data-primary-focus="true"
                                placeholder="Ex: João da Padaria">
                        </div>
                        <div class="form-group">
                            <label>Nome Completo (Civil)</label>
                            <input type="text" id="cliente-nome" placeholder="Nome completo para contrato">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>WhatsApp / Telefone</label>
                            <input type="tel" id="cliente-telefone" placeholder="(XX) 9XXXX-XXXX">
                        </div>
                        <div class="form-group">
                            <label>CPF (Apenas números)</label>
                            <input type="text" id="cliente-cpf" placeholder="000.000.000-00">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Endereço Completo</label>
                        <textarea id="cliente-endereco" rows="2" placeholder="Rua, Número, Bairro e Referência..."
                            style="resize: none;"></textarea>
                    </div>

                    <hr class="separator my-16">

                    <h4
                        style="font-size: 0.9rem; color: var(--primary-red); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 16px; font-weight: 700;">
                        <i class='bx bx-wallet'></i> Configuração de Crédito
                    </h4>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Dia de Vencimento</label>
                            <select id="cliente-dia-vencimento" required
                                style="background-color: #fff1f2; border-color: #fda4af; color: #881337; font-weight: 600;">
                                <option value="5">Dia 05</option>
                                <option value="10" selected>Dia 10 (Padrão)</option>
                                <option value="15">Dia 15</option>
                                <option value="20">Dia 20</option>
                                <option value="25">Dia 25</option>
                                <option value="30">Dia 30</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Limite de Crédito (R$)</label>
                            <input type="number" id="cliente-limite" placeholder="0.00" step="50.00">
                        </div>
                    </div>

                    <input type="hidden" id="compra-valor" value="">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn" data-target="add-cliente-modal"
                        style="width: auto; padding: 0 24px;">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="cliente-save-btn"
                        style="width: auto; padding: 0 32px;">
                        <i class='bx bx-check'></i> Salvar Cadastro
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="close-caixa-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Fechamento de Caixa</h3>
                <button class="close-modal-btn" data-target="close-caixa-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">

                <div class="step-progress-container">
                    <div class="step-progress-fill" id="close-caixa-progress" style="width: 25%;"></div>
                </div>

                <form id="close-caixa-form" class="multi-step-form">

                    <div id="close-caixa-step-1" class="form-step active">
                        <div class="text-center mb-16">
                            <div class="modal-icon info"
                                style="width: 60px; height: 60px; font-size: 1.5rem; margin-bottom: 10px;"><i
                                    class='bx bx-money'></i></div>
                            <h4>Contagem de Espécie</h4>
                            <p class="text-sm">Conte o dinheiro físico na gaveta.</p>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Total em Notas (R$)</label>
                                <input type="number" id="close-caixa-notas" step="0.01" min="0" placeholder="0,00"
                                    required data-primary-focus="true" style="font-size: 1.2rem; font-weight: 700;">
                            </div>
                            <div class="form-group">
                                <label>Total em Moedas (R$)</label>
                                <input type="number" id="close-caixa-moedas" step="0.01" min="0" placeholder="0,00"
                                    required style="font-size: 1.2rem; font-weight: 700;">
                            </div>
                        </div>
                    </div>

                    <div id="close-caixa-step-2" class="form-step">
                        <div class="text-center mb-16">
                            <div class="modal-icon info"
                                style="width: 60px; height: 60px; font-size: 1.5rem; margin-bottom: 10px;"><i
                                    class='bx bx-credit-card'></i></div>
                            <h4>Conferência Digital</h4>
                            <p class="text-sm">Consulte o relatório da maquininha.</p>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Vendas no Cartão (R$)</label>
                                <input type="number" id="close-caixa-cartao" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                            <div class="form-group">
                                <label>Pix QR Code (Se houver)</label>
                                <input type="number" id="close-caixa-pix" step="0.01" min="0" placeholder="0,00">
                            </div>
                        </div>
                    </div>

                    <div id="close-caixa-step-3" class="form-step">
                        <div class="text-center mb-16">
                            <div class="modal-icon info"
                                style="width: 60px; height: 60px; font-size: 1.5rem; margin-bottom: 10px;"><i
                                    class='bx bx-safe'></i></div>
                            <h4>Destino do Dinheiro</h4>
                            <p class="text-sm">Onde o dinheiro contado será guardado?</p>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Vai para Sangria/Depósito</label>
                                <input type="number" id="close-caixa-deposito" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                            <div class="form-group">
                                <label>Fica no Caixa (Troco)</label>
                                <input type="number" id="close-caixa-fica" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                        </div>
                    </div>

                    <div id="close-caixa-step-4" class="form-step">
                        <div class="text-center mb-16">
                            <div class="modal-icon danger"
                                style="width: 60px; height: 60px; font-size: 1.5rem; margin-bottom: 10px;"><i
                                    class='bx bx-lock-alt'></i></div>
                            <h4>Finalizar e Bloquear</h4>
                            <p class="text-sm">Assine para confirmar o fechamento.</p>
                        </div>
                        <div class="form-group">
                            <label>Responsável pelo Fechamento</label>
                            <input type="text" id="close-caixa-assinatura" required placeholder="Digite seu nome..."
                                style="text-align: center;">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer modal-footer-multi-step">
                <button class="btn btn-secondary" id="close-caixa-prev-btn" style="display: none; width: auto;">
                    <i class='bx bx-chevron-left'></i> Voltar
                </button>
                <button class="btn btn-primary" id="close-caixa-next-btn" style="width: auto;">
                    Próximo <i class='bx bx-chevron-right'></i>
                </button>
                <button type="submit" form="close-caixa-form" class="btn btn-danger" id="close-caixa-save-btn"
                    style="display: none; width: auto;">
                    <i class='bx bx-lock-alt'></i> Encerrar Dia
                </button>
            </div>
        </div>
    </div>

    <div id="print-area" class="print-only">
        <div class="invoice-container">

            <header class="invoice-header">
                <div class="brand-section">
                    <img src="assets/logo.png" id="print-logo-img" alt="Logo">

                    <div class="brand-text">
                        <h1 id="print-store-name">DTUDO VARIEDADES E UTILIDADES</h1>
                        <p class="brand-subtitle">CNPJ: 45.692.327/0001-00</p>
                    </div>
                </div>

                <div class="invoice-meta">
                    <h2 class="doc-title">COMPROVANTE DE VENDA</h2>
                    <div class="meta-grid">
                        <div class="meta-item">
                            <i class='bx bx-hash'></i>
                            <div>
                                <span class="label">NÚMERO</span>
                                <span class="value" id="print-sale-id">0000</span>
                            </div>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-calendar'></i>
                            <div>
                                <span class="label">DATA</span>
                                <span class="value" id="print-sale-date">--/--/--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <hr class="divider-thick">

            <section class="client-section">
                <div class="section-title">
                    <i class='bx bx-user-circle'></i> DADOS DO CLIENTE
                </div>
                <div class="client-card">
                    <div class="client-row main">
                        <span id="print-client-name">CONSUMIDOR FINAL</span>
                    </div>
                    <div class="client-row details">
                        <span><i class='bx bx-id-card'></i> <span id="print-client-doc">---</span></span>
                        <span><i class='bx bx-map'></i> <span id="print-client-address">Endereço não
                                informado</span></span>
                    </div>
                </div>
            </section>

            <section class="items-section">
                <table class="premium-table">
                    <thead>
                        <tr>
                            <th width="10%">COD</th>
                            <th width="50%">DESCRIÇÃO</th>
                            <th width="10%" class="text-center">QTD</th>
                            <th width="15%" class="text-right">UNIT</th>
                            <th width="15%" class="text-right">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody id="print-items-body">
                    </tbody>
                </table>
            </section>

            <section class="totals-section">
                <div class="payment-info">
                    <div class="section-title small">
                        <i class='bx bx-credit-card'></i> PAGAMENTO
                    </div>
                    <p id="print-obs-text" class="payment-method-text">---</p>

                    <div id="print-installments-area" style="display: none; margin-top: 10px;">
                        <div class="installments-strip" id="print-installments-list"></div>
                    </div>
                </div>

                <div class="totals-box">
                    <div class="t-row">
                        <span>Subtotal</span>
                        <span id="print-subtotal">R$ 0,00</span>
                    </div>
                    <div class="t-row">
                        <span>Descontos</span>
                        <span id="print-discount">R$ 0,00</span>
                    </div>
                    <div class="t-row grand-total">
                        <span>TOTAL A PAGAR</span>
                        <span id="print-total">R$ 0,00</span>
                    </div>
                </div>
            </section>

            <footer class="invoice-footer">
                <div class="legal-text">
                    <p><strong>TERMO DE CONFISSÃO DE DÍVIDA:</strong> Reconheço(emos) a exatidão desta dívida e a
                        obrigação de pagá-la. O não pagamento acarretará nas medidas legais cabíveis. Mercadoria
                        recebida em perfeito estado.</p>
                </div>

                <div class="signature-area">
                    <div class="line"></div>
                    <div class="sig-name" id="print-signature-name">CLIENTE</div>
                </div>

                <div class="system-tag">
                    ELETRO • Impresso em <span id="print-timestamp"></span>
                </div>
            </footer>
        </div>
    </div>
    <div class="system-brand-fixed">
        <span class="powered-label">Powered by</span>
        <div class="brand-row">
            <img src="assets/sistema.png" alt="Logo" class="brand-img-icon">

            <span class="brand-name-text">ELETRO<span class="highlight-dot">. 1.0.0.43.45</span></span>
        </div>
    </div>
    <div class="pn">
        <div class="status-container">
            <div class="status-dot"></div>
            <span class="status-text" id="network-status-text">ONLINE</span>
        </div>
    </div>

    <!-- Modal Alterar Vencimento Manual -->
    <div class="modal-overlay" id="modal-alterar-vencimento">
        <div class="modal-content" style="max-width: 350px;">
            <div class="modal-header">
                <h3>Alterar Vencimento</h3>
                <button class="close-modal-btn" data-target="modal-alterar-vencimento"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                    Defina uma data fixa para o vencimento total da dívida atual. Isso ignorará cálculos automáticos
                    anteriores.
                </p>
                <div class="form-group">
                    <label>Nova Data</label>
                    <input type="date" id="input-novo-vencimento" class="form-input" style="border: 2px solid #db0038;">
                </div>
                <button id="btn-confirmar-vencimento" class="primary-btn"
                    style="width: 100%; margin-top: 15px; background-color: #db0038;">
                    Confirmar Alteração
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <!-- MINI RADIO PLAYER COMPONENT -->
    <style>
        #mini-radio-player {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 340px;
            height: 80px;
            background: #18181b;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            padding: 12px;
            gap: 12px;
            z-index: 9999;
            color: white;
            font-family: 'Inter', sans-serif;
            transform: translateY(150%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid #333;
        }

        #mini-radio-player.visible {
            transform: translateY(0);
        }

        .mini-cover {
            width: 56px;
            height: 56px;
            border-radius: 6px;
            background: #333;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
        }

        .mini-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .mini-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .mini-title {
            font-size: 0.9rem;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px;
            color: #fff;
        }

        .mini-artist {
            font-size: 0.75rem;
            color: #a1a1aa;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mini-controls {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .mini-btn {
            background: transparent;
            border: none;
            color: #a1a1aa;
            cursor: pointer;
            padding: 6px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1.1rem;
        }

        .mini-btn:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }

        .mini-btn.active-like {
            color: #ef4444;
        }

        .mini-btn.active-dislike {
            color: #ef4444;
        }

        .mini-play-btn {
            background: #fff;
            color: #000;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin: 0 4px;
            cursor: pointer;
            border: none;
        }

        .mini-play-btn:hover {
            transform: scale(1.05);
            background: #f1f5f9;
        }

        .mini-wave-icon {
            position: absolute;
            bottom: 4px;
            right: 4px;
            display: flex;
            gap: 2px;
            align-items: flex-end;
            height: 12px;
        }

        .mini-wave-bar {
            width: 3px;
            background: #10b981;
            animation: mini-wave 1s infinite ease-in-out;
            border-radius: 1px;
        }

        .mini-wave-bar:nth-child(1) {
            height: 6px;
            animation-delay: 0s;
        }

        .mini-wave-bar:nth-child(2) {
            height: 12px;
            animation-delay: 0.1s;
        }

        .mini-wave-bar:nth-child(3) {
            height: 8px;
            animation-delay: 0.2s;
        }

        @keyframes mini-wave {

            0%,
            100% {
                height: 4px;
            }

            50% {
                height: 100%;
            }
        }
    </style>

    <div id="mini-radio-player">
        <div class="mini-cover">
            <img id="mini-cover-img" src="" alt="Capa">
            <div class="mini-wave-icon" id="mini-wave" style="display: none;">
                <div class="mini-wave-bar"></div>
                <div class="mini-wave-bar"></div>
                <div class="mini-wave-bar"></div>
            </div>
        </div>
        <div class="mini-info">
            <div class="mini-title" id="mini-title">Conectando...</div>
            <div class="mini-artist" id="mini-artist">Rádio Eletro</div>
        </div>
        <div class="mini-controls">
            <button class="mini-btn" id="mini-like-btn" title="Curtir"><i class='bx bx-heart'></i></button>
            <button class="mini-btn" id="mini-prev-btn"><i class='bx bx-skip-previous'></i></button>
            <button class="mini-play-btn" id="mini-play-btn"><i class='bx bx-play'></i></button>
            <button class="mini-btn" id="mini-next-btn"><i class='bx bx-skip-next'></i></button>
            <button class="mini-btn" id="mini-dislike-btn" title="Não gostei"><i class='bx bx-dislike'></i></button>
        </div>
    </div>

    <script>
        (function () {
            const miniPlayer = document.getElementById('mini-radio-player');
            const channel = new BroadcastChannel('radio_channel');

            const ui = {
                cover: document.getElementById('mini-cover-img'),
                title: document.getElementById('mini-title'),
                artist: document.getElementById('mini-artist'),
                playBtn: document.getElementById('mini-play-btn'),
                likeBtn: document.getElementById('mini-like-btn'),
                dislikeBtn: document.getElementById('mini-dislike-btn'),
                wave: document.getElementById('mini-wave')
            };

            let currentTrackId = null;

            // Tenta obter estado inicial
            channel.postMessage({ action: 'GET_STATE' });

            channel.onmessage = (event) => {
                if (event.data.type === 'UPDATE_STATE') {
                    const state = event.data.payload;

                    miniPlayer.classList.add('visible');

                    if (currentTrackId !== state.id) {
                        // Reset like states on track change
                        ui.likeBtn.classList.remove('active-like');
                        ui.likeBtn.querySelector('i').className = 'bx bx-heart';
                        ui.dislikeBtn.classList.remove('active-dislike');
                        ui.dislikeBtn.querySelector('i').className = 'bx bx-dislike';
                        currentTrackId = state.id;
                    }

                    ui.title.innerText = state.title;
                    ui.artist.innerText = state.artist;
                    ui.cover.src = `https://img.youtube.com/vi/${state.id}/default.jpg`;

                    if (state.isPlaying) {
                        ui.playBtn.innerHTML = "<i class='bx bx-pause'></i>";
                        ui.wave.style.display = 'flex';
                    } else {
                        ui.playBtn.innerHTML = "<i class='bx bx-play'></i>";
                        ui.wave.style.display = 'none';
                    }
                }
            };

            ui.playBtn.onclick = () => channel.postMessage({ action: 'TOGGLE_PLAY' });
            document.getElementById('mini-next-btn').onclick = () => channel.postMessage({ action: 'NEXT' });
            document.getElementById('mini-prev-btn').onclick = () => channel.postMessage({ action: 'PREV' });

            ui.likeBtn.onclick = () => {
                channel.postMessage({ action: 'LIKE' });
                // Feedback visual local imediato
                ui.likeBtn.classList.add('active-like');
                ui.likeBtn.querySelector('i').className = 'bx bxs-heart';
                // Remove dislike
                ui.dislikeBtn.classList.remove('active-dislike');
                ui.dislikeBtn.querySelector('i').className = 'bx bx-dislike';
            };

            ui.dislikeBtn.onclick = () => {
                channel.postMessage({ action: 'DESLIKE' });
                // Feedback visual local imediato
                ui.dislikeBtn.classList.add('active-dislike');
                ui.dislikeBtn.querySelector('i').className = 'bx bxs-dislike';
                // Remove like
                ui.likeBtn.classList.remove('active-like');
                ui.likeBtn.querySelector('i').className = 'bx bx-heart';
            };
        })();
    </script>
</body>

</html>