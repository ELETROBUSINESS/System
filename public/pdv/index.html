<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/assets/img/iconWeb.png">
    <title>Ponto de Venda | ELETRO</title>

    <link rel="stylesheet" href="style.css">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-solid-straight/css/uicons-solid-straight.css'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BV6V3GTMR0"></script>

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-BV6V3GTMR0');
    </script>
</head>

<body>

    <div class="modal-overlay" id="print-selection-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Imprimir Comprovante</h3>
                <button class="close-modal-btn" data-target="print-selection-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p class="text-center mb-20 text-dark">Selecione o formato de impressão:</p>

                <div class="print-options-grid">
                    <div id="btn-print-thermal" class="print-option-card">
                        <i class='bx bx-receipt print-icon'></i>
                        <h4>Cupom (Térmica)</h4>
                        <p class="text-sm text-light">Formato pequeno (80mm)</p>
                    </div>

                    <div id="btn-print-a4" class="print-option-card">
                        <i class='bx bx-file-blank print-icon red'></i>
                        <h4>Nota Auxiliar (A4)</h4>
                        <p class="text-sm text-light">Folha inteira com detalhes</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="loading-overlay">
        <i class='bx bx-loader-alt bx-spin'></i>
        <p id="loading-message">Verificando status do caixa...</p>
    </div>

    <div class="modal-overlay" id="client-selection-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Selecionar Cliente</h3>
                <button class="close-modal-btn" data-target="client-selection-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="search-box-wrapper">
                    <div class="search-icon-input">
                        <i class='bx bx-search'></i>
                        <input type="text" id="client-selection-input" placeholder="Busque por nome ou apelido..."
                            autocomplete="off" data-primary-focus="true">
                    </div>
                    <button class="btn btn-primary btn-auto" id="btn-new-client-modal" title="Novo Cliente">
                        <i class='bx bx-plus'></i>
                    </button>
                </div>

                <div class="client-results-list" id="client-selection-results"></div>

                <p class="text-center text-light mt-20 text-sm" id="client-search-hint">
                    Digite para buscar...
                </p>
            </div>
        </div>
    </div>

    <div class="modal-overlay z-high" id="image-viewer-modal">
        <div class="modal-content modal-fullscreen">
            <div class="modal-header">
                <h3>Visualizar Comprovante</h3>
                <button class="close-modal-btn" data-target="image-viewer-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body viewer-body">
                <p id="viewer-loading" class="viewer-loading">
                    <i class='bx bx-loader-alt bx-spin'></i> Carregando imagem...
                </p>
                <iframe id="viewer-iframe" src="" class="viewer-iframe"></iframe>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="cliente-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ficha do Cliente</h3>
                <button class="close-modal-btn" data-target="cliente-details-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="client-profile-header"
                    style="position: relative; display: flex; align-items: center; gap: 10px;">
                    <div class="client-avatar"><i class='bx bx-user'></i></div>
                    <div style="flex-grow: 1;">
                        <h4 id="detail-cliente-nome">Carregando...</h4>
                        <p id="detail-cliente-apelido" class="text-light">...</p>
                    </div>
                    <button id="btn-admin-edit"
                        style="background: none; border: none; color: #666; font-size: 1.4rem; cursor: pointer; padding: 5px;"
                        title="Admin: Renegociar">
                        <i class='bx bxs-pencil'></i>
                    </button>
                </div>
                <div class="client-stats-grid">
                    <div class="stat-box">
                        <span class="stat-label">Saldo Devedor</span>
                        <span class="stat-value danger" id="detail-cliente-saldo">R$ 0,00</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-label">Próximo Venc.</span>
                        <span class="stat-value" id="detail-cliente-vencimento">--/--/----</span>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 0 5px;">
                    <button id="btn-gerar-acesso" class="action-btn"
                        style="background: #1f2937; color: white; width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer;">
                        <i class='bx bx-qr-scan'></i> Gerar Acesso do Cliente
                    </button>

                    <div id="qrcode-container"
                        style="display:none; margin-top: 15px; justify-content: center; background: white; padding: 10px; border-radius: 8px;">
                    </div>

                    <p id="link-acesso-text"
                        style="font-size: 12px; color: #007bff; word-break: break-all; display:none; margin-top:10px; text-align: center; cursor: pointer;">
                    </p>
                </div>

                <div class="limit-container">
                    <div class="limit-header">
                        <span>Limite: <strong id="detail-cliente-limite-total">R$ 0,00</strong></span>
                        <button class="btn-edit-limit" id="btn-alterar-limite" title="Alterar Limite"><i
                                class='bx bx-edit-alt'></i></button>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" id="detail-cliente-progress"></div>
                    </div>
                    <div class="limit-stats">
                        <span id="detail-cliente-disponivel">Disponível: R$ 0,00</span>
                        <span id="detail-cliente-percentual">0% usado</span>
                    </div>
                </div>

                <div class="history-section">
                    <h4><i class='bx bx-history'></i> Histórico Recente</h4>
                    <div class="history-list-container" id="detail-history-container">
                        <p class="text-center loading-text">Carregando...</p>
                    </div>
                </div>

                <div class="form-group mt-16">
                    <label>Contato</label>
                    <div class="info-box">
                        <p><i class='bx bx-phone'></i> <span id="detail-cliente-telefone">--</span></p>
                        <p><i class='bx bx-map'></i> <span id="detail-cliente-endereco">--</span></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-modal-btn" data-target="cliente-details-modal">Fechar</button>
            </div>
        </div>
    </div>

    <div id="modal-admin-auth" class="modal-overlay">
        <div class="modal-content" style="max-width: 300px; text-align: center; border-radius: 15px; padding: 25px;">
            <div class="modal-header" style="justify-content: center; border: none; padding: 0; margin-bottom: 15px;">
                <div
                    style="background: #fee2e2; color: #dc2626; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                    <i class='bx bxs-lock-alt'></i>
                </div>
            </div>
            <div class="modal-body" style="padding: 0;">
                <h3 style="margin: 0 0 10px 0; color: #1f2937;">Área Restrita</h3>
                <p style="font-size: 0.9rem; color: #6b7280; margin-bottom: 20px;">Digite a senha de administrador.</p>

                <input type="password" id="admin-password-input" class="form-input" placeholder="Senha..."
                    style="text-align: center; font-size: 1.1rem; margin-bottom: 5px;">
                <p id="auth-error-msg"
                    style="color: #dc2626; font-size: 0.8rem; display: none; margin-bottom: 15px; font-weight: 600;">
                    Senha incorreta!</p>

                <div style="display: flex; gap: 10px;">
                    <button id="btn-cancel-auth" class="secondary-btn"
                        style="flex: 1; justify-content: center;">Cancelar</button>
                    <button id="btn-confirm-auth" class="primary-btn"
                        style="flex: 1; background: #db0038; justify-content: center;">Entrar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-renegociar" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class='bx bx-calendar-edit'></i> Renegociar (Admin)</h3>
                <span class="close-modal" id="close-renegociar">&times;</span>
            </div>
            <div class="modal-body">
                <div
                    style="background: #fdf2f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #fbcfe8; text-align: center;">
                    <p style="font-size: 0.8rem; color: #db0038; font-weight: 600; text-transform: uppercase;">Saldo
                        Devedor Total</p>
                    <p style="font-size: 1.8rem; font-weight: 800; color: #be185d;" id="reneg-saldo-atual">R$ 0,00</p>
                </div>

                <div class="form-group">
                    <label>Vencimento Atual</label>
                    <input type="text" id="reneg-vencimento-atual" class="form-input" disabled
                        style="background: #e5e7eb; color: #555;">
                </div>

                <div class="form-group">
                    <label style="color: #db0038; font-weight: 700;">Parcelamento da Dívida</label>
                    <select id="reneg-parcelas" class="form-input" style="border: 2px solid #db0038;">
                        <option value="1">1x (Manter valor total)</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                        <option value="5">5x</option>
                        <option value="6">6x</option>
                    </select>
                </div>

                <div class="form-group">
                    <label style="color: #db0038; font-weight: 700;">Nova Data de Vencimento</label>
                    <input type="date" id="reneg-nova-data" class="form-input" style="border: 2px solid #db0038;">
                    <p style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                        Isso altera a data manualmente, tirando o cliente do atraso até o dia escolhido.
                    </p>
                </div>

                <button id="btn-confirmar-renegociacao" class="primary-btn"
                    style="width: 100%; margin-top: 15px; background: #db0038;">
                    CONFIRMAR ALTERAÇÃO
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="cliente-pay-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Receber de Cliente</h3>
                <button class="close-modal-btn" data-target="cliente-pay-modal"><i class='bx bx-x'></i></button>
            </div>
            <form id="cliente-pay-form">
                <div class="modal-body">
                    <p>Registrar pagamento para: <strong id="pay-cliente-nome">...</strong></p>
                    <p class="text-sm text-light mb-16">
                        Saldo Atual: <span id="pay-cliente-saldo-atual" class="text-danger font-bold">R$ 0,00</span>
                    </p>

                    <div class="form-group">
                        <label for="pay-valor">Valor do Pagamento (R$) *</label>
                        <input type="number" id="pay-valor" step="0.01" min="0.01" placeholder="0,00" required
                            data-primary-focus="true">
                    </div>

                    <div class="form-group">
                        <label for="pay-metodo">Forma de Pagamento *</label>
                        <select id="pay-metodo" required>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="PIX">PIX</option>
                            <option value="Cartão">Cartão</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn"
                        data-target="cliente-pay-modal">Cancelar</button>
                    <button type="submit" class="btn btn-success">
                        <i class='bx bx-dollar-circle'></i> Confirmar Pagamento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="main-content" id="main-content">

        <div class="app-header">
            <h1>Ponto de Venda</h1>
            <button class="btn btn-danger" id="header-close-caixa-btn" style="display: none;">
                <i class='bx bx-stop-circle'></i> Fechar Caixa (F8)
            </button>
        </div>

        <nav class="navbar" id="main-navbar">
            <span class="navbar-item active" data-page="pdv">PDV</span>
            <span class="navbar-item" data-page="pedidos">
                Pedidos
                <span class="nav-badge" id="pedidos-badge">0</span>
            </span>
            <span class="navbar-item" data-page="produtos">Produtos</span>
            <span class="navbar-item" data-page="clientes">Clientes</span>
            <span class="navbar-item" data-page="historico">Histórico</span>
            <span class="navbar-item" data-page="configuracoes">Configurações</span>
            <div class="navbar-highlight" id="navbar-highlight"></div>
        </nav>

        <div id="pdv-page" class="page-content">
            <div class="pdv-layout">
                <div class="pdv-main">
                    <div class="tooltip">
                        <div class="barcode-scanner">
                            <i class='bx bx-barcode-reader'></i>
                            <input type="text" id="barcode-input" placeholder="Carregando produtos..." disabled>
                        </div>
                        <span class="tooltip-text">Digite o código ou nome para adicionar</span>
                    </div>
                    <p class="shortcut-hint" id="barcode-hint">Carregando produtos...</p>

                    <div class="item-list-container" id="item-list-container">
                        <div class="empty-state" id="empty-state">
                            <span>Nenhum item na venda</span>
                        </div>
                        <table class="item-list-table" id="item-list-table" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Qtd.</th>
                                    <th>Preço Unit.</th>
                                    <th class="text-center">Oferta %</th>
                                    <th>Total</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="cart-items-body"></tbody>
                        </table>
                    </div>
                </div>

                <aside class="pdv-summary">
                    <div class="card">
                        <div class="summary-client-card" id="summary-client-card">
                            <div class="summary-client-header">
                                <span class="summary-client-name">
                                    <i class='bx bx-user'></i> <span id="summary-client-name-text">Nome do
                                        Cliente</span>
                                </span>
                                <button class="btn-change-client" id="btn-change-summary-client">Alterar</button>
                            </div>
                            <div class="summary-limit-bar">
                                <div class="summary-limit-fill" id="summary-limit-fill"></div>
                            </div>
                            <div class="summary-limit-text">
                                <span id="summary-limit-label">Limite Disp.</span>
                                <span id="summary-limit-value">R$ 0,00</span>
                            </div>
                        </div>

                        <h2>Resumo da Venda</h2>

                        <div class="summary-row">
                            <span class="label">Subtotal (<span id="item-count">0</span> itens)</span>
                            <span class="value" id="summary-subtotal">R$ 0,00</span>
                        </div>

                        <div class="summary-row summary-row-interactive" id="discount-toggle-row"
                            title="Adicionar desconto">
                            <span class="label"> <i class='bx bx-purchase-tag'></i> Descontos (F3) </span>
                            <span class="value editable" id="summary-discount">- R$ 0,00</span>
                        </div>

                        <div class="discount-popover" id="discount-popover">
                            <div class="form-group">
                                <label for="discount-input-r">Valor do Desconto (R$)</label>
                                <input type="number" id="discount-input-r" placeholder="0,00" step="0.01">
                            </div>
                            <span class="discount-popover-label">Desconto Rápido (%)</span>
                            <div class="discount-perc-buttons" id="perc-btn-container">
                                <button class="perc-btn" data-perc="1">1%</button>
                                <button class="perc-btn" data-perc="3">3%</button>
                                <button class="perc-btn" data-perc="5">5%</button>
                                <button class="perc-btn" data-perc="8">8%</button>
                            </div>
                            <div class="effective-discount-display" id="effective-discount-display">
                                <i class='bx bx-badge-percent'></i><span id="discount-percentage-text"></span>
                            </div>
                            <button class="btn-remove-discount" id="remove-discount-btn">
                                <i class='bx bx-x'></i> Remover Desconto
                            </button>
                            <span class="discount-nav-hint" id="remove-discount-hint">Pressione 'Enter' para
                                remover</span>
                        </div>

                        <div class="summary-row summary-row-interactive" id="payment-toggle-row"
                            title="Selecionar forma de pagamento">
                            <span class="label"> <i class='bx bx-credit-card'></i> Pagamento (F4) </span>
                            <span class="value editable" id="summary-payment-method">Não selecionado</span>
                        </div>

                        <div class="summary-row summary-row-interactive" id="seller-toggle-row"
                            title="Selecionar Vendedor">
                            <span class="label"> <i class='bx bx-id-card'></i> Vendedor </span>
                            <span class="value editable" id="summary-seller-name">Não informado</span>
                        </div>

                        <div class="discount-popover" id="seller-popover">
                            <span class="discount-popover-label">Quem está vendendo?</span>
                            <div class="seller-grid grid-3-cols mt-10">
                                <button class="perc-btn seller-btn" data-name="Nubia">Nubia</button>
                                <button class="perc-btn seller-btn" data-name="Evelyn">Evelyn</button>
                                <button class="perc-btn seller-btn" data-name="Ryan">Ryan</button>
                            </div>
                        </div>

                        <div class="summary-total">
                            <div class="summary-row">
                                <span class="label">Total</span>
                                <span class="value" id="summary-total">R$ 0,00</span>
                            </div>
                        </div>

                        <div class="tooltip">
                            <button class="btn btn-primary" id="finish-sale-btn">
                                <i class='bx bx-check-circle'></i> Finalizar Venda (F9)
                            </button>
                            <span class="tooltip-text">Registra a venda e abre opções de recibo</span>
                        </div>
                        <div class="tooltip">
                            <button class="btn btn-secondary" id="cancel-sale-btn">
                                <i class='bx bx-x-circle'></i> Cancelar Venda (F10)
                            </button>
                            <span class="tooltip-text">Limpa todos os itens da venda atual</span>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <div id="pedidos-page" class="page-content" style="display: none;">
            <div class="card card-lg card-transparent">
                <div class="page-header header-styled">
                    <div>
                        <h2><i class='bx bx-shopping-bag'></i> Pedidos Online</h2>
                        <p class="text-light no-margin">Gerencie as vendas em tempo real.</p>
                    </div>
                    <div>
                        <button class="btn btn-secondary btn-auto">
                            <i class='bx bx-refresh'></i> Atualizar
                        </button>
                    </div>
                </div>

                <div class="orders-tabs" id="order-status-tabs">
                    <div class="order-tab active" data-status="pendente">
                        Pendentes <span class="badge warning" id="count-pendente">0</span>
                    </div>
                    <div class="order-tab" data-status="preparando">
                        Preparando <span class="badge neutral" id="count-preparando">0</span>
                    </div>
                    <div class="order-tab" data-status="enviado">
                        Enviados
                    </div>
                    <div class="order-tab" data-status="finalizado">
                        Finalizados
                    </div>
                </div>

                <div id="orders-grid-container" class="orders-grid">
                    <p class="grid-full text-center text-light pad-40">
                        <i class='bx bx-loader-alt bx-spin font-2rem'></i><br>Carregando...
                    </p>
                </div>
            </div>
        </div>

        <div id="produtos-page" class="page-content" style="display: none;">
            <div class="card container-md mb-24">
                <div class="page-header">
                    <h2><i class='bx bx-discount'></i> Black Friday Produtos</h2>
                    <button class="btn btn-secondary btn-auto" id="btn-load-firebase">
                        <i class='bx bx-cloud-download'></i> Carregar Produtos
                    </button>
                </div>
                <p class="text-light mt-neg-16 mb-24">
                    Sincronize os códigos de barras da loja online com o sistema local.
                </p>

                <div class="firebase-list-header">
                    <span>Produto</span>
                    <span>Preço</span>
                    <span class="text-center">Estoque</span>
                    <span>Código de Barras</span>
                    <span class="text-center">Salvar</span>
                </div>

                <div id="firebase-products-list" class="firebase-products-container">
                    <div class="empty-placeholder">
                        <i class='bx bx-cloud'></i>
                        <span>Clique em "Carregar Produtos" para iniciar.</span>
                    </div>
                </div>
            </div>

            <div class="card container-md">
                <div class="page-header">
                    <h2>Produtos Cadastrados</h2>
                </div>
                <p class="text-light mt-neg-16 mb-16">
                    Novos produtos adicionados pelo "Cadastro Rápido" do PDV aparecerão aqui.
                </p>
                <div id="produtos-table-container"></div>
            </div>
        </div>

        <div id="clientes-page" class="page-content" style="display: none;">
            <div class="card">
                <div class="page-header">
                    <div>
                        <h2>Crediário Digital</h2>
                        <p class="text-light mt-4 mb-0 text-sm">Gerencie pagamentos e inadimplência.</p>
                    </div>
                    <button class="btn btn-primary btn-auto" id="add-cliente-btn">
                        <i class='bx bx-user-plus'></i> Novo Cliente
                    </button>
                </div>

                <div class="search-box-wrapper mb-20">
                    <div class="client-search-container">
                        <i class='bx bx-search client-search-icon'></i>
                        <input type="text" id="clientes-page-search" class="client-search-input"
                            placeholder="Buscar cliente por nome ou apelido..." autocomplete="off">
                    </div>
                </div>
                <div id="clientes-list-container">
                </div>
            </div>
        </div>

        <div id="caixa-page" class="page-content" style="display: none;"></div>

        <div id="historico-page" class="page-content" style="display: none;">
            <div class="card">
                <div class="page-header">
                    <h2>Histórico de Vendas (Dia)</h2>
                    <button class="btn btn-secondary btn-auto" id="btn-refresh-history">
                        <i class='bx bx-refresh'></i> Atualizar
                    </button>
                </div>

                <div id="sales-history-list" class="flex-col gap-12">
                    <p class="text-center text-muted pad-20">Carregando...</p>
                </div>
            </div>
        </div>

        <div id="configuracoes-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header">
                    <h2>Configurações</h2>
                </div>
                <div class="setting-row">
                    <div class="setting-info">
                        <h3>Arredondamento Inteligente de Troco</h3>
                        <p>Quando ativado, os descontos por porcentagem arredondam o valor total da compra para o R$
                            0,50 mais próximo.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="smart-rounding-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <div class="setting-info">
                        <h3>Cache de Produtos</h3>
                        <p>Recarrega a lista de produtos do banco de dados.</p>
                    </div>
                    <button class="btn btn-secondary btn-auto" id="reload-cache-btn">
                        <i class='bx bx-sync'></i> Recarregar
                    </button>
                </div>
            </div>
        </div>

    </div>
    <div class="modal-overlay" id="quick-add-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Produto não encontrado</h3>
                <button class="close-modal-btn" data-target="quick-add-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p>O código <strong id="scanned-barcode"></strong> não está cadastrado. Adicione um item rápido.</p>
                <form id="quick-add-form">
                    <div class="form-group">
                        <label for="quick-product-name">Nome do Produto</label>
                        <input type="text" id="quick-product-name" required data-primary-focus="true">
                    </div>
                    <div class="form-group">
                        <label for="quick-product-price">Preço (R$)</label>
                        <input type="number" id="quick-product-price" step="0.01" min="0.01" placeholder="0,00"
                            required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-modal-btn" data-target="quick-add-modal">Cancelar</button>
                <button class="btn btn-primary" id="quick-add-submit-btn">Adicionar à Venda</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="crediario-flow-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Finalizar Crediário</h3>
                <button class="close-modal-btn" data-target="crediario-flow-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div id="cred-step-1" class="qr-step-container">
                    <div class="modal-icon info"><i class='bx bx-printer font-40'></i></div>
                    <p class="step-instruction">Imprima o comprovante para assinatura do cliente.</p>
                    <p class="step-subtext">Cliente: <strong id="cred-flow-client-name">...</strong></p>
                    <button class="btn btn-primary" id="btn-force-print">
                        <i class='bx bx-printer'></i> Imprimir Comprovante
                    </button>
                </div>

                <div id="cred-step-2" class="qr-step-container locked-step hidden-transition" style="display:none;">
                    <p class="step-instruction">Anexar Comprovante Assinado</p>
                    <p class="step-subtext mb-10">Escaneie para enviar a foto:</p>

                    <div class="qr-img-wrapper">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://eletrobusiness.com.br/comprovante/buy/valid55102.html"
                            alt="QR Code Comprovante">
                    </div>
                    <p class="text-xs text-light">Link: eletrobusiness.com.br/comprovante...</p>

                    <div class="mt-24">
                        <button class="btn btn-success" id="btn-finish-crediario-final">
                            <i class='bx bx-check-double'></i> Concluir Conta e Salvar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="payment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Forma de Pagamento</h3>
                <button class="close-modal-btn" data-target="payment-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p>Valor total: <strong id="payment-total">R$ 0,00</strong>. Como o cliente irá pagar?</p>

                <div class="payment-options" id="single-payment-options">
                    <div class="payment-option" data-method="Dinheiro">
                        <i class='bx bx-dollar-circle font-32'></i> <span>Dinheiro (F6)</span>
                    </div>
                    <div class="payment-option" data-method="PIX">
                        <i class='bx bx-scan font-32'></i> <span>PIX (F7)</span>
                    </div>
                    <div class="payment-option" data-method="Cartão">
                        <i class='bx bx-credit-card font-32'></i> <span>Cartão (F8)</span>
                    </div>
                    <div class="payment-option" data-method="Crediário" id="opt-crediario">
                        <i class='bx bx-user-check font-32'></i> <span>Crediário</span>
                    </div>
                </div>

                <div id="crediario-limit-feedback" style="display: none;">
                    <div class="mini-limit-bar">
                        <div class="mini-limit-fill" id="crediario-limit-fill"></div>
                    </div>
                    <div class="mini-limit-info">
                        <span id="crediario-limit-text">Limite disponível: R$ 0,00</span>
                        <span id="crediario-status-text"></span>
                    </div>
                </div>

                <button class="btn btn-secondary mt-20" id="split-payment-toggle-btn">
                    <i class='bx bx-columns'></i> Dividir Pagamento
                </button>

                <div class="split-payment-area" id="split-payment-area" style="display: none;">
                    <h4>Dividir Pagamento</h4>
                    <div class="split-payment-row">
                        <div class="form-group">
                            <label for="split-method-1">Forma 1</label>
                            <select id="split-method-1">
                                <option value="Dinheiro">Dinheiro</option>
                                <option value="PIX">PIX</option>
                                <option value="Cartão">Cartão</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="split-value-1">Valor 1 (R$)</label>
                            <input type="number" id="split-value-1" step="0.01">
                        </div>
                    </div>
                    <div class="split-payment-row">
                        <div class="form-group">
                            <label for="split-method-2">Forma 2</label>
                            <select id="split-method-2">
                                <option value="Dinheiro">Dinheiro</option>
                                <option value="PIX">PIX</option>
                                <option value="Cartão">Cartão</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="split-value-2">Valor 2 (R$)</label>
                            <input type="number" id="split-value-2" step="0.01">
                        </div>
                    </div>
                    <div class="split-payment-remaining" id="split-payment-remaining">Restante: R$ 0,00</div>
                    <button class="btn btn-primary mt-16" id="confirm-split-payment-btn" disabled>Confirmar
                        Divisão</button>
                </div>

                <div id="crediario-options" style="display: none; animation: slideInUp 0.3s ease;">

                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; border-bottom: 1px dashed #eee; padding-bottom: 10px;">
                        <button type="button" id="back-to-payment-methods"
                            style="background:none; border:none; cursor:pointer; font-size: 0.9rem; color: var(--text-light); display: flex; align-items: center; gap: 5px;">
                            <i class='bx bx-arrow-back'></i> Voltar
                        </button>
                        <h4 style="margin:0;">Crediário</h4>
                    </div>

                    <div
                        style="background-color: var(--bg-light); padding: 10px; border-radius: 8px; margin-bottom: 16px; display: flex; align-items: center; gap: 10px;">
                        <div
                            style="width: 32px; height: 32px; background: #ddd; border-radius: 50%; display: grid; place-items: center;">
                            <i class='bx bx-user'></i>
                        </div>
                        <div>
                            <p style="margin:0; font-weight: 600; font-size: 0.9rem;" id="lbl-cred-client-name">
                                Selecione um cliente</p>
                            <small style="color: var(--text-light);">Cliente vinculado</small>
                        </div>
                        <button type="button" id="btn-change-cred-client"
                            style="margin-left: auto; font-size: 0.8rem; color: var(--info-blue); background: none; border: none; cursor: pointer; text-decoration: underline;">Alterar</button>
                    </div>

                    <div class="form-group">
                        <label>Parcelamento</label>
                        <select id="sale-installments"
                            style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 1rem; background-color: #fff;">
                            <option value="1">1x (À vista na Fatura)</option>
                            <option value="2">2x Sem Juros</option>
                            <option value="3">3x Sem Juros</option>
                            <option value="4">4x Sem Juros</option>
                            <option value="5">5x Sem Juros</option>
                            <option value="6">6x Sem Juros</option>
                        </select>
                        <div style="margin-top: 10px; text-align: center; font-weight: 600; color: var(--primary-red); background: #fff0f3; padding: 10px; border-radius: 8px;"
                            id="installment-preview">
                        </div>
                    </div>

                    <button class="btn btn-primary" id="confirm-crediario-btn" style="width: 100%; margin-top: 10px;">
                        <i class='bx bx-check-double'></i> Confirmar Lançamento
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="receipt-modal">
        <div class="modal-content">
            <div class="modal-body centered">
                <div class="modal-icon success"><i class='bx bx-check font-40'></i></div>
                <h3 class="font-1-5rem mb-8">Venda Finalizada!</h3>
                <p>Venda no valor de <strong id="receipt-total">R$ 0,00</strong> registrada com sucesso.</p>
                <div class="modal-footer flex-col">
                    <button class="btn btn-primary" id="print-receipt-btn">
                        <i class='bx bx-printer'></i> Imprimir Recibo (Não Fiscal)
                    </button>
                    <button class="btn btn-secondary" id="new-sale-btn" data-primary-focus="true">
                        <i class='bx bx-rotate-left'></i> Nova Venda
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="order-details-modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Pedido <span id="modal-order-id" class="text-light">#0000</span></h3>
                <button class="close-modal-btn" data-target="order-details-modal"><i class='bx bx-x'></i></button>
            </div>

            <div class="modal-body">
                <div class="order-progress-track">
                    <div class="step-item" id="step-pendente" onclick="manualSetStatus('pendente')"
                        title="Voltar para Recebido">
                        <div class="step-icon"><i class='bx bx-list-ul'></i></div>
                        <span>Recebido</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" id="step-preparando" onclick="manualSetStatus('preparando')"
                        title="Mudar para Separando">
                        <div class="step-icon"><i class='bx bx-box'></i></div>
                        <span>Separando</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" id="step-enviado" onclick="manualSetStatus('enviado')"
                        title="Mudar para Enviado">
                        <div class="step-icon"><i class='bx bx-car'></i></div>
                        <span>Enviado</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" id="step-finalizado" onclick="manualSetStatus('finalizado')"
                        title="Mudar para Entregue">
                        <div class="step-icon"><i class='bx bx-check-double'></i></div>
                        <span>Entregue</span>
                    </div>
                </div>

                <div class="order-info-box">
                    <h4 class="font-sm mb-8 flex-align gap-8">
                        <i class='bx bx-user'></i> <span id="modal-order-client">Nome do Cliente</span>
                    </h4>
                    <p class="font-sm text-light mb-4">
                        <i class='bx bx-map'></i> <span id="modal-order-address">Endereço...</span>
                    </p>
                    <div class="flex-justify mt-8">
                        <span class="badge-bg" id="modal-payment-method">Pagamento: --</span>
                    </div>
                </div>

                <div class="flex-justify-center mb-10">
                    <h4 class="font-md margin-0">Conferência de Estoque</h4>
                    <small class="text-light">Marque os itens disponíveis</small>
                </div>

                <div id="modal-order-items-list" class="order-items-scroll"></div>

                <div class="financial-breakdown">
                    <div class="financial-row">
                        <span>Subtotal</span>
                        <span id="modal-calc-subtotal">R$ 0,00</span>
                    </div>
                    <div class="financial-row danger" id="row-canceled-items" style="display: none;">
                        <span>Itens Cancelados/Sem Estoque</span>
                        <span id="modal-calc-canceled">- R$ 0,00</span>
                    </div>
                    <div class="financial-row final">
                        <span>Total Final</span>
                        <span id="modal-calc-total" class="text-red">R$ 0,00</span>
                    </div>
                </div>
            </div>

            <div class="modal-footer flex-col gap-10">
                <button id="btn-update-status" class="btn btn-primary">Avançar Status</button>
                <button class="btn btn-close-modal-lg close-modal-btn" data-target="order-details-modal">Fechar
                    Janela</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-body centered">
                <div class="modal-icon danger"><i class='bx bx-error-alt font-40'></i></div>
                <h3 class="font-1-5rem mb-8" id="confirm-title">Tem certeza?</h3>
                <p id="confirm-message">Esta ação não pode ser desfeita.</p>
                <div class="modal-footer justify-center">
                    <button class="btn btn-secondary close-modal-btn" data-target="confirm-modal">Cancelar</button>
                    <button class="btn btn-danger" id="confirm-action-btn" data-primary-focus="true">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="alert-modal">
        <div class="modal-content">
            <div class="modal-body centered">
                <div class="modal-icon info"><i class='bx bx-info-circle font-40'></i></div>
                <h3 class="font-1-5rem mb-8" id="alert-title">Atenção</h3>
                <p id="alert-message">Ocorreu um erro.</p>
                <div class="modal-footer justify-center">
                    <button class="btn btn-primary close-modal-btn" data-target="alert-modal"
                        data-primary-focus="true">Entendi</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="add-cliente-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Novo Cliente</h3>
                <button class="close-modal-btn" data-target="add-cliente-modal"><i class='bx bx-x'></i></button>
            </div>
            <form id="add-cliente-form">
                <div class="modal-body">
                    <h4 class="mb-16 font-md text-dark">Dados Pessoais</h4>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="cliente-apelido">Apelido (Como é conhecido) *</label>
                            <input type="text" id="cliente-apelido" required data-primary-focus="true"
                                placeholder="Ex: Maria Manicure">
                        </div>
                        <div class="form-group">
                            <label for="cliente-telefone">Telefone</label>
                            <input type="tel" id="cliente-telefone" placeholder="(XX) 9XXXX-XXXX">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="cliente-nome">Nome Completo</label>
                            <input type="text" id="cliente-nome" placeholder="Nome Civil">
                        </div>
                        <div class="form-group">
                            <label for="cliente-cpf">CPF (Opcional)</label>
                            <input type="text" id="cliente-cpf" placeholder="000.000.000-00">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cliente-endereco">Endereço</label>
                        <textarea id="cliente-endereco" rows="2" placeholder="Rua, Número, Bairro..."></textarea>
                    </div>

                    <hr class="separator my-16">

                    <h4 class="mb-16 font-md text-dark">Compra Inicial (Opcional)</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="compra-valor">Valor (R$)</label>
                            <input type="number" id="compra-valor" step="0.01" min="0" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="cliente-dia-vencimento">Dia de Vencimento da Fatura</label>
                            <select id="cliente-dia-vencimento" required>
                                <option value="5">Dia 05</option>
                                <option value="10" selected>Dia 10</option>
                                <option value="15">Dia 15</option>
                                <option value="20">Dia 20</option>
                                <option value="25">Dia 25</option>
                                <option value="30">Dia 30</option>
                            </select>
                            <small class="text-light">A fatura fecha 10 dias antes desta data.</small>
                        </div>
                        <div class="form-group">
                            <label for="cliente-limite">Limite de Crédito (R$)</label>
                            <input type="number" id="cliente-limite" placeholder="Ex: 500.00">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn"
                        data-target="add-cliente-modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="cliente-save-btn">
                        <i class='bx bx-save'></i> Salvar Cliente
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="open-caixa-modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>Abrir Caixa</h3>
            </div>
            <form id="open-caixa-form">
                <div class="modal-body">
                    <p>Informe o valor inicial para troco ou abra sem valor.</p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="open-caixa-notas">Valor em Notas (R$)</label>
                            <input type="number" id="open-caixa-notas" step="0.01" min="0" placeholder="0,00"
                                data-primary-focus="true">
                        </div>
                        <div class="form-group">
                            <label for="open-caixa-moedas">Valor em Moedas (R$)</label>
                            <input type="number" id="open-caixa-moedas" step="0.01" min="0" placeholder="0,00">
                        </div>
                    </div>
                    <div class="toggle-switch-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="open-caixa-sem-valor">
                            <span class="slider"></span>
                        </label>
                        <label for="open-caixa-sem-valor">Abrir caixa sem valor inicial</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="open-caixa-save-btn">
                        <i class='bx bx-check'></i> Confirmar Abertura
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="close-caixa-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Fechar Caixa</h3>
                <button class="close-modal-btn" data-target="close-caixa-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="modal-progress-bar">
                    <div class="progress" id="close-caixa-progress" style="width: 25%;"></div>
                </div>
                <form id="close-caixa-form" class="multi-step-form">

                    <div id="close-caixa-step-1" class="form-step active">
                        <h4>Etapa 1: Valores Contados</h4> <br>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="close-caixa-notas">Notas (R$) *</label>
                                <input type="number" id="close-caixa-notas" step="0.01" min="0" placeholder="0,00"
                                    required data-primary-focus="true">
                            </div>
                            <div class="form-group">
                                <label for="close-caixa-moedas">Moedas (R$) *</label>
                                <input type="number" id="close-caixa-moedas" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                        </div>
                    </div>

                    <div id="close-caixa-step-2" class="form-step">
                        <h4>Etapa 2: Outras Entradas</h4> <br>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="close-caixa-cartao">Maquininha Cartão (R$) *</label>
                                <input type="number" id="close-caixa-cartao" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="close-caixa-pix">Pix Fixo QR Code (R$)</label>
                                <input type="number" id="close-caixa-pix" step="0.01" min="0" placeholder="0,00">
                                <small class="shortcut-hint">Opcional.</small>
                            </div>
                        </div>
                    </div>

                    <div id="close-caixa-step-3" class="form-step">
                        <h4>Etapa 3: Destino do Dinheiro Contado</h4> <br>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="close-caixa-deposito">Valor p/ Depósito (R$) *</label>
                                <input type="number" id="close-caixa-deposito" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="close-caixa-fica">Valor Fica Caixa (R$) *</label>
                                <input type="number" id="close-caixa-fica" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                        </div>
                    </div>

                    <div id="close-caixa-step-4" class="form-step">
                        <h4>Etapa 4: Responsável</h4> <br>
                        <div class="form-group">
                            <label for="close-caixa-assinatura">Assinatura (Nome do Responsável) *</label>
                            <input type="text" id="close-caixa-assinatura" required>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer modal-footer-multi-step">
                <button class="btn btn-secondary" id="close-caixa-prev-btn" style="display: none;">
                    <i class='bx bx-chevron-left'></i> Anterior
                </button>
                <button class="btn btn-primary" id="close-caixa-next-btn">
                    Próximo <i class='bx bx-chevron-right'></i>
                </button>
                <button type="submit" form="close-caixa-form" class="btn btn-danger" id="close-caixa-save-btn"
                    style="display: none;">
                    <i class='bx bx-lock-alt'></i> Confirmar Fechamento
                </button>
            </div>
        </div>
    </div>



    <div id="print-area" class="print-only">
        <div class="invoice-container">

            <header class="invoice-header">
                <div class="brand-section">
                    <img src="assets/logo.png" id="print-logo-img" alt="Logo">

                    <div class="brand-text">
                        <h1 id="print-store-name">DTUDO VARIEDADES E UTILIDADES</h1>
                        <p class="brand-subtitle">CNPJ: 45.692.327/0001-00</p>
                    </div>
                </div>

                <div class="invoice-meta">
                    <h2 class="doc-title">COMPROVANTE DE VENDA</h2>
                    <div class="meta-grid">
                        <div class="meta-item">
                            <i class='bx bx-hash'></i>
                            <div>
                                <span class="label">NÚMERO</span>
                                <span class="value" id="print-sale-id">0000</span>
                            </div>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-calendar'></i>
                            <div>
                                <span class="label">DATA</span>
                                <span class="value" id="print-sale-date">--/--/--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <hr class="divider-thick">

            <section class="client-section">
                <div class="section-title">
                    <i class='bx bx-user-circle'></i> DADOS DO CLIENTE
                </div>
                <div class="client-card">
                    <div class="client-row main">
                        <span id="print-client-name">CONSUMIDOR FINAL</span>
                    </div>
                    <div class="client-row details">
                        <span><i class='bx bx-id-card'></i> <span id="print-client-doc">---</span></span>
                        <span><i class='bx bx-map'></i> <span id="print-client-address">Endereço não
                                informado</span></span>
                    </div>
                </div>
            </section>

            <section class="items-section">
                <table class="premium-table">
                    <thead>
                        <tr>
                            <th width="10%">COD</th>
                            <th width="50%">DESCRIÇÃO</th>
                            <th width="10%" class="text-center">QTD</th>
                            <th width="15%" class="text-right">UNIT</th>
                            <th width="15%" class="text-right">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody id="print-items-body">
                    </tbody>
                </table>
            </section>

            <section class="totals-section">
                <div class="payment-info">
                    <div class="section-title small">
                        <i class='bx bx-credit-card'></i> PAGAMENTO
                    </div>
                    <p id="print-obs-text" class="payment-method-text">---</p>

                    <div id="print-installments-area" style="display: none; margin-top: 10px;">
                        <div class="installments-strip" id="print-installments-list"></div>
                    </div>
                </div>

                <div class="totals-box">
                    <div class="t-row">
                        <span>Subtotal</span>
                        <span id="print-subtotal">R$ 0,00</span>
                    </div>
                    <div class="t-row">
                        <span>Descontos</span>
                        <span id="print-discount">R$ 0,00</span>
                    </div>
                    <div class="t-row grand-total">
                        <span>TOTAL A PAGAR</span>
                        <span id="print-total">R$ 0,00</span>
                    </div>
                </div>
            </section>

            <footer class="invoice-footer">
                <div class="legal-text">
                    <p><strong>TERMO DE CONFISSÃO DE DÍVIDA:</strong> Reconheço(emos) a exatidão desta dívida e a
                        obrigação de pagá-la. O não pagamento acarretará nas medidas legais cabíveis. Mercadoria
                        recebida em perfeito estado.</p>
                </div>

                <div class="signature-area">
                    <div class="line"></div>
                    <div class="sig-name" id="print-signature-name">CLIENTE</div>
                </div>

                <div class="system-tag">
                    DTUDO SISTEMAS • Impresso em <span id="print-timestamp"></span>
                </div>
            </footer>
        </div>
    </div>

    <div class="pn">
        <div class="pn-hr">
            <div class="loading1"></div>
            <p class="horario" id="horario">00:00:00</p>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>