<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/assets/img/iconWeb.png">
    <title>Ponto de Venda | ELETRO</title>

    <link rel="stylesheet" href="style.css">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-solid-straight/css/uicons-solid-straight.css'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BV6V3GTMR0"></script>

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-BV6V3GTMR0');
    </script>
</head>

<body>


    <div class="modal-overlay" id="print-selection-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Como deseja o comprovante?</h3>
                <button class="close-modal-btn" data-target="print-selection-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p class="text-center mb-16 text-light">Escolha o formato ideal para o cliente.</p>

                <div class="print-options-grid">
                    <div id="btn-print-thermal" class="print-option-card">
                        <i class='bx bx-receipt print-icon'></i>
                        <h4>Cupom Fiscal</h4>
                        <p class="text-sm text-light text-center">Térmica (80mm)<br>Compacto</p>
                    </div>

                    <div id="btn-print-a4" class="print-option-card">
                        <i class='bx bx-file-blank print-icon' style="color: #4f46e5;"></i>
                        <h4>Folha A4</h4>
                        <p class="text-sm text-light text-center">Impressora Comum<br>Detalhado</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="loading-overlay">
        <i class='bx bx-loader-alt bx-spin'></i>
        <p id="loading-message">Verificando status do caixa...</p>
    </div>

    <div class="modal-overlay" id="client-selection-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Identificar Cliente</h3>
                <button class="close-modal-btn" data-target="client-selection-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="search-row-modern">
                    <div class="input-modern-wrapper">
                        <i class='bx bx-search' style="color: #9ca3af; font-size: 1.2rem;"></i>
                        <input type="text" id="client-selection-input" class="input-modern"
                            placeholder="Busque por nome..." autocomplete="off" data-primary-focus="true">
                    </div>

                    <button class="btn-square-add" id="btn-new-client-modal" title="Novo Cliente">
                        <i class='bx bx-plus'></i>
                    </button>
                </div>

                <div class="client-results-modern" id="client-selection-results" style="display:none;"></div>

                <p class="text-center text-light mt-20 text-sm" id="client-search-hint">
                    Digite para buscar...
                </p>
            </div>
        </div>
    </div>

    <div class="modal-overlay z-high" id="image-viewer-modal">
        <div class="modal-content modal-fullscreen">
            <div class="modal-header">
                <h3>Visualizar Comprovante</h3>
                <button class="close-modal-btn" data-target="image-viewer-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body viewer-body">
                <p id="viewer-loading" class="viewer-loading">
                    <i class='bx bx-loader-alt bx-spin'></i> Carregando imagem...
                </p>
                <iframe id="viewer-iframe" src="" class="viewer-iframe"></iframe>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="cliente-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ficha do Cliente</h3>
                <button class="close-modal-btn" data-target="cliente-details-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="client-profile-header"
                    style="position: relative; display: flex; align-items: center; gap: 10px;">
                    <div class="client-avatar"><i class='bx bx-user'></i></div>
                    <div style="flex-grow: 1;">
                        <h4 id="detail-cliente-nome">Carregando...</h4>
                        <p id="detail-cliente-apelido" class="text-light">...</p>
                    </div>
                    <button id="btn-admin-edit"
                        style="background: none; border: none; color: #666; font-size: 1.4rem; cursor: pointer; padding: 5px;"
                        title="Admin: Renegociar">
                        <i class='bx bxs-pencil'></i>
                    </button>
                </div>
                <div class="client-stats-grid">
                    <div class="stat-box">
                        <span class="stat-label">Saldo Devedor</span>
                        <span class="stat-value danger" id="detail-cliente-saldo">R$ 0,00</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-label">Próximo Venc.</span>
                        <span class="stat-value" id="detail-cliente-vencimento">--/--/----</span>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 0 5px;">
                    <button id="btn-gerar-acesso" class="action-btn"
                        style="background: #1f2937; color: white; width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer;">
                        <i class='bx bx-qr-scan'></i> Gerar Acesso do Cliente
                    </button>

                    <div id="qrcode-container"
                        style="display:none; margin-top: 15px; justify-content: center; background: white; padding: 10px; border-radius: 8px;">
                    </div>

                    <p id="link-acesso-text"
                        style="font-size: 12px; color: #007bff; word-break: break-all; display:none; margin-top:10px; text-align: center; cursor: pointer;">
                    </p>
                </div>

                <div class="limit-container">
                    <div class="limit-header">
                        <span>Limite: <strong id="detail-cliente-limite-total">R$ 0,00</strong></span>
                        <button class="btn-edit-limit" id="btn-alterar-limite" title="Alterar Limite"><i
                                class='bx bx-edit-alt'></i></button>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" id="detail-cliente-progress"></div>
                    </div>
                    <div class="limit-stats">
                        <span id="detail-cliente-disponivel">Disponível: R$ 0,00</span>
                        <span id="detail-cliente-percentual">0% usado</span>
                    </div>
                </div>

                <div class="history-section">
                    <h4><i class='bx bx-history'></i> Histórico Recente</h4>
                    <div class="history-list-container" id="detail-history-container">
                        <p class="text-center loading-text">Carregando...</p>
                    </div>
                </div>

                <div class="form-group mt-16">
                    <label>Contato</label>
                    <div class="info-box">
                        <p><i class='bx bx-phone'></i> <span id="detail-cliente-telefone">--</span></p>
                        <p><i class='bx bx-map'></i> <span id="detail-cliente-endereco">--</span></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-modal-btn" data-target="cliente-details-modal">Fechar</button>
            </div>
        </div>
    </div>

    <div id="modal-admin-auth" class="modal-overlay">
        <div class="modal-content" style="max-width: 300px; text-align: center; border-radius: 15px; padding: 25px;">
            <div class="modal-header" style="justify-content: center; border: none; padding: 0; margin-bottom: 15px;">
                <div
                    style="background: #fee2e2; color: #dc2626; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                    <i class='bx bxs-lock-alt'></i>
                </div>
            </div>
            <div class="modal-body" style="padding: 0;">
                <h3 style="margin: 0 0 10px 0; color: #1f2937;">Área Restrita</h3>
                <p style="font-size: 0.9rem; color: #6b7280; margin-bottom: 20px;">Digite a senha de administrador.</p>

                <input type="password" id="admin-password-input" class="form-input" placeholder="Senha..."
                    style="text-align: center; font-size: 1.1rem; margin-bottom: 5px;">
                <p id="auth-error-msg"
                    style="color: #dc2626; font-size: 0.8rem; display: none; margin-bottom: 15px; font-weight: 600;">
                    Senha incorreta!</p>

                <div style="display: flex; gap: 10px;">
                    <button id="btn-cancel-auth" class="secondary-btn"
                        style="flex: 1; justify-content: center;">Cancelar</button>
                    <button id="btn-confirm-auth" class="primary-btn"
                        style="flex: 1; background: #db0038; justify-content: center;">Entrar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-renegociar" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class='bx bx-calendar-edit'></i> Renegociar (Admin)</h3>
                <span class="close-modal" id="close-renegociar">&times;</span>
            </div>
            <div class="modal-body">
                <div
                    style="background: #fdf2f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #fbcfe8; text-align: center;">
                    <p style="font-size: 0.8rem; color: #db0038; font-weight: 600; text-transform: uppercase;">Saldo
                        Devedor Total</p>
                    <p style="font-size: 1.8rem; font-weight: 800; color: #be185d;" id="reneg-saldo-atual">R$ 0,00</p>
                </div>

                <div class="form-group">
                    <label>Vencimento Atual</label>
                    <input type="text" id="reneg-vencimento-atual" class="form-input" disabled
                        style="background: #e5e7eb; color: #555;">
                </div>

                <div class="form-group">
                    <label style="color: #db0038; font-weight: 700;">Parcelamento da Dívida</label>
                    <select id="reneg-parcelas" class="form-input" style="border: 2px solid #db0038;">
                        <option value="1">1x (Manter valor total)</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                        <option value="5">5x</option>
                        <option value="6">6x</option>
                    </select>
                </div>

                <div class="form-group">
                    <label style="color: #db0038; font-weight: 700;">Nova Data de Vencimento</label>
                    <input type="date" id="reneg-nova-data" class="form-input" style="border: 2px solid #db0038;">
                    <p style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                        Isso altera a data manualmente, tirando o cliente do atraso até o dia escolhido.
                    </p>
                </div>

                <button id="btn-confirmar-renegociacao" class="primary-btn"
                    style="width: 100%; margin-top: 15px; background: #db0038;">
                    CONFIRMAR ALTERAÇÃO
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="announcement-modal" style="z-index: 9999;">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3><i class='bx bx-info-circle'></i> Comunicado Interno</h3>
                <button class="close-modal-btn" onclick="closeAnnouncement()"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body text-center">
                <p class="mb-16"><strong>Recuperação de Vendas (Backup):</strong> O sistema recuperou todas as vendas do presente dia.</p>
                <p class="text-light text-sm mb-16">A emissão de <strong>Notas Fiscais</strong> permanece em modo
                    <strong>MANUAL</strong> até a conclusão da manutenção.</p>
                <div
                    style="background: #f3f4f6; padding: 8px; border-radius: 6px; font-family: monospace; font-size: 0.8rem; color: #6b7280;">
                    Versão: v.1.0.0.39.3B
                </div>
            </div>
            <div class="modal-footer justify-center">
                <button class="btn btn-primary" onclick="closeAnnouncement()">Entendi</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="cliente-pay-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Receber de Cliente</h3>
                <button class="close-modal-btn" data-target="cliente-pay-modal"><i class='bx bx-x'></i></button>
            </div>
            <form id="cliente-pay-form">
                <div class="modal-body">
                    <p>Registrar pagamento para: <strong id="pay-cliente-nome">...</strong></p>
                    <p class="text-sm text-light mb-16">
                        Saldo Atual: <span id="pay-cliente-saldo-atual" class="text-danger font-bold">R$ 0,00</span>
                    </p>

                    <div class="form-group">
                        <label for="pay-valor">Valor do Pagamento (R$) *</label>
                        <input type="number" id="pay-valor" step="0.01" min="0.01" placeholder="0,00" required
                            data-primary-focus="true">
                    </div>

                    <div class="form-group">
                        <label for="pay-metodo">Forma de Pagamento *</label>
                        <select id="pay-metodo" required>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="PIX">PIX</option>
                            <option value="Cartão">Cartão</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn"
                        data-target="cliente-pay-modal">Cancelar</button>
                    <button type="submit" class="btn btn-success">
                        <i class='bx bx-dollar-circle'></i> Confirmar Pagamento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="main-content" id="main-content">

        <div class="app-header">
            <h1>Ponto de Venda</h1>
            <button class="btn btn-danger" id="header-close-caixa-btn" style="display: none;">
                <i class='bx bx-stop-circle'></i> Fechar Caixa (F8)
            </button>
        </div>


        <nav class="navbar" id="main-navbar">
            <span class="navbar-item active" data-page="pdv">PDV</span>
            <span class="navbar-item" data-page="pedidos">Pedidos</span>
            <span class="navbar-item" data-page="historico">Histórico</span>

            <div class="navbar-more-container">
                <div class="navbar-item" id="more-menu-btn">
                    Gerenciamento
                    <i class='bx bx-chevron-down' id="more-menu-icon"></i>
                </div>

                <div class="more-menu-modal" id="more-menu-modal">
                    <div class="more-menu-item" data-page="produtos">
                        <div class="item-icon-box"><i class='bx bx-package'></i></div>
                        <div class="item-content">
                            <strong>Produtos</strong>
                            <span>Estoque e fiscal</span>
                        </div>
                    </div>

                    <div class="more-menu-item" data-page="clientes">
                        <div class="item-icon-box pro-icon"><i class='bx bx-group'></i></div>
                        <div class="item-content">
                            <div class="title-row">
                                <strong>Crediário Digital</strong>
                                <span class="pro-tag">PRO</span>
                            </div>
                            <span>Carteira de crédito</span>
                        </div>
                    </div>

                    <div class="menu-divider"></div>

                    <div class="more-menu-item" data-page="notas">
                        <div class="item-icon-box" style="background: #e0f2fe; color: #0284c7;"><i
                                class='bx bx-file'></i></div>
                        <div class="item-content">
                            <strong>Notas Fiscais</strong>
                            <span>Emitidas e Pendentes</span>
                        </div>
                    </div>

                    <div class="more-menu-item" data-page="configuracoes">
                        <div class="item-icon-box"><i class='bx bx-cog'></i></div>
                        <div class="item-content">
                            <strong>Configurações</strong>
                            <span>Ajustes do Sistema</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="navbar-highlight" id="navbar-highlight"></div>
        </nav>



        <div id="pdv-page" class="page-content">
            <div class="pdv-layout">
                <div class="pdv-main">
                    <div class="tooltip">
                        <div class="barcode-scanner">
                            <i class='bx bx-barcode-reader'></i>
                            <input type="text" id="barcode-input" placeholder="Carregando produtos..." disabled>
                        </div>
                        <span class="tooltip-text">Digite o código ou nome para adicionar</span>
                    </div>
                    <p class="shortcut-hint" id="barcode-hint">Carregando produtos...</p>

                    <div class="item-list-container" id="item-list-container">
                        <div class="empty-state" id="empty-state">
                            <span>Nenhum item na venda</span>
                        </div>
                        <table class="item-list-table" id="item-list-table" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Qtd.</th>
                                    <th>Preço Unit.</th>
                                    <th class="text-center">Oferta %</th>
                                    <th>Total</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="cart-items-body"></tbody>
                        </table>
                    </div>
                </div>

                <aside class="pdv-summary">
                    <div class="card">
                        <div class="summary-client-card" id="summary-client-card">
                            <div class="summary-client-header">
                                <span class="summary-client-name">
                                    <i class='bx bx-user'></i> <span id="summary-client-name-text">Nome do
                                        Cliente</span>
                                </span>
                                <button class="btn-change-client" id="btn-change-summary-client">Alterar</button>
                            </div>
                            <div class="summary-limit-bar">
                                <div class="summary-limit-fill" id="summary-limit-fill"></div>
                            </div>
                            <div class="summary-limit-text">
                                <span id="summary-limit-label">Limite Disp.</span>
                                <span id="summary-limit-value">R$ 0,00</span>
                            </div>
                        </div>

                        <h2>Resumo da Venda</h2>

                        <div class="summary-row">
                            <span class="label">Subtotal (<span id="item-count">0</span> itens)</span>
                            <span class="value" id="summary-subtotal">R$ 0,00</span>
                        </div>

                        <div class="summary-row summary-row-interactive" id="discount-toggle-row"
                            title="Adicionar desconto">
                            <span class="label"> <i class='bx bx-purchase-tag'></i> Descontos (F3) </span>
                            <span class="value editable" id="summary-discount">- R$ 0,00</span>
                        </div>

                        <div class="discount-popover" id="discount-popover">
                            <div class="form-group">
                                <label for="discount-input-r">Valor do Desconto (R$)</label>
                                <input type="number" id="discount-input-r" placeholder="0,00" step="0.01">
                            </div>
                            <span class="discount-popover-label">Desconto Rápido (%)</span>
                            <div class="discount-perc-buttons" id="perc-btn-container">
                                <button class="perc-btn" data-perc="1">1%</button>
                                <button class="perc-btn" data-perc="3">3%</button>
                                <button class="perc-btn" data-perc="5">5%</button>
                                <button class="perc-btn" data-perc="8">8%</button>
                            </div>
                            <div class="effective-discount-display" id="effective-discount-display">
                                <i class='bx bx-badge-percent'></i><span id="discount-percentage-text"></span>
                            </div>
                            <button class="btn-remove-discount" id="remove-discount-btn">
                                <i class='bx bx-x'></i> Remover Desconto
                            </button>
                            <span class="discount-nav-hint" id="remove-discount-hint">Pressione 'Enter' para
                                remover</span>
                        </div>

                        <div class="summary-row summary-row-interactive" id="payment-toggle-row"
                            title="Selecionar forma de pagamento">
                            <span class="label"> <i class='bx bx-credit-card'></i> Pagamento (F4) </span>
                            <span class="value editable" id="summary-payment-method">Não selecionado</span>
                        </div>

                        <div class="summary-row summary-row-interactive" id="seller-toggle-row"
                            title="Selecionar Vendedor">
                            <span class="label"> <i class='bx bx-id-card'></i> Vendedor </span>
                            <span class="value editable" id="summary-seller-name">Não informado</span>
                        </div>

                        <div class="discount-popover" id="seller-popover">
                            <span class="discount-popover-label">Quem está vendendo?</span>
                            <div class="seller-grid grid-3-cols mt-10">
                                <button class="perc-btn seller-btn" data-name="Nubia">Nubia</button>
                                <button class="perc-btn seller-btn" data-name="Evelyn">Evelyn</button>
                                <button class="perc-btn seller-btn" data-name="Ryan">Ryan</button>
                            </div>
                        </div>

                        <div class="summary-total">
                            <div class="summary-row">
                                <span class="label">Total</span>
                                <span class="value" id="summary-total">R$ 0,00</span>
                            </div>
                        </div>

                        <div class="tax-transparency-card" id="open-tax-modal">
                            <div class="tax-header">
                                <span><i class='bx bx-line-chart'></i> Impostos Estimados 2026</span>
                                <i class='bx bx-help-circle'></i>
                            </div>
                            <div class="tax-amount-main">
                                <span class="currency">R$</span>
                                <span id="tax-counter-val" class="counter">0,00</span>
                            </div>
                            <p class="tax-legal-hint">Simples Nacional: Alíquota Efetiva 4,00%</p>
                        </div>

                        <div class="tooltip">
                            <button class="btn btn-primary" id="finish-sale-btn">
                                <i class='bx bx-check-circle'></i> Finalizar Venda (F9)
                            </button>
                            <span class="tooltip-text">Registra a venda e abre opções de recibo</span>
                        </div>
                        <div class="tooltip">
                            <button class="btn btn-secondary" id="cancel-sale-btn">
                                <i class='bx bx-x-circle'></i> Cancelar Venda (F10)
                            </button>
                            <span class="tooltip-text">Limpa todos os itens da venda atual</span>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <div id="pedidos-page" class="page-content" style="display: none;">
            <div class="card card-lg card-transparent">
                <div class="page-header header-styled">
                    <div>
                        <h2><i class='bx bx-shopping-bag'></i> Pedidos Online</h2>
                        <p class="text-light no-margin">Gerencie as vendas em tempo real.</p>
                    </div>
                    <div>
                        <button class="btn btn-secondary btn-auto">
                            <i class='bx bx-refresh'></i> Atualizar
                        </button>
                    </div>
                </div>

                <div class="orders-tabs" id="order-status-tabs">
                    <div class="order-tab active" data-status="pendente">
                        Pendentes <span class="badge warning" id="count-pendente">0</span>
                    </div>
                    <div class="order-tab" data-status="preparando">
                        Preparando <span class="badge neutral" id="count-preparando">0</span>
                    </div>
                    <div class="order-tab" data-status="enviado">
                        Enviados
                    </div>
                    <div class="order-tab" data-status="finalizado">
                        Finalizados
                    </div>
                </div>

                <div id="orders-grid-container" class="orders-grid">
                    <p class="grid-full text-center text-light pad-40">
                        <i class='bx bx-loader-alt bx-spin font-2rem'></i><br>Carregando...
                    </p>
                </div>
            </div>
        </div>

        <div id="produtos-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header">
                    <div>
                        <h2>Gerenciador de Produtos</h2>
                        <p class="text-light mt-4 mb-0 text-sm">Controle de estoque e definições fiscais.</p>
                    </div>
                    <button class="btn btn-primary btn-auto" id="btn-add-product" title="Cadastrar Novo Item">
                        <i class='bx bx-plus'></i> Adicionar
                    </button>
                </div>

                <div class="toolbar-products mb-24">
                    <div class="search-box-wrapper" style="flex: 1;">
                        <div class="client-search-container">
                            <i class='bx bx-search client-search-icon'></i>
                            <input type="text" id="products-search-input" class="client-search-input"
                                placeholder="Buscar por nome, código ou NCM..." autocomplete="off">
                        </div>
                    </div>

                    <div class="filter-capsules" id="product-filters">
                        <button class="filter-cap active" data-filter="all">
                            Todos <span class="badge-count" id="count-all">0</span>
                        </button>
                        <button class="filter-cap" data-filter="fiscal_ok">
                            <i class='bx bx-check-circle'></i> Fiscal OK <span class="badge-count"
                                id="count-ok">0</span>
                        </button>
                        <button class="filter-cap" data-filter="fiscal_pending">
                            <i class='bx bx-error-circle'></i> Pendente <span class="badge-count"
                                id="count-pending">0</span>
                        </button>
                    </div>
                </div>

                <div id="produtos-table-container" class="products-list-wrapper">
                </div>
            </div>
        </div>

        <div id="clientes-page" class="page-content" style="display: none;">
            <div class="card">
                <div class="page-header">
                    <div>
                        <div class="title-page">
                            <h2>Crediário Digital</h2>
                            <span class="pro-badge-main pro-tag">PRO</span>
                        </div>
                        <p class="text-light mt-4 mb-0 text-sm">Gerencie pagamentos e inadimplência.</p>
                    </div>
                    <button class="btn btn-primary btn-auto" id="add-cliente-btn">
                        <i class='bx bx-user-plus'></i> Novo Cliente
                    </button>
                </div>

                <div class="search-box-wrapper mb-20">
                    <div class="client-search-container">
                        <i class='bx bx-search client-search-icon'></i>
                        <input type="text" id="clientes-page-search" class="client-search-input"
                            placeholder="Buscar cliente por nome ou apelido..." autocomplete="off">
                    </div>
                </div>
                <div id="clientes-list-container">
                </div>
            </div>
        </div>

        <div id="caixa-page" class="page-content" style="display: none;"></div>

        <div id="historico-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header header-styled">
                    <div>
                        <h2><i class='bx bx-history'></i> Vendas de Hoje</h2>
                        <p class="text-light mt-4 mb-0 text-sm">Resumo das movimentações do caixa atual.</p>
                    </div>
                    <button class="btn btn-secondary btn-auto" id="btn-refresh-history">
                        <i class='bx bx-refresh'></i> Atualizar
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="products-table" id="history-table">
                        <thead>
                            <tr>
                                <th>Hora</th>
                                <th>Cliente</th>
                                <th>Pagamento</th>
                                <th>Valor</th>
                                <th class="text-center">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="sales-history-list">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="notas-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header header-styled">
                    <div>
                        <h2><i class='bx bx-receipt'></i> Notas Fiscais</h2>
                        <p class="text-light mt-4 mb-0 text-sm">Histórico de emissões e regularização de produtos.</p>
                    </div>
                    <div class="header-actions">
                        <span class="badge warning"><i class='bx bx-test-tube'></i> Ambiente Homologação</span>
                    </div>
                </div>

                <div class="orders-tabs" id="notas-tabs">
                    <div class="order-tab active" data-view="emitidas">Emitidas</div>
                    <div class="order-tab" data-view="pendentes">Itens Pendentes</div>
                </div>

                <div id="view-notas-emitidas" class="mt-20">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>ID Venda</th>
                                <th>Data</th>
                                <th>Itens</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody id="lista-notas-emitidas">
                        </tbody>
                    </table>
                </div>

                <div id="view-notas-pendentes" class="mt-20" style="display: none;">
                    <div class="status-box warning" style="text-align: left; padding: 15px; margin-bottom: 20px;">
                        <i class='bx bx-info-circle'></i>
                        <span>Estes itens foram vendidos mas removidos da nota fiscal por falta de cadastro completo.
                            Complete o cadastro em "Produtos" para futuras vendas.</span>
                    </div>
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Venda Origem</th>
                                <th>Motivo</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody id="lista-itens-pendentes">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="modal-ver-nota">
            <div class="modal-content modal-md">
                <div class="modal-header">
                    <h3>DANFE NFC-e (Homologação)</h3>
                    <button class="close-modal-btn" data-target="modal-ver-nota"><i class='bx bx-x'></i></button>
                </div>
                <div class="modal-body"
                    style="background: #fff8dc; color: #5d4037; font-family: 'Courier New', monospace; padding: 20px; border: 1px dashed #333;">
                    <div
                        style="text-align: center; border-bottom: 1px dashed #333; padding-bottom: 10px; margin-bottom: 10px;">
                        <h4>A N F DA SILVA LTDA</h4>
                        <p>CNPJ: 45.692.327/0001-00</p>
                        <p><strong>AMBIENTE DE HOMOLOGAÇÃO - SEM VALOR FISCAL</strong></p>
                    </div>
                    <div id="danfe-itens-list"></div>
                    <div
                        style="border-top: 1px dashed #333; margin-top: 10px; padding-top: 10px; display: flex; justify-content: space-between; font-weight: bold;">
                        <span>TOTAL R$</span>
                        <span id="danfe-total-valor">0,00</span>
                    </div>
                    <div style="text-align: center; margin-top: 20px; font-size: 0.8rem;">
                        <p>EMISSÃO NORMAL</p>
                        <p id="danfe-chave">1525 1245 6923 ...</p>
                        <p>Consulte pela Chave de Acesso em<br>www.sefaz.pa.gov.br</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="sale-details-modal">
            <div class="modal-content modal-md">
                <div class="modal-header">
                    <h3>Detalhes da Venda</h3>
                    <button class="close-modal-btn" data-target="sale-details-modal"><i class='bx bx-x'></i></button>
                </div>
                <div class="modal-body">
                    <div class="receipt-preview-box">
                        <div class="receipt-header">
                            <h2 id="hist-det-valor">R$ 0,00</h2>
                            <span class="badge-bg" id="hist-det-pagamento">Dinheiro</span>
                        </div>

                        <div class="receipt-info-grid">
                            <div>
                                <small>Cliente</small>
                                <strong id="hist-det-cliente">...</strong>
                            </div>
                            <div>
                                <small>Vendedor</small>
                                <strong id="hist-det-vendedor">...</strong>
                            </div>
                            <div>
                                <small>Hora</small>
                                <strong id="hist-det-hora">--:--</strong>
                            </div>
                        </div>

                        <hr class="dashed-line">

                        <div class="receipt-items-list" id="hist-det-itens">
                        </div>
                    </div>
                </div>
                <div class="modal-footer flex-col">
                    <button class="btn btn-primary" id="btn-reprint-history">
                        <i class='bx bx-printer'></i> Reimprimir Comprovante
                    </button>
                    <button class="btn btn-secondary close-modal-btn" data-target="sale-details-modal">
                        Fechar
                    </button>
                </div>
            </div>
        </div>

        <div id="configuracoes-page" class="page-content" style="display: none;">
            <div class="card container-md">
                <div class="page-header">
                    <h2>Configurações</h2>
                </div>
                <div class="setting-row">
                    <div class="setting-info">
                        <h3>Arredondamento Inteligente de Troco</h3>
                        <p>Quando ativado, os descontos por porcentagem arredondam o valor total da compra para o R$
                            0,50 mais próximo.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="smart-rounding-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <div class="setting-info">
                        <h3>Cache de Produtos</h3>
                        <p>Recarrega a lista de produtos do banco de dados.</p>
                    </div>
                    <button class="btn btn-secondary btn-auto" id="reload-cache-btn">
                        <i class='bx bx-sync'></i> Recarregar
                    </button>
                </div>
            </div>
        </div>

    </div>

    <div class="modal-overlay" id="tax-details-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Transparência Tributária 2026</h3>
                <button class="close-modal-btn" data-target="tax-details-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="tax-breakdown-header">
                    <p>Com base na Reforma Tributária, veja a composição do que será recolhido nesta venda:</p>
                </div>

                <table class="tax-table">
                    <thead>
                        <tr>
                            <th>Tributo</th>
                            <th>% Part.</th>
                            <th>Valor (R$)</th>
                        </tr>
                    </thead>
                    <tbody id="tax-breakdown-body">
                    </tbody>
                </table>

                <div class="tax-footer-info">
                    <p><i class='bx bx-info-circle'></i> <strong>Nota:</strong> Em 2026, as empresas do Simples Nacional
                        estão em fase de transição. O valor acima é uma estimativa da repartição tributária dentro da
                        guia DAS.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="edit-product-modal">
        <div class="modal-content modal-lg transition-all">
            <div class="modal-header">
                <h3><i class='bx bx-edit'></i> Editar Produto</h3>
                <div class="header-actions">
                    <button class="window-control-btn" id="btn-maximize-modal" title="Expandir/Restaurar">
                        <i class='bx bx-expand'></i>
                    </button>
                    <button class="window-control-btn close-modal-btn" data-target="edit-product-modal" title="Fechar">
                        <i class='bx bx-x'></i>
                    </button>
                </div>
            </div>
            <form id="edit-product-form">
                <div class="modal-body product-edit-layout">

                    <div class="edit-col-left">
                        <div class="image-upload-wrapper">
                            <div class="product-img-preview" id="edit-img-preview">
                                <i class='bx bx-image-add'></i>
                            </div>
                            <label class="url-input-label">URL da Imagem</label>
                            <input type="text" id="edit-prod-img-url" placeholder="https://..." class="sm-input">
                        </div>
                    </div>

                    <div class="edit-col-right">

                        <div class="form-grid">
                            <div class="form-group" style="flex: 1;">
                                <label>Código (Barcode)</label>
                                <div class="input-group-lock">
                                    <input type="text" id="edit-prod-code" disabled class="bg-locked"
                                        style="font-weight:700;">
                                    <button type="button" class="btn-unlock" id="btn-unlock-code"
                                        title="Alterar Código">
                                        <i class='bx bx-lock-alt'></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group" style="flex: 2.5;">
                                <label>Nome do Produto *</label>
                                <input type="text" id="edit-prod-name" required placeholder="Ex: Cabo USB Tipo C">
                            </div>
                        </div>

                        <div class="form-group relative-container">
                            <label>Marca / Fabricante</label>
                            <div class="input-with-icon">
                                <input type="text" id="edit-prod-brand" placeholder="Digite para buscar..."
                                    autocomplete="off">
                                <i class='bx bx-search'></i>
                            </div>
                            <div id="brand-suggestions-list" class="suggestions-dropdown"></div>
                        </div>

                        <div class="pricing-card">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Preço de Custo (R$)</label>
                                    <input type="number" id="edit-prod-cost" step="0.01" placeholder="0,00">
                                </div>
                                <div class="form-group">
                                    <label>Preço de Venda (R$)</label>
                                    <input type="number" id="edit-prod-price" step="0.01" required placeholder="0,00">
                                </div>
                                <div class="form-group">
                                    <label>Estoque Atual</label>
                                    <input type="number" id="edit-prod-stock" disabled class="bg-locked"
                                        title="Use Entrada de Nota">
                                </div>
                            </div>
                            <div class="profit-stats">
                                <div class="stat-item"><span class="lbl">Margem:</span><span class="val"
                                        id="calc-margin">0%</span></div>
                                <div class="stat-item"><span class="lbl">Markup:</span><span class="val"
                                        id="calc-markup">0%</span></div>
                                <div class="stat-item"><span class="lbl">Lucro:</span><span class="val text-success"
                                        id="calc-profit">R$ 0,00</span></div>
                            </div>
                        </div>

                        <div class="fiscal-section-clean">
                            <div class="fiscal-header">
                                <i class='bx bx-file'></i>
                                <span>Dados Fiscais (Simples Nacional)</span>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label>NCM</label>
                                    <input type="text" id="edit-prod-ncm" placeholder="0000.00.00" maxlength="10">
                                </div>
                                <div class="form-group">
                                    <label>CEST <small class="text-light">(Subst. Trib.)</small></label>
                                    <input type="text" id="edit-prod-cest" placeholder="00.000.00" maxlength="9">
                                </div>
                                <div class="form-group">
                                    <label>CFOP</label>
                                    <input type="text" id="edit-prod-cfop" value="5102">
                                </div>
                            </div>

                            <div class="form-grid mt-10">
                                <div class="form-group" style="flex:1;">
                                    <label>Unidade</label>
                                    <select id="edit-prod-unit">
                                        <option value="UN">UN</option>
                                        <option value="KG">KG</option>
                                        <option value="CX">CX</option>
                                        <option value="L">L</option>
                                        <option value="M">M</option>
                                        <option value="PC">PC (Peça)</option>
                                        <option value="PCT">PCT (Pacote)</option>
                                    </select>
                                </div>
                                <div class="form-group" style="flex:2;">
                                    <label>Origem</label>
                                    <select id="edit-prod-origem">
                                        <option value="0">0 - Nacional</option>
                                        <option value="1">1 - Importação Direta</option>
                                        <option value="2">2 - Estrangeira (Adq. Interno)</option>
                                    </select>
                                </div>
                                <div class="form-group" style="flex:3;">
                                    <label>CSOSN</label>
                                    <select id="edit-prod-csosn">
                                        <option value="102">102 - Tributada s/ cred.</option>
                                        <option value="500">500 - Subst. Tributária</option>
                                        <option value="101">101 - Com permissão de cred.</option>
                                        <option value="900">900 - Outros</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn"
                        data-target="edit-product-modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary"><i class='bx bx-save'></i> Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="quick-add-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Produto não encontrado</h3>
                <button class="close-modal-btn" data-target="quick-add-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p>O código <strong id="scanned-barcode"></strong> não está cadastrado. Adicione um item rápido.</p>
                <form id="quick-add-form">
                    <div class="form-group">
                        <label for="quick-product-name">Nome do Produto</label>
                        <input type="text" id="quick-product-name" required data-primary-focus="true">
                    </div>
                    <div class="form-group">
                        <label for="quick-product-price">Preço (R$)</label>
                        <input type="number" id="quick-product-price" step="0.01" min="0.01" placeholder="0,00"
                            required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-modal-btn" data-target="quick-add-modal">Cancelar</button>
                <button class="btn btn-primary" id="quick-add-submit-btn">Adicionar à Venda</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="crediario-flow-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Finalizar Crediário</h3>
                <button class="close-modal-btn" data-target="crediario-flow-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body centered-flow">

                <div id="cred-step-1" class="qr-step-container">
                    <div class="modal-icon info" style="margin-bottom: 20px;">
                        <i class='bx bx-printer font-40'></i>
                    </div>
                    <p class="step-instruction">1. Imprima o comprovante</p>
                    <p class="step-subtext">Cliente: <strong id="cred-flow-client-name"
                            style="color:var(--text-dark)">...</strong></p>

                    <button id="btn-force-print">
                        <i class='bx bx-printer'></i> Imprimir Agora
                    </button>
                </div>

                <div id="cred-step-2" class="qr-step-container" style="display:none;">
                    <p class="step-instruction">2. Anexar Comprovante</p>
                    <p class="step-subtext">Escaneie para enviar a foto assinada:</p>

                    <div class="qr-code-box">
                        <img id="cred-qrcode-img" src="" alt="Gerando QR Code...">
                    </div>
                    <p class="text-xs text-light mt-10" style="font-size: 0.75rem;">
                        Link seguro: eletrobusiness.com.br/comprovante...
                    </p>

                    <div class="mt-24">
                        <button id="btn-finish-crediario-final" class="btn-success-flow">
                            <i class='bx bx-check'></i> Concluir Processo
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal-overlay" id="payment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Forma de Pagamento</h3>
                <button class="close-modal-btn" data-target="payment-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p>Valor total: <strong id="payment-total">R$ 0,00</strong>. Como o cliente irá pagar?</p>

                <div class="payment-options" id="single-payment-options">
                    <div class="payment-option" data-method="Dinheiro">
                        <i class='bx bx-dollar-circle font-32'></i> <span>Dinheiro (F6)</span>
                    </div>
                    <div class="payment-option" data-method="PIX">
                        <i class='bx bx-scan font-32'></i> <span>PIX (F7)</span>
                    </div>
                    <div class="payment-option" data-method="Cartão">
                        <i class='bx bx-credit-card font-32'></i> <span>Cartão (F8)</span>
                    </div>
                    <div class="payment-option" data-method="Crediário" id="opt-crediario">
                        <i class='bx bx-user-check font-32'></i> <span>Crediário</span>
                    </div>
                </div>

                <div id="crediario-limit-feedback" style="display: none;">
                    <div class="mini-limit-bar">
                        <div class="mini-limit-fill" id="crediario-limit-fill"></div>
                    </div>
                    <div class="mini-limit-info">
                        <span id="crediario-limit-text">Limite disponível: R$ 0,00</span>
                        <span id="crediario-status-text"></span>
                    </div>
                </div>

                <button class="btn btn-secondary mt-20" id="split-payment-toggle-btn">
                    <i class='bx bx-columns'></i> Dividir Pagamento
                </button>

                <div class="split-payment-area" id="split-payment-area" style="display: none;">
                    <h4>Dividir Pagamento</h4>
                    <div class="split-payment-row">
                        <div class="form-group">
                            <label for="split-method-1">Forma 1</label>
                            <select id="split-method-1">
                                <option value="Dinheiro">Dinheiro</option>
                                <option value="PIX">PIX</option>
                                <option value="Cartão">Cartão</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="split-value-1">Valor 1 (R$)</label>
                            <input type="number" id="split-value-1" step="0.01">
                        </div>
                    </div>
                    <div class="split-payment-row">
                        <div class="form-group">
                            <label for="split-method-2">Forma 2</label>
                            <select id="split-method-2">
                                <option value="Dinheiro">Dinheiro</option>
                                <option value="PIX">PIX</option>
                                <option value="Cartão">Cartão</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="split-value-2">Valor 2 (R$)</label>
                            <input type="number" id="split-value-2" step="0.01">
                        </div>
                    </div>
                    <div class="split-payment-remaining" id="split-payment-remaining">Restante: R$ 0,00</div>
                    <button class="btn btn-primary mt-16" id="confirm-split-payment-btn" disabled>Confirmar
                        Divisão</button>
                </div>

                <div id="crediario-options" style="display: none; animation: slideInUp 0.3s ease;">

                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; border-bottom: 1px dashed #eee; padding-bottom: 10px;">
                        <button type="button" id="back-to-payment-methods"
                            style="background:none; border:none; cursor:pointer; font-size: 0.9rem; color: var(--text-light); display: flex; align-items: center; gap: 5px;">
                            <i class='bx bx-arrow-back'></i> Voltar
                        </button>
                        <h4 style="margin:0;">Crediário</h4>
                    </div>

                    <div
                        style="background-color: var(--bg-light); padding: 10px; border-radius: 8px; margin-bottom: 16px; display: flex; align-items: center; gap: 10px;">
                        <div
                            style="width: 32px; height: 32px; background: #ddd; border-radius: 50%; display: grid; place-items: center;">
                            <i class='bx bx-user'></i>
                        </div>
                        <div>
                            <p style="margin:0; font-weight: 600; font-size: 0.9rem;" id="lbl-cred-client-name">
                                Selecione um cliente</p>
                            <small style="color: var(--text-light);">Cliente vinculado</small>
                        </div>
                        <button type="button" id="btn-change-cred-client"
                            style="margin-left: auto; font-size: 0.8rem; color: var(--info-blue); background: none; border: none; cursor: pointer; text-decoration: underline;">Alterar</button>
                    </div>

                    <div class="form-group">
                        <label>Parcelamento</label>
                        <select id="sale-installments"
                            style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 1rem; background-color: #fff;">
                            <option value="1">1x (À vista na Fatura)</option>
                            <option value="2">2x Sem Juros</option>
                            <option value="3">3x Sem Juros</option>
                            <option value="4">4x Sem Juros</option>
                            <option value="5">5x Sem Juros</option>
                            <option value="6">6x Sem Juros</option>
                        </select>
                        <div style="margin-top: 10px; text-align: center; font-weight: 600; color: var(--primary-red); background: #fff0f3; padding: 10px; border-radius: 8px;"
                            id="installment-preview">
                        </div>
                    </div>

                    <button class="btn btn-primary" id="confirm-crediario-btn" style="width: 100%; margin-top: 10px;">
                        <i class='bx bx-check-double'></i> Confirmar Lançamento
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="receipt-modal">
        <div class="modal-content">
            <div class="modal-body centered">
                <div class="modal-icon success"><i class='bx bx-check font-40'></i></div>
                <h3 class="font-1-5rem mb-8">Venda Finalizada!</h3>
                <p>Venda no valor de <strong id="receipt-total">R$ 0,00</strong> registrada com sucesso.</p>
                <div class="modal-footer flex-col">
                    <button class="btn btn-primary" id="print-receipt-btn">
                        <i class='bx bx-printer'></i> Imprimir Recibo (Não Fiscal)
                    </button>
                    <button class="btn btn-secondary" id="new-sale-btn" data-primary-focus="true">
                        <i class='bx bx-rotate-left'></i> Nova Venda
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="order-details-modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Pedido <span id="modal-order-id" class="text-light">#0000</span></h3>
                <button class="close-modal-btn" data-target="order-details-modal"><i class='bx bx-x'></i></button>
            </div>

            <div class="modal-body">
                <div class="order-progress-track">
                    <div class="step-item" id="step-pendente" onclick="manualSetStatus('pendente')"
                        title="Voltar para Recebido">
                        <div class="step-icon"><i class='bx bx-list-ul'></i></div>
                        <span>Recebido</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" id="step-preparando" onclick="manualSetStatus('preparando')"
                        title="Mudar para Separando">
                        <div class="step-icon"><i class='bx bx-box'></i></div>
                        <span>Separando</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" id="step-enviado" onclick="manualSetStatus('enviado')"
                        title="Mudar para Enviado">
                        <div class="step-icon"><i class='bx bx-car'></i></div>
                        <span>Enviado</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" id="step-finalizado" onclick="manualSetStatus('finalizado')"
                        title="Mudar para Entregue">
                        <div class="step-icon"><i class='bx bx-check-double'></i></div>
                        <span>Entregue</span>
                    </div>
                </div>

                <div class="order-info-box">
                    <h4 class="font-sm mb-8 flex-align gap-8">
                        <i class='bx bx-user'></i> <span id="modal-order-client">Nome do Cliente</span>
                    </h4>
                    <p class="font-sm text-light mb-4">
                        <i class='bx bx-map'></i> <span id="modal-order-address">Endereço...</span>
                    </p>
                    <div class="flex-justify mt-8">
                        <span class="badge-bg" id="modal-payment-method">Pagamento: --</span>
                    </div>
                </div>

                <div class="flex-justify-center mb-10">
                    <h4 class="font-md margin-0">Conferência de Estoque</h4>
                    <small class="text-light">Marque os itens disponíveis</small>
                </div>

                <div id="modal-order-items-list" class="order-items-scroll"></div>

                <div class="financial-breakdown">
                    <div class="financial-row">
                        <span>Subtotal</span>
                        <span id="modal-calc-subtotal">R$ 0,00</span>
                    </div>
                    <div class="financial-row danger" id="row-canceled-items" style="display: none;">
                        <span>Itens Cancelados/Sem Estoque</span>
                        <span id="modal-calc-canceled">- R$ 0,00</span>
                    </div>
                    <div class="financial-row final">
                        <span>Total Final</span>
                        <span id="modal-calc-total" class="text-red">R$ 0,00</span>
                    </div>
                </div>
            </div>

            <div class="modal-footer flex-col gap-10">
                <button id="btn-update-status" class="btn btn-primary">Avançar Status</button>
                <button class="btn btn-close-modal-lg close-modal-btn" data-target="order-details-modal">Fechar
                    Janela</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-body centered">
                <div class="modal-icon danger"><i class='bx bx-error-alt font-40'></i></div>
                <h3 class="font-1-5rem mb-8" id="confirm-title">Tem certeza?</h3>
                <p id="confirm-message">Esta ação não pode ser desfeita.</p>
                <div class="modal-footer justify-center">
                    <button class="btn btn-secondary close-modal-btn" data-target="confirm-modal">Cancelar</button>
                    <button class="btn btn-danger" id="confirm-action-btn" data-primary-focus="true">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="alert-modal">
        <div class="modal-content">
            <div class="modal-body centered">
                <div class="modal-icon info"><i class='bx bx-info-circle font-40'></i></div>
                <h3 class="font-1-5rem mb-8" id="alert-title">Atenção</h3>
                <p id="alert-message">Ocorreu um erro.</p>
                <div class="modal-footer justify-center">
                    <button class="btn btn-primary close-modal-btn" data-target="alert-modal"
                        data-primary-focus="true">Entendi</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="add-cliente-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Cadastrar Novo Cliente</h3>
                <button class="close-modal-btn" data-target="add-cliente-modal"><i class='bx bx-x'></i></button>
            </div>
            <form id="add-cliente-form">
                <div class="modal-body">
                    <h4
                        style="font-size: 0.9rem; color: var(--primary-red); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 16px; font-weight: 700;">
                        <i class='bx bx-id-card'></i> Dados Pessoais
                    </h4>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Apelido / Como prefere ser chamado *</label>
                            <input type="text" id="cliente-apelido" required data-primary-focus="true"
                                placeholder="Ex: João da Padaria">
                        </div>
                        <div class="form-group">
                            <label>Nome Completo (Civil)</label>
                            <input type="text" id="cliente-nome" placeholder="Nome completo para contrato">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>WhatsApp / Telefone</label>
                            <input type="tel" id="cliente-telefone" placeholder="(XX) 9XXXX-XXXX">
                        </div>
                        <div class="form-group">
                            <label>CPF (Apenas números)</label>
                            <input type="text" id="cliente-cpf" placeholder="000.000.000-00">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Endereço Completo</label>
                        <textarea id="cliente-endereco" rows="2" placeholder="Rua, Número, Bairro e Referência..."
                            style="resize: none;"></textarea>
                    </div>

                    <hr class="separator my-16">

                    <h4
                        style="font-size: 0.9rem; color: var(--primary-red); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 16px; font-weight: 700;">
                        <i class='bx bx-wallet'></i> Configuração de Crédito
                    </h4>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Dia de Vencimento</label>
                            <select id="cliente-dia-vencimento" required
                                style="background-color: #fff1f2; border-color: #fda4af; color: #881337; font-weight: 600;">
                                <option value="5">Dia 05</option>
                                <option value="10" selected>Dia 10 (Padrão)</option>
                                <option value="15">Dia 15</option>
                                <option value="20">Dia 20</option>
                                <option value="25">Dia 25</option>
                                <option value="30">Dia 30</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Limite de Crédito (R$)</label>
                            <input type="number" id="cliente-limite" placeholder="0.00" step="50.00">
                        </div>
                    </div>

                    <input type="hidden" id="compra-valor" value="">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn" data-target="add-cliente-modal"
                        style="width: auto; padding: 0 24px;">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="cliente-save-btn"
                        style="width: auto; padding: 0 32px;">
                        <i class='bx bx-check'></i> Salvar Cadastro
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="open-caixa-modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>Abrir Caixa</h3>
            </div>
            <form id="open-caixa-form">
                <div class="modal-body">
                    <p>Informe o valor inicial para troco ou abra sem valor.</p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="open-caixa-notas">Valor em Notas (R$)</label>
                            <input type="number" id="open-caixa-notas" step="0.01" min="0" placeholder="0,00"
                                data-primary-focus="true">
                        </div>
                        <div class="form-group">
                            <label for="open-caixa-moedas">Valor em Moedas (R$)</label>
                            <input type="number" id="open-caixa-moedas" step="0.01" min="0" placeholder="0,00">
                        </div>
                    </div>
                    <div class="toggle-switch-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="open-caixa-sem-valor">
                            <span class="slider"></span>
                        </label>
                        <label for="open-caixa-sem-valor">Abrir caixa sem valor inicial</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="open-caixa-save-btn">
                        <i class='bx bx-check'></i> Confirmar Abertura
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="close-caixa-modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>Fechamento de Caixa</h3>
                <button class="close-modal-btn" data-target="close-caixa-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">

                <div class="step-progress-container">
                    <div class="step-progress-fill" id="close-caixa-progress" style="width: 25%;"></div>
                </div>

                <form id="close-caixa-form" class="multi-step-form">

                    <div id="close-caixa-step-1" class="form-step active">
                        <div class="text-center mb-16">
                            <div class="modal-icon info"
                                style="width: 60px; height: 60px; font-size: 1.5rem; margin-bottom: 10px;"><i
                                    class='bx bx-money'></i></div>
                            <h4>Contagem de Espécie</h4>
                            <p class="text-sm">Conte o dinheiro físico na gaveta.</p>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Total em Notas (R$)</label>
                                <input type="number" id="close-caixa-notas" step="0.01" min="0" placeholder="0,00"
                                    required data-primary-focus="true" style="font-size: 1.2rem; font-weight: 700;">
                            </div>
                            <div class="form-group">
                                <label>Total em Moedas (R$)</label>
                                <input type="number" id="close-caixa-moedas" step="0.01" min="0" placeholder="0,00"
                                    required style="font-size: 1.2rem; font-weight: 700;">
                            </div>
                        </div>
                    </div>

                    <div id="close-caixa-step-2" class="form-step">
                        <div class="text-center mb-16">
                            <div class="modal-icon info"
                                style="width: 60px; height: 60px; font-size: 1.5rem; margin-bottom: 10px;"><i
                                    class='bx bx-credit-card'></i></div>
                            <h4>Conferência Digital</h4>
                            <p class="text-sm">Consulte o relatório da maquininha.</p>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Vendas no Cartão (R$)</label>
                                <input type="number" id="close-caixa-cartao" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                            <div class="form-group">
                                <label>Pix QR Code (Se houver)</label>
                                <input type="number" id="close-caixa-pix" step="0.01" min="0" placeholder="0,00">
                            </div>
                        </div>
                    </div>

                    <div id="close-caixa-step-3" class="form-step">
                        <div class="text-center mb-16">
                            <div class="modal-icon info"
                                style="width: 60px; height: 60px; font-size: 1.5rem; margin-bottom: 10px;"><i
                                    class='bx bx-safe'></i></div>
                            <h4>Destino do Dinheiro</h4>
                            <p class="text-sm">Onde o dinheiro contado será guardado?</p>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Vai para Sangria/Depósito</label>
                                <input type="number" id="close-caixa-deposito" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                            <div class="form-group">
                                <label>Fica no Caixa (Troco)</label>
                                <input type="number" id="close-caixa-fica" step="0.01" min="0" placeholder="0,00"
                                    required>
                            </div>
                        </div>
                    </div>

                    <div id="close-caixa-step-4" class="form-step">
                        <div class="text-center mb-16">
                            <div class="modal-icon danger"
                                style="width: 60px; height: 60px; font-size: 1.5rem; margin-bottom: 10px;"><i
                                    class='bx bx-lock-alt'></i></div>
                            <h4>Finalizar e Bloquear</h4>
                            <p class="text-sm">Assine para confirmar o fechamento.</p>
                        </div>
                        <div class="form-group">
                            <label>Responsável pelo Fechamento</label>
                            <input type="text" id="close-caixa-assinatura" required placeholder="Digite seu nome..."
                                style="text-align: center;">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer modal-footer-multi-step">
                <button class="btn btn-secondary" id="close-caixa-prev-btn" style="display: none; width: auto;">
                    <i class='bx bx-chevron-left'></i> Voltar
                </button>
                <button class="btn btn-primary" id="close-caixa-next-btn" style="width: auto;">
                    Próximo <i class='bx bx-chevron-right'></i>
                </button>
                <button type="submit" form="close-caixa-form" class="btn btn-danger" id="close-caixa-save-btn"
                    style="display: none; width: auto;">
                    <i class='bx bx-lock-alt'></i> Encerrar Dia
                </button>
            </div>
        </div>
    </div>



    <div id="print-area" class="print-only">
        <div class="invoice-container">

            <header class="invoice-header">
                <div class="brand-section">
                    <img src="assets/logo.png" id="print-logo-img" alt="Logo">

                    <div class="brand-text">
                        <h1 id="print-store-name">DTUDO VARIEDADES E UTILIDADES</h1>
                        <p class="brand-subtitle">CNPJ: 45.692.327/0001-00</p>
                    </div>
                </div>

                <div class="invoice-meta">
                    <h2 class="doc-title">COMPROVANTE DE VENDA</h2>
                    <div class="meta-grid">
                        <div class="meta-item">
                            <i class='bx bx-hash'></i>
                            <div>
                                <span class="label">NÚMERO</span>
                                <span class="value" id="print-sale-id">0000</span>
                            </div>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-calendar'></i>
                            <div>
                                <span class="label">DATA</span>
                                <span class="value" id="print-sale-date">--/--/--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <hr class="divider-thick">

            <section class="client-section">
                <div class="section-title">
                    <i class='bx bx-user-circle'></i> DADOS DO CLIENTE
                </div>
                <div class="client-card">
                    <div class="client-row main">
                        <span id="print-client-name">CONSUMIDOR FINAL</span>
                    </div>
                    <div class="client-row details">
                        <span><i class='bx bx-id-card'></i> <span id="print-client-doc">---</span></span>
                        <span><i class='bx bx-map'></i> <span id="print-client-address">Endereço não
                                informado</span></span>
                    </div>
                </div>
            </section>

            <section class="items-section">
                <table class="premium-table">
                    <thead>
                        <tr>
                            <th width="10%">COD</th>
                            <th width="50%">DESCRIÇÃO</th>
                            <th width="10%" class="text-center">QTD</th>
                            <th width="15%" class="text-right">UNIT</th>
                            <th width="15%" class="text-right">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody id="print-items-body">
                    </tbody>
                </table>
            </section>

            <section class="totals-section">
                <div class="payment-info">
                    <div class="section-title small">
                        <i class='bx bx-credit-card'></i> PAGAMENTO
                    </div>
                    <p id="print-obs-text" class="payment-method-text">---</p>

                    <div id="print-installments-area" style="display: none; margin-top: 10px;">
                        <div class="installments-strip" id="print-installments-list"></div>
                    </div>
                </div>

                <div class="totals-box">
                    <div class="t-row">
                        <span>Subtotal</span>
                        <span id="print-subtotal">R$ 0,00</span>
                    </div>
                    <div class="t-row">
                        <span>Descontos</span>
                        <span id="print-discount">R$ 0,00</span>
                    </div>
                    <div class="t-row grand-total">
                        <span>TOTAL A PAGAR</span>
                        <span id="print-total">R$ 0,00</span>
                    </div>
                </div>
            </section>

            <footer class="invoice-footer">
                <div class="legal-text">
                    <p><strong>TERMO DE CONFISSÃO DE DÍVIDA:</strong> Reconheço(emos) a exatidão desta dívida e a
                        obrigação de pagá-la. O não pagamento acarretará nas medidas legais cabíveis. Mercadoria
                        recebida em perfeito estado.</p>
                </div>

                <div class="signature-area">
                    <div class="line"></div>
                    <div class="sig-name" id="print-signature-name">CLIENTE</div>
                </div>

                <div class="system-tag">
                    DTUDO SISTEMAS • Impresso em <span id="print-timestamp"></span>
                </div>
            </footer>
        </div>
    </div>

    <div class="pn">
        <div class="pn-hr">
            <div class="loading1"></div>
            <p class="horario" id="horario">00:00:00</p>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>