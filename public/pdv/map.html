<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>Eletro Business - Estúdio de Mapeamento</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <style>
        #panorama { width: 100%; height: 80vh; }
        #controls { padding: 20px; background: #222; color: white; font-family: sans-serif; }
        .btn-salvar { background: #db0038; color: white; border: none; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div id="panorama"></div>

<div id="controls">
    <h3>Modo de Edição</h3>
    <p>1. Gire a imagem até o produto.<br>2. <strong>Clique no produto</strong> na foto para marcar.</p>
    <div id="status-click">Aguardando clique...</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbznf7SeuiwZ_vtmV1w6u3KfRMRt-EettfRv9TccBUA8qtZTWb_j_h6E6PkaQdkUU1dt/exec";
const CENA_ATUAL = "entrada"; // ID que está na sua planilha de Cenas

const viewer = pannellum.viewer('panorama', {
    "type": "equirectangular",
    "panorama": "URL_DA_SUA_FOTO_360.jpg",
    "autoLoad": true,
    "hotSpotDebug": true // Isso permite capturar as coordenadas ao clicar
});

// Quando o usuário clica na foto
viewer.on('mousedown', function(event) {
    // Transforma o clique na tela em coordenadas 3D (pitch/yaw)
    const coords = viewer.mouseEventToCoords(event);
    const pitch = coords[0];
    const yaw = coords[1];

    const nomeProduto = prompt("Qual produto você está marcando aqui?");
    
    if (nomeProduto) {
        const novoMarcador = {
            cena_pai: CENA_ATUAL,
            texto: nomeProduto,
            pitch: pitch.toFixed(2),
            yaw: yaw.toFixed(2)
        };

        // Envia para o Google Sheets
        fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify(novoMarcador)
        }).then(() => {
            // Adiciona visualmente na hora para dar feedback
            viewer.addHotSpot({
                "pitch": pitch,
                "yaw": yaw,
                "type": "info",
                "text": nomeProduto
            });
            alert("Gravado na planilha!");
        });
    }
});
</script>
</body>
</html>